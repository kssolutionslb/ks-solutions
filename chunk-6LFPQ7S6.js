import{a as de}from"./chunk-PG4D2I4Y.js";import"./chunk-7DWO6MEP.js";import{a as x}from"./chunk-UZYDSN7X.js";import{a as E}from"./chunk-QDVNWT35.js";import{a as b}from"./chunk-YG3ZRH6R.js";import{a as le}from"./chunk-WJCZMWTI.js";import"./chunk-HMNUYURD.js";import{a as y}from"./chunk-WQQRSZMJ.js";import{C as Z,D as ee,E as C,G as te,L as ie,M as ne,_ as oe,ba as re,ka as ae,pa as se,qa as ce}from"./chunk-TNID6TGJ.js";import"./chunk-CARY4E7O.js";import"./chunk-COU37GAH.js";import{$b as z,Ec as M,Fa as H,Fc as P,Gc as O,Hb as l,N as d,Nb as f,Ob as N,Qb as $,Rb as U,Sb as s,Tb as r,Ub as h,Yb as Y,a as S,b as R,bc as v,ea as V,hb as a,hd as W,jd as X,ka as p,mc as u,o as L,oa as j,oc as T,pc as q,sb as F,uc as J,vc as Q,wc as m,xc as g,y as w,ya as G,yc as I,za as K,zb as _,zc as B}from"./chunk-ZZEMHH24.js";var D=(()=>{class t{constructor(){this._lovService=p(E),this._navbarService=p(y),this._networkService=p(re),this._menu$=new L(void 0),this._menuId="",this.menu$=this._menu$.asObservable()}updateMenuData(e){this._networkService.patch(b.MENU_SETTINGS.updateFile,{menuId:e}).pipe(d(1)).subscribe()}updateMenu(e){return this._networkService.patch(b.MENU_PANEL.menus,e,e._id)}addInvoiceSettings(e){this._networkService.post(b.INVOICE.settings,R(S({},e),{menuId:this._menuId})).pipe(d(1)).subscribe(()=>{this.getMenuById(this._menuId)})}updateInvoiceSettings(e){this._networkService.patch(b.INVOICE.settings,e,e._id).pipe(d(1)).subscribe(()=>{this.getMenuById(this._menuId)})}getMenuById(e){this._networkService.post(b.MENU_SETTINGS.byMenuId,{menuId:e}).pipe(d(1)).subscribe({next:i=>{i?i.data&&(this._menu$.next(i.data),this._menuId=e,i.data.isExternal||this._lovService.getMenuTemplatesLov()):this._navbarService.navigateTo(x.LAYOUT.children.HOME.route)},error:()=>{this._navbarService.navigateTo(x.LAYOUT.children.HOME.route)}})}$update(e){this._menu$.next(e)}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=V({token:t,factory:t.\u0275fac})}}return t})();var fe=()=>({text:"Menu Template",translate:!1,addClass:"h4"}),A=t=>({title:t}),me=t=>({header:t}),ve=()=>({text:"Menu Invoice Settings",translate:!1,addClass:"h4"}),ge=()=>({text:"Save Settings"}),Se=()=>({icon:"icon_save"}),he=(t,n,e)=>({label:t,prefixIcon:n,matType:"mat-flat-button",onClick:e}),Ce=t=>[t],xe=t=>({position:"end",buttons:t}),be=()=>({addClass:"mb-1"}),Fe=(t,n,e)=>({header:t,footer:n,content:e}),Ie=()=>({text:"logo"}),pe=(t,n)=>({label:t,control:n}),Me=()=>({text:"Background Color"}),ue=(t,n)=>({label:t,type:"color",control:n}),Te=()=>({text:"Font Color"}),ye=()=>({text:"Show Item Unit In Invoice If Available"}),Ee=t=>({text:t,translate:!1});function ke(t,n){t&1&&(s(0,"p")(1,"strong"),u(2,"Menu Owner:"),r(),u(3),r()),t&2&&(a(3),T(" ",n," "))}function we(t,n){if(t&1&&(s(0,"ks-base-card",0)(1,"div",4),_(2,ke,4,1,"p"),s(3,"p")(4,"strong"),u(5,"Created Date:"),r(),u(6),M(7,"date"),r(),s(8,"p")(9,"strong"),u(10,"Expiry Date:"),r(),u(11),M(12,"date"),r()()()),t&2){let e,i=v(),o=v();l("config",n),a(2),f((e=o.owner())?2:-1,e),a(4),T(" ",O(7,4,i.createdAt,"medium")," "),a(5),T(" ",O(12,7,i.expiresAt,"medium")," ")}}function Ne(t,n){if(t&1&&(s(0,"li",5),u(1),r()),t&2){let e=n.$implicit;a(),q("",e.name," (",e.email,")")}}function $e(t,n){if(t&1&&(s(0,"ul"),$(1,Ne,2,2,"li",5,N),r()),t&2){let e=v();a(),U(e)}}function Ue(t,n){t&1&&(s(0,"div",3)(1,"p"),u(2,"This menu does not have any editors."),r()())}function Be(t,n){t&1&&_(0,$e,3,0,"ul")(1,Ue,3,0,"div",3),t&2&&f(n.length?0:1)}function Pe(t,n){if(t&1&&(s(0,"ks-base-card",0),_(1,Be,2,1),r()),t&2){let e,i=v(2);l("config",n),a(),f((e=i.editors())?1:-1,e)}}function Oe(t,n){if(t&1){let e=Y();s(0,"div",2)(1,"ks-base-card",0)(2,"form")(3,"div",6)(4,"div",7)(5,"div",8),h(6,"ks-base-input",0),r(),s(7,"div",8),h(8,"ks-base-input",0),r(),s(9,"div",8),h(10,"ks-base-input",0),r(),s(11,"div",9),h(12,"ks-base-slide-toggle",0),r()()()(),s(13,"kss-lib-invoice-footer-text",10),z("getValue",function(o){G(e);let c=v(2);return K(c.footerText=o)}),r()()()}if(t&2){let e=v(2);a(),l("config",B(20,Fe,g(7,A,m(6,ve)),g(17,xe,g(15,Ce,B(11,he,m(9,ge),m(10,Se),e.updateMenuInvoice.bind(e)))),m(19,be))),a(5),l("config",I(25,pe,m(24,Ie),e.invoiceSettingsForm.controls.logoUrl)),a(2),l("config",I(29,ue,m(28,Me),e.invoiceSettingsForm.controls.backgroundColor)),a(2),l("config",I(33,ue,m(32,Te),e.invoiceSettingsForm.controls.fontColor)),a(2),l("config",I(37,pe,m(36,ye),e.invoiceSettingsForm.controls.showUnit)),a(),l("control",e.invoiceSettingsForm.controls.footerText)}}function De(t,n){if(t&1&&h(0,"ks-base-card",0),t&2){let e=n.$implicit;l("config",g(5,me,g(3,A,g(1,Ee,e.name))))}}function Ae(t,n){if(t&1&&($(0,De,1,7,"ks-base-card",0,N),M(2,"async")),t&2){let e=v(2);U(P(2,0,e.templates$))}}function Re(t,n){t&1&&(s(0,"div",3)(1,"p"),u(2,"This menu is external and does not support template changes."),r()())}function Le(t,n){if(t&1&&(_(0,we,13,10,"ks-base-card",0),s(1,"div",1),_(2,Pe,2,2,"ks-base-card",0),r(),_(3,Oe,14,40,"div",2),s(4,"ks-base-card",0),_(5,Ae,3,2)(6,Re,3,0,"div",3),r()),t&2){let e,i,o=n,c=v();f((e=c.menuCard())?0:-1,e),a(2),f((i=c.editorsCard())?2:-1,i),a(),f(o.hasInvoice?3:-1),a(),l("config",g(8,me,g(6,A,m(5,fe)))),a(),f(o.isExternal?6:5)}}var ut=(()=>{class t{constructor(){this._destroyRef=p(H),this._dialog=p(oe),this._lovService=p(E),this._menuSettingsService=p(D),this._navService=p(y),this.templates$=this._lovService.menuTemplatesLov$.pipe(w(e=>e.filter(i=>!i.isCustom))),this.menu$=this._menuSettingsService.menu$,this.currentScreen=le("menu_settings"),this.menuCard=F(void 0),this.editorsCard=F(void 0),this.editors=F([]),this.owner=F(""),this.footerText="",this.invoiceSettingsForm=new ee({logoUrl:new C(""),backgroundColor:new C("#FFFFFF"),fontColor:new C("#000000"),footerText:new C(""),showUnit:new C(!1)})}ngOnInit(){let e=this._navService.readUrlParams().MenuId;this._navService.updateNav({show:!0,back:!0,title:this.currentScreen.screenName,buttons:[]}),e?this._menuSettingsService.getMenuById(e):this._navService.navigateTo(x.LAYOUT.children.HOME.route),this._menuSettingsService.menu$.pipe(ne(this._destroyRef)).subscribe(i=>{if(!i)return;this.invoiceSettingsForm.patchValue(i.invoiceSettings||{}),this.footerText=i.invoiceSettings?.footerText||"",this._lovService.userLov$.pipe(d(1)).subscribe(c=>{this.owner.set(c.find(k=>k._id===i.ownerId)?.name??""),this.editors.set(c.filter(k=>i.editorsId.includes(k._id)))}),this.editorsCard.set({header:{title:{text:"Menu Editors",addClass:"h4"},suffixButton:{label:{text:"Edit Editors"},matType:"mat-icon-button",prefixIcon:{icon:"icon_edit"},onClick:()=>{this._openMenu(i)}}}});let o={header:{title:{text:i.name,translate:!1,tag:"h4"},position:"center"},footer:{buttons:[{label:{text:"Open Menu"},matType:"mat-flat-button",suffixIcon:{icon:"icon_arrow_right",size:"sm"},onClick:()=>{i.redirect&&i.activateRedirection?window.open(i.redirect,"_blank"):this._navService.navigateTo(x.MENUS.route+"/"+i.endpoint,{})}}],position:"end"}};i.isExternal&&o.footer?.buttons?.unshift({label:{text:"Update Menu Data"},matType:"mat-flat-button",suffixIcon:{icon:"icon_refresh"},onClick:()=>{this._updateMenu(i)}}),this.menuCard.set(o)})}updateMenuInvoice(){this._dialog.openConfirmPopup({title:{text:"Confirm Save"},message:{text:"Are you sure you want to update the invoice settings?"}}).afterClosed().pipe(d(1)).subscribe(e=>{e&&this._menuSettingsService.menu$.pipe(d(1)).subscribe(i=>{let o=this.invoiceSettingsForm.value;o.footerText=this.footerText,i&&(i.invoiceSettings?this._menuSettingsService.updateInvoiceSettings(S(S({},i.invoiceSettings),o)):this._menuSettingsService.addInvoiceSettings(o))})})}_openMenu(e){let i={title:{text:"Editors"},form:{value:S({},e||{}),fields:[{name:"editorsId",type:"select",label:{text:"Editors"},stream:this._lovService.userLov$.pipe(w(o=>o.filter(c=>c._id!==e?.ownerId))),transformer:{nameKey:"name",valueKey:"_id"},multiple:!0}]},beforeCloseObservable:o=>this._menuSettingsService.updateMenu(S(S({},e),o)),getAfterSuccessResponse:o=>{o.data&&this._menuSettingsService.$update(o.data)}};this._dialog.openFormPopup(i,"500px")}_updateMenu(e){let i={title:{text:"Confirm Update"},message:{text:"Are you sure you want to update this menu? Please note that it may take up to 5 minutes for the changes to take effect."}};this._dialog.openConfirmPopup(i).afterClosed().pipe(d(1)).subscribe(o=>{o&&e._id&&this._menuSettingsService.updateMenuData(e._id)})}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=j({type:t,selectors:[["ks-solutions-menu-settings"]],standalone:!0,features:[J([D]),Q],decls:2,vars:3,consts:[[3,"config"],[1,"my-3"],[1,"mb-3"],[1,"external-menu-info"],[1,"dates-section"],[1,"text-break"],[1,"container-fluid"],[1,"row"],[1,"col-12","col-sm-12","col-md-6","col-lg-4"],[1,"col-12","col-sm-12","col-md-6","col-lg-4","pt-4",2,"min-height","75px"],[3,"getValue","control"]],template:function(i,o){if(i&1&&(_(0,Le,7,10),M(1,"async")),i&2){let c;f((c=P(1,1,o.menu$))?0:-1,c)}},dependencies:[se,W,X,ae,ie,te,Z,ce,de],styles:[".external-menu-info[_ngcontent-%COMP%]{font-size:16px;color:#6c757d}"],changeDetection:0})}}return t})();export{ut as MenuSettingsComponent};
