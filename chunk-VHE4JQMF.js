import{a as de}from"./chunk-CLHPIWDV.js";import"./chunk-ZW3YCSCF.js";import{a as b}from"./chunk-5JR444DF.js";import{a as y}from"./chunk-YLXVY45S.js";import{a as I}from"./chunk-X64TF3C4.js";import{a as le}from"./chunk-5GWMFGPU.js";import"./chunk-HMNUYURD.js";import{a as M}from"./chunk-NNKWD6R3.js";import{C as Z,D as ee,E as x,G as te,L as ie,M as ne,_ as oe,ba as re,ka as ae,pa as se,qa as ce}from"./chunk-EYM2RH5N.js";import"./chunk-CARY4E7O.js";import"./chunk-F5WOQGUX.js";import{$b as z,Dc as T,Ec as O,Fa as H,Fc as P,Hb as l,N as d,Nb as v,Ob as U,Qb as $,Rb as B,Sb as s,Tb as r,Ub as C,Yb as Y,a as _,b as w,bc as g,ea as L,gd as W,hb as a,id as X,ka as p,mc as u,o as V,oa as G,oc as E,pc as q,sb as h,uc as J,vc as Q,wc as m,xc as S,y as N,ya as j,yc as F,za as K,zb as f,zc as D}from"./chunk-RQMRH3XI.js";var A=(()=>{class t{constructor(){this._lovService=p(y),this._navbarService=p(M),this._networkService=p(re),this._menu$=new V(void 0),this._menuId="",this.menu$=this._menu$.asObservable()}updateMenuData(e){this._networkService.patch(I.MENU_SETTINGS.updateFile,{menuId:e}).pipe(d(1)).subscribe()}updateMenuEditors(e){return this._networkService.patch(I.MENU_SETTINGS.menuEditors,w(_({},e),{menuId:e._id}))}addInvoiceSettings(e){this._networkService.post(I.INVOICE.settings,w(_({},e),{menuId:this._menuId})).pipe(d(1)).subscribe(()=>{this.getMenuById(this._menuId)})}updateInvoiceSettings(e){this._networkService.patch(I.INVOICE.settings,e,e._id).pipe(d(1)).subscribe(()=>{this.getMenuById(this._menuId)})}getMenuById(e){this._networkService.post(I.MENU_SETTINGS.byMenuId,{menuId:e}).pipe(d(1)).subscribe({next:i=>{i?i.data&&(this._menu$.next(i.data),this._menuId=e,i.data.isExternal||this._lovService.getMenuTemplatesLov()):this._navbarService.navigateTo(b.LAYOUT.children.HOME.route)},error:()=>{this._navbarService.navigateTo(b.LAYOUT.children.HOME.route)}})}$update(e){this._menu$.next(e)}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=L({token:t,factory:t.\u0275fac})}}return t})();var fe=()=>({text:"Menu Template",translate:!1,addClass:"h4"}),R=t=>({title:t}),me=t=>({header:t}),ve=()=>({text:"Menu Invoice Settings",translate:!1,addClass:"h4"}),ge=()=>({text:"Save Settings"}),Se=()=>({icon:"icon_save"}),he=(t,n,e)=>({label:t,prefixIcon:n,matType:"mat-flat-button",onClick:e}),Ce=t=>[t],xe=t=>({position:"end",buttons:t}),be=()=>({addClass:"mb-1"}),Ie=(t,n,e)=>({header:t,footer:n,content:e}),Fe=()=>({text:"logo"}),pe=(t,n)=>({label:t,control:n}),Te=()=>({text:"Background Color"}),ue=(t,n)=>({label:t,type:"color",control:n}),Ee=()=>({text:"Font Color"}),Me=()=>({text:"Show Item Unit In Invoice If Available"}),ye=t=>({text:t,translate:!1});function ke(t,n){t&1&&(s(0,"p")(1,"strong"),u(2,"Menu Owner:"),r(),u(3),r()),t&2&&(a(3),E(" ",n," "))}function we(t,n){if(t&1&&(s(0,"ks-base-card",0)(1,"div",4),f(2,ke,4,1,"p"),s(3,"p")(4,"strong"),u(5,"Created Date:"),r(),u(6),T(7,"date"),r(),s(8,"p")(9,"strong"),u(10,"Expiry Date:"),r(),u(11),T(12,"date"),r()()()),t&2){let e,i=g(),o=g();l("config",n),a(2),v((e=o.owner())?2:-1,e),a(4),E(" ",P(7,4,i.createdAt,"medium")," "),a(5),E(" ",P(12,7,i.expiresAt,"medium")," ")}}function Ne(t,n){if(t&1&&(s(0,"li",5),u(1),r()),t&2){let e=n.$implicit;a(),q("",e.name," (",e.email,")")}}function Ue(t,n){if(t&1&&(s(0,"ul"),$(1,Ne,2,2,"li",5,U),r()),t&2){let e=g();a(),B(e)}}function $e(t,n){t&1&&(s(0,"div",3)(1,"p"),u(2,"This menu does not have any editors."),r()())}function Be(t,n){t&1&&f(0,Ue,3,0,"ul")(1,$e,3,0,"div",3),t&2&&v(n.length?0:1)}function De(t,n){if(t&1&&(s(0,"ks-base-card",0),f(1,Be,2,1),r()),t&2){let e,i=g(2);l("config",n),a(),v((e=i.editors())?1:-1,e)}}function Oe(t,n){if(t&1){let e=Y();s(0,"div",2)(1,"ks-base-card",0)(2,"form")(3,"div",6)(4,"div",7)(5,"div",8),C(6,"ks-base-input",0),r(),s(7,"div",8),C(8,"ks-base-input",0),r(),s(9,"div",8),C(10,"ks-base-input",0),r(),s(11,"div",9),C(12,"ks-base-slide-toggle",0),r()()()(),s(13,"kss-lib-invoice-footer-text",10),z("getValue",function(o){j(e);let c=g(2);return K(c.footerText=o)}),r()()()}if(t&2){let e=g(2);a(),l("config",D(20,Ie,S(7,R,m(6,ve)),S(17,xe,S(15,Ce,D(11,he,m(9,ge),m(10,Se),e.updateMenuInvoice.bind(e)))),m(19,be))),a(5),l("config",F(25,pe,m(24,Fe),e.invoiceSettingsForm.controls.logoUrl)),a(2),l("config",F(29,ue,m(28,Te),e.invoiceSettingsForm.controls.backgroundColor)),a(2),l("config",F(33,ue,m(32,Ee),e.invoiceSettingsForm.controls.fontColor)),a(2),l("config",F(37,pe,m(36,Me),e.invoiceSettingsForm.controls.showUnit)),a(),l("control",e.invoiceSettingsForm.controls.footerText)}}function Pe(t,n){if(t&1&&C(0,"ks-base-card",0),t&2){let e=n.$implicit;l("config",S(5,me,S(3,R,S(1,ye,e.name))))}}function Ae(t,n){if(t&1&&($(0,Pe,1,7,"ks-base-card",0,U),T(2,"async")),t&2){let e=g(2);B(O(2,0,e.templates$))}}function Re(t,n){t&1&&(s(0,"div",3)(1,"p"),u(2,"This menu is external and does not support template changes."),r()())}function Ve(t,n){if(t&1&&(f(0,we,13,10,"ks-base-card",0),s(1,"div",1),f(2,De,2,2,"ks-base-card",0),r(),f(3,Oe,14,40,"div",2),s(4,"ks-base-card",0),f(5,Ae,3,2)(6,Re,3,0,"div",3),r()),t&2){let e,i,o=n,c=g();v((e=c.menuCard())?0:-1,e),a(2),v((i=c.editorsCard())?2:-1,i),a(),v(o.hasInvoice?3:-1),a(),l("config",S(8,me,S(6,R,m(5,fe)))),a(),v(o.isExternal?6:5)}}var ut=(()=>{class t{constructor(){this._destroyRef=p(H),this._dialog=p(oe),this._lovService=p(y),this._menuSettingsService=p(A),this._navService=p(M),this.templates$=this._lovService.menuTemplatesLov$.pipe(N(e=>e.filter(i=>!i.isCustom))),this.menu$=this._menuSettingsService.menu$,this.currentScreen=le("menu_settings"),this.menuCard=h(void 0),this.editorsCard=h(void 0),this.editors=h([]),this.owner=h(""),this.footerText="",this.invoiceSettingsForm=new ee({logoUrl:new x(""),backgroundColor:new x("#FFFFFF"),fontColor:new x("#000000"),footerText:new x(""),showUnit:new x(!1)})}ngOnInit(){let e=this._navService.readUrlParams().MenuId;this._navService.updateNav({show:!0,back:!0,title:this.currentScreen.screenName,buttons:[]}),e?this._menuSettingsService.getMenuById(e):this._navService.navigateTo(b.LAYOUT.children.HOME.route),this._menuSettingsService.menu$.pipe(ne(this._destroyRef)).subscribe(i=>{if(!i)return;this.invoiceSettingsForm.patchValue(i.invoiceSettings||{}),this.footerText=i.invoiceSettings?.footerText||"",this._lovService.userLov$.pipe(d(1)).subscribe(c=>{this.owner.set(c.find(k=>k._id===i.ownerId)?.name??""),this.editors.set(c.filter(k=>i.editorsId.includes(k._id)))}),this.editorsCard.set({header:{title:{text:"Menu Editors",addClass:"h4"},suffixButton:{label:{text:"Edit Editors"},matType:"mat-icon-button",prefixIcon:{icon:"icon_edit"},onClick:()=>{this._openUpdateEditorsDialog(i)}}}});let o={header:{title:{text:i.name,translate:!1,tag:"h4"},position:"center"},footer:{buttons:[{label:{text:"Update Menu Data"},matType:"mat-flat-button",suffixIcon:{icon:"icon_refresh"},onClick:()=>{this._updateMenu(i)},hide:h(!i.isExternal)},{label:{text:"Open Menu"},matType:"mat-flat-button",suffixIcon:{icon:"icon_arrow_right",size:"sm"},onClick:()=>{i.redirect&&i.activateRedirection?window.open(i.redirect,"_blank"):this._navService.navigateTo(b.MENUS.route+"/"+i.endpoint,{})}}],position:"end"}};this.menuCard.set(o)})}updateMenuInvoice(){this._dialog.openConfirmPopup({title:{text:"Confirm Save"},message:{text:"Are you sure you want to update the invoice settings?"}}).afterClosed().pipe(d(1)).subscribe(e=>{e&&this._menuSettingsService.menu$.pipe(d(1)).subscribe(i=>{let o=this.invoiceSettingsForm.value;o.footerText=this.footerText,i&&(i.invoiceSettings?this._menuSettingsService.updateInvoiceSettings(_(_({},i.invoiceSettings),o)):this._menuSettingsService.addInvoiceSettings(o))})})}_openUpdateEditorsDialog(e){let i={title:{text:"Editors"},form:{value:_({},e||{}),fields:[{name:"editorsId",type:"select",label:{text:"Editors"},stream:this._lovService.userLov$.pipe(N(o=>o.filter(c=>c._id!==e?.ownerId))),transformer:{nameKey:"name",valueKey:"_id"},multiple:!0}]},beforeCloseObservable:o=>this._menuSettingsService.updateMenuEditors(_(_({},e),o)),getAfterSuccessResponse:o=>{o.data&&this._menuSettingsService.$update(o.data)}};this._dialog.openFormPopup(i,"500px")}_updateMenu(e){let i={title:{text:"Confirm Update"},message:{text:"Are you sure you want to update this menu? Please note that it may take up to 5 minutes for the changes to take effect."}};this._dialog.openConfirmPopup(i).afterClosed().pipe(d(1)).subscribe(o=>{o&&e._id&&this._menuSettingsService.updateMenuData(e._id)})}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=G({type:t,selectors:[["ks-solutions-menu-settings"]],standalone:!0,features:[J([A]),Q],decls:2,vars:3,consts:[[3,"config"],[1,"my-3"],[1,"mb-3"],[1,"external-menu-info"],[1,"dates-section"],[1,"text-break"],[1,"container-fluid"],[1,"row"],[1,"col-12","col-sm-12","col-md-6","col-lg-4"],[1,"col-12","col-sm-12","col-md-6","col-lg-4","pt-4",2,"min-height","75px"],[3,"getValue","control"]],template:function(i,o){if(i&1&&(f(0,Ve,7,10),T(1,"async")),i&2){let c;v((c=O(1,1,o.menu$))?0:-1,c)}},dependencies:[se,W,X,ae,ie,te,Z,ce,de],styles:[".external-menu-info[_ngcontent-%COMP%]{font-size:16px;color:#6c757d}"],changeDetection:0})}}return t})();export{ut as MenuSettingsComponent};
