import{a as Se,b as xe,c as be,d as ye}from"./chunk-LC4U7QJI.js";import{a as O}from"./chunk-6OI7AZWG.js";import{a as T}from"./chunk-ACYZVNWI.js";import{a as x}from"./chunk-UA3J3SVI.js";import{a as ve}from"./chunk-JP4TISGE.js";import"./chunk-HMNUYURD.js";import{a as B}from"./chunk-CIN27HPJ.js";import{D as se,E as de,F as le,G as y,H as ce,I as pe,M as me,N as ue,O as D,aa as _e,da as fe,ma as he,ra as ge,sa as Ce}from"./chunk-KEGVG7Y7.js";import"./chunk-CARY4E7O.js";import{h as ae}from"./chunk-C3554X3N.js";import{Ab as f,Ac as z,Fa as k,Fc as b,Gc as j,Hc as $,Ib as p,Ka as q,La as J,N as m,Ob as h,Pb as R,Qc as ne,Rb as V,Sb as A,Tb as s,Ub as r,Vb as S,Zb as X,a as _,ac as U,b as I,cc as u,ea as H,eb as Q,ib as a,id as oe,ka as c,kd as re,nc as l,o as K,oa as F,pc as M,qc as L,sc as Z,tb as v,tc as ee,uc as te,vc as ie,wc as N,xc as g,y as P,ya as W,yc as E,za as Y,zc as w}from"./chunk-QCG4JP6W.js";var G=(()=>{class t{constructor(){this._lovService=c(O),this._navbarService=c(B),this._networkService=c(fe),this._menu$=new K(void 0),this._menuId="",this.menu$=this._menu$.asObservable()}updateMenuData(e){this._networkService.patch(x.MENU_SETTINGS.updateFile,{menuId:e}).pipe(m(1)).subscribe()}updateMenuEditors(e){return this._networkService.patch(x.MENU_SETTINGS.menuEditors,I(_({},e),{menuId:e._id}))}updateMenuTemplate(e,i){this._networkService.patch(x.MENU_SETTINGS.menuTemplate,{menuId:e,newTemplateId:i}).pipe(m(1)).subscribe(n=>{if(n?.data){let d=this._menu$.getValue();d&&(d.templateId=n.data.templateId,this._menu$.next(d))}})}addInvoiceSettings(e){this._networkService.post(x.INVOICE.settings,I(_({},e),{menuId:this._menuId})).pipe(m(1)).subscribe(()=>{this.getMenuById(this._menuId)})}updateInvoiceSettings(e){this._networkService.patch(x.INVOICE.settings,e,e._id).pipe(m(1)).subscribe(()=>{this.getMenuById(this._menuId)})}getMenuById(e){this._networkService.post(x.MENU_SETTINGS.byMenuId,{menuId:e}).pipe(m(1)).subscribe({next:i=>{i?i.data&&(this._menu$.next(i.data),this._menuId=e,i.data.isExternal||this._lovService.getMenuTemplatesLov()):this._navbarService.navigateTo(T.LAYOUT.children.HOME.route)},error:()=>{this._navbarService.navigateTo(T.LAYOUT.children.HOME.route)}})}$update(e){this._menu$.next(e)}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=H({token:t,factory:t.\u0275fac})}}return t})();var Ie=(()=>{class t{constructor(){this._destroyRef=c(k),this._crd=c(ne),this.control=J.required(),this.getValue=q(),this.editor=new ye,this.htmlContent="",this.toolbar=[["bold","italic","underline"],["align_left","align_center","align_right","align_justify"],["bullet_list","ordered_list"],["horizontal_rule","format_clear","indent","outdent"],["undo","redo"]]}ngOnInit(){this.htmlContent=this.control().value,this.control().valueChanges.pipe(D(this._destroyRef)).subscribe(e=>{this.htmlContent=e||"",this._crd.markForCheck()})}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=F({type:t,selectors:[["kss-lib-invoice-footer-text"]],inputs:{control:[1,"control"]},outputs:{getValue:"getValue"},standalone:!0,features:[N],decls:5,vars:4,consts:[[1,"w-100"],[1,"py-2","ps-2","text-center","h5","underline"],[3,"toolbar","editor"],[3,"ngModelChange","focusOut","editor","ngModel"]],template:function(i,n){i&1&&(s(0,"div",0)(1,"div",1),l(2,"Footer Text"),r(),S(3,"ngx-editor-menu",2),s(4,"ngx-editor",3),te("ngModelChange",function(C){return ee(n.htmlContent,C)||(n.htmlContent=C),C}),U("focusOut",function(){return n.getValue.emit(n.htmlContent)}),r()()),i&2&&(a(3),p("toolbar",n.toolbar)("editor",n.editor),a(),p("editor",n.editor),Z("ngModel",n.htmlContent))},dependencies:[be,Se,xe,me,se,ce],changeDetection:0})}}return t})();var Fe=()=>({text:"Menu Template",translate:!1,addClass:"h4"}),Ee=t=>({title:t}),ke=()=>({addClass:"card p-3"}),Ue=(t,o)=>({header:t,content:o,addClass:"border"}),Ne=()=>({text:"Menu Invoice Settings",translate:!1,addClass:"h4"}),$e=()=>({text:"Save Settings"}),De=()=>({icon:"icon_save"}),Be=(t,o,e)=>({label:t,prefixIcon:o,matType:"mat-flat-button",onClick:e}),Oe=t=>[t],Pe=t=>({position:"end",buttons:t}),Re=()=>({addClass:"mb-1"}),Ve=(t,o,e)=>({header:t,footer:o,content:e,addClass:"border"}),Ae=()=>({text:"Background Color"}),Me=(t,o)=>({label:t,type:"color",control:o}),Le=()=>({text:"Font Color"}),ze=()=>({text:"Show Item Unit In Invoice If Available"}),je=(t,o)=>({label:t,control:o});function Ge(t,o){t&1&&(s(0,"p")(1,"strong"),l(2,"Menu Owner:"),r(),l(3),r()),t&2&&(a(3),M(" ",o," "))}function Ke(t,o){if(t&1&&(s(0,"p")(1,"strong"),l(2,"Last Updated By:"),r(),l(3),r(),s(4,"p")(5,"strong"),l(6,"Last Updated At:"),r(),l(7),b(8,"date"),r()),t&2){let e=u(2);a(3),L(" ",e.lastUpdate.name," (",e.lastUpdate.email,") "),a(4),M(" ",$(8,3,e.lastUpdate.createdAt,"medium")," ")}}function He(t,o){if(t&1&&(s(0,"div")(1,"ks-base-card",1)(2,"div",5),f(3,Ge,4,1,"p"),s(4,"p")(5,"strong"),l(6,"Created Date:"),r(),l(7),b(8,"date"),r(),s(9,"p")(10,"strong"),l(11,"Expiry Date:"),r(),l(12),b(13,"date"),r(),f(14,Ke,9,6),r()()()),t&2){let e,i=u(),n=u();a(),p("config",o),a(2),h((e=n.owner())?3:-1,e),a(4),M(" ",$(8,5,i.createdAt,"medium")," "),a(5),M(" ",$(13,8,i.expiresAt,"medium")," "),a(2),h(i.lastUpdate?14:-1)}}function We(t,o){if(t&1&&(s(0,"li",6),l(1),r()),t&2){let e=o.$implicit;a(),L("",e.name," (",e.email,")")}}function Ye(t,o){if(t&1&&(s(0,"ul"),V(1,We,2,2,"li",6,R),r()),t&2){let e=u();a(),A(e)}}function qe(t,o){t&1&&(s(0,"div",4)(1,"p"),l(2,"This menu currently has no editors. Please contact your administrator if you'd like to add one."),r()())}function Je(t,o){t&1&&f(0,Ye,3,0,"ul")(1,qe,3,0,"div",4),t&2&&h(o.length?0:1)}function Qe(t,o){if(t&1&&(s(0,"ks-base-card",1),f(1,Je,2,1),r()),t&2){let e,i=u(2);p("config",o),a(),h((e=i.editors())?1:-1,e)}}function Xe(t,o){if(t&1){let e=X();s(0,"div",2)(1,"ks-base-card",1)(2,"form")(3,"div",7)(4,"div",8)(5,"div",9),S(6,"ks-base-input",1),r(),s(7,"div",9),S(8,"ks-base-input",1),r(),s(9,"div",10),S(10,"ks-base-slide-toggle",1),r()()()(),s(11,"kss-lib-invoice-footer-text",11),U("getValue",function(n){W(e);let d=u(2);return Y(d.footerText=n)}),r()()()}if(t&2){let e=u(2);a(),p("config",z(19,Ve,E(6,Ee,g(5,Ne)),E(16,Pe,E(14,Oe,z(10,Be,g(8,$e),g(9,De),e.updateMenuInvoice.bind(e)))),g(18,Re))),a(5),p("config",w(24,Me,g(23,Ae),e.invoiceSettingsForm.controls.backgroundColor)),a(2),p("config",w(28,Me,g(27,Le),e.invoiceSettingsForm.controls.fontColor)),a(2),p("config",w(32,je,g(31,ze),e.invoiceSettingsForm.controls.showUnit)),a(),p("control",e.invoiceSettingsForm.controls.footerText)}}function Ze(t,o){if(t&1&&(s(0,"div",12)(1,"ks-base-card",1),S(2,"iframe",13),r()()),t&2){let e=o.$implicit,i=u(2),n=u();a(),p("config",n.getTemplateCardConfig(i,e)),a(),p("src",e.templateUrl,Q)}}function et(t,o){if(t&1&&(s(0,"div",3),V(1,Ze,3,2,"div",12,R),b(3,"async"),r()),t&2){let e=u(2);a(),A(j(3,0,e.templates$))}}function tt(t,o){t&1&&(s(0,"div",4)(1,"p"),l(2,"This menu is external and does not support template changes."),r()())}function it(t,o){if(t&1&&(f(0,He,15,11,"div"),s(1,"div",0),f(2,Qe,2,2,"ks-base-card",1),r(),f(3,Xe,12,35,"div",2),s(4,"div")(5,"ks-base-card",1),f(6,et,4,2,"div",3)(7,tt,3,0,"div",4),r()()),t&2){let e,i,n=o,d=u();h((e=d.menuCard())?0:-1,e),a(2),h((i=d.editorsCard())?2:-1,i),a(),h(n.hasInvoice?3:-1),a(2),p("config",w(9,Ue,E(6,Ee,g(5,Fe)),g(8,ke))),a(),h(n.isExternal?7:6)}}var Ot=(()=>{class t{constructor(){this._sanitizer=c(ae),this._destroyRef=c(k),this._dialog=c(_e),this._lovService=c(O),this._menuSettingsService=c(G),this._navService=c(B),this.templates$=this._lovService.menuTemplatesLov$.pipe(P(e=>e.filter(i=>!i.isCustom).map(i=>I(_({},i),{templateUrl:this._sanitizer.bypassSecurityTrustResourceUrl(window.location.origin+"/menus/"+i.templateId)})))),this.menu$=this._menuSettingsService.menu$,this.currentScreen=ve("menu_settings"),this.menuCard=v(void 0),this.editorsCard=v(void 0),this.editors=v([]),this.owner=v(""),this.footerText="",this.invoiceSettingsForm=new le({logoUrl:new y(""),backgroundColor:new y("#FFFFFF"),fontColor:new y("#000000"),footerText:new y(""),showUnit:new y(!1)})}ngOnInit(){let e=this._navService.readUrlParams().MenuId;this._navService.updateNav({show:!0,back:!0,title:this.currentScreen.screenName,buttons:[]}),e?this._menuSettingsService.getMenuById(e):this._navService.navigateTo(T.LAYOUT.children.HOME.route),this._menuSettingsService.menu$.pipe(D(this._destroyRef)).subscribe(i=>{if(!i)return;this.invoiceSettingsForm.patchValue(i.invoiceSettings||{}),this.footerText=i.invoiceSettings?.footerText||"",this._lovService.userLov$.pipe(m(1)).subscribe(d=>{this.owner.set(d.find(C=>C._id===i.ownerId)?.name??""),this.editors.set(d.filter(C=>i.editorsId.includes(C._id)))}),this.editorsCard.set({header:{title:{text:"Menu Editors",addClass:"h4"}},content:{addClass:"card p-3"},addClass:"border"});let n={header:{title:{text:i.name,translate:!1,tag:"h4"},position:"center"},footer:{buttons:[{label:{text:"Update Menu Data"},matType:"mat-flat-button",suffixIcon:{icon:"icon_refresh"},onClick:()=>{this._updateMenu(i)},hide:v(!i.isExternal)},{label:{text:"Open Menu"},matType:"mat-flat-button",suffixIcon:{icon:"icon_arrow_right",size:"sm"},onClick:()=>{i.redirect&&i.activateRedirection?window.open(i.redirect,"_blank"):window.open(`${window.location.origin}/${T.MENUS.route}/${i.endpoint}`,"_blank")}}],position:"end"},content:{addClass:"card p-3"},addClass:"border"};this.menuCard.set(n)})}updateMenuInvoice(){this._dialog.openConfirmPopup({title:{text:"Confirm Save"},message:{text:"Are you sure you want to update the invoice settings?"}}).afterClosed().pipe(m(1)).subscribe(e=>{e&&this._menuSettingsService.menu$.pipe(m(1)).subscribe(i=>{let n=this.invoiceSettingsForm.value;n.footerText=this.footerText,i&&(i.invoiceSettings?this._menuSettingsService.updateInvoiceSettings(_(_({},i.invoiceSettings),n)):this._menuSettingsService.addInvoiceSettings(n))})})}getTemplateCardConfig(e,i){return{header:{title:{text:i.name,translate:!1,addClass:"h4"},position:"center"},footer:{buttons:[{label:{text:"Use"},matType:"mat-stroked-button",onClick:()=>{this._changeMenuTemplate(e._id,i)},hide:v(e.templateId===i.templateId)}],position:"center"},content:{addClass:"rounded overflow-hidden"},addClass:`h-100 w-100 ${e.templateId===i.templateId?"border border-primary border-3 ":""}`}}_openUpdateEditorsDialog(e){let i={title:{text:"Editors"},form:{value:_({},e||{}),fields:[{name:"editorsId",type:"select",label:{text:"Editors"},stream:this._lovService.userLov$.pipe(P(n=>n.filter(d=>d._id!==e?.ownerId))),transformer:{nameKey:"name",valueKey:"_id"},multiple:!0}]},beforeCloseObservable:n=>this._menuSettingsService.updateMenuEditors(_(_({},e),n)),getAfterSuccessResponse:n=>{n.data&&this._menuSettingsService.$update(n.data)}};this._dialog.openFormPopup(i,"500px")}_changeMenuTemplate(e,i){let n={title:{text:"Confirm Template"},message:{text:`Are you sure you want to use ${i.name}?`}};this._dialog.openConfirmPopup(n).afterClosed().pipe(m(1)).subscribe(d=>{d&&this._menuSettingsService.updateMenuTemplate(e,i._id)})}_updateMenu(e){let i={title:{text:"Confirm Update"},message:{text:"Are you sure you want to update this menu? Please note that it may take up to 5 minutes for the changes to take effect."}};this._dialog.openConfirmPopup(i).afterClosed().pipe(m(1)).subscribe(n=>{n&&e._id&&this._menuSettingsService.updateMenuData(e._id)})}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=F({type:t,selectors:[["ks-solutions-menu-settings"]],standalone:!0,features:[ie([G]),N],decls:2,vars:3,consts:[[1,"my-3"],[3,"config"],[1,"mb-3"],[1,"d-flex","overflow-x-auto","gap-3","h-100","pb-3"],[1,"external-menu-info"],[1,"dates-section"],[1,"text-break"],[1,"container-fluid"],[1,"row"],[1,"col-12","col-sm-12","col-md-6","col-lg-4"],[1,"col-12","col-sm-12","col-md-6","col-lg-4","pt-4",2,"min-height","75px"],[3,"getValue","control"],[2,"min-width","300px","max-width","300px","min-height","500px","max-height","500px"],["frameborder","0","width","100%","height","100%",2,"zoom","0.7",3,"src"]],template:function(i,n){if(i&1&&(f(0,it,8,12),b(1,"async")),i&2){let d;h((d=j(1,1,n.menu$))?0:-1,d)}},dependencies:[ge,oe,re,he,ue,pe,de,Ce,Ie],styles:[".external-menu-info[_ngcontent-%COMP%]{font-size:16px;color:#6c757d}"],changeDetection:0})}}return t})();export{Ot as MenuSettingsComponent};
