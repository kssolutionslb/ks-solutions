import{a as d,b as v}from"./chunk-V3RKPLKU.js";import{Y as b}from"./chunk-E5MLKHCJ.js";import{l as f,n as p}from"./chunk-ARNZMF2R.js";import{N as g,a,b as l,ea as _,h as m,ka as h,o as x,sb as u}from"./chunk-42PURYOY.js";var $=(()=>{class c{constructor(){this._networkService=h(b),this._activatedRoute=h(f),this._router=h(p),this._menu=u(null),this._lang=u(void 0),this._loading$=new x(!0),this.menu=this._menu.asReadonly(),this.lang=this._lang.asReadonly(),this.loading$=this._loading$.asObservable(),this.selectedSectionSig=u(null)}getMenuData(){this._activatedRoute.params.pipe(g(1)).subscribe(t=>{if(t&&t.businessName){let e=t.businessName;if(this._loading$.next(!0),e.length>3){this._networkService.get(`${d.MENU.getMenuByEndpoint}/${e}`).pipe(g(1)).subscribe({next:s=>{if(s){let i=s.data;if(i){if(i.redirect){window.location.href=i.redirect;return}this._callLogApi(i.store.menuId),this._lang.set(i.store.mainLang);let o=l(a({},i),{sub_categories:i.sub_categories.map(r=>l(a({},r),{items:i.items.filter(n=>!n.hide&&n.subcategoryId===r._id).sort((n,y)=>n.order-y.order)})).filter(r=>!r.hide&&r.items.length).sort((r,n)=>r.order-n.order)});this._menu.set(o),this._lang.set(i.store.mainLang??"en")}}else this._router.navigateByUrl("")},error:()=>{this._router.navigateByUrl("")},complete:()=>{this._loading$.next(!1)}});return}this._networkService.getAssets("assets/json/mock-data.json").pipe(g(1)).subscribe({next:s=>{this._lang.set(s.store.mainLang);let i=l(a({},s),{store:l(a({},s.store),{templateId:e}),sub_categories:s.sub_categories.map(o=>l(a({},o),{items:s.items.filter(r=>!r.hide&&r.subcategoryId===o._id).sort((r,n)=>r.order-n.order)})).filter(o=>!o.hide&&o.items.length).sort((o,r)=>o.order-r.order)});this._menu.set(i),this._lang.set(s.store.mainLang)},error:()=>{this._router.navigateByUrl("")},complete:()=>{this._loading$.next(!1)}})}else this._router.navigateByUrl("")})}changeLang(t){t&&this._lang.set(t)}_callLogApi(t){return m(this,null,function*(){let e=new Date().getTime(),s=localStorage.getItem(t);try{if(s){let i=Number(s);if(e-i<18e5)return}yield fetch(v+d.LOGS.logs,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(this._sendLogData(t))}),localStorage.setItem(t,e.toString())}catch(i){console.log(i)}})}_sendLogData(t){let e=localStorage.getItem("uuid");return e||(e=this._generateUUID(),localStorage.setItem("uuid",e)),{uuid:e,screenWidth:window.screen.width,screenHeight:window.screen.height,deviceOrientation:screen.orientation.type,service:t}}_generateUUID(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){let e=Math.random()*16|0;return(t==="x"?e:e&3|8).toString(16)})}static{this.\u0275fac=function(e){return new(e||c)}}static{this.\u0275prov=_({token:c,factory:c.\u0275fac,providedIn:"root"})}}return c})();export{$ as a};
