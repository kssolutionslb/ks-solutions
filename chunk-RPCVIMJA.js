import{a as _}from"./chunk-7YJWRT5B.js";import{a as X}from"./chunk-72TK6UK2.js";import{M as z,aa as K,da as J,ia as Q,ka as G,na as H,ta as W}from"./chunk-XXZS4MWG.js";import"./chunk-CARY4E7O.js";import"./chunk-4KKA7PE6.js";import{Ab as h,Fc as P,Hc as F,Ib as c,N as d,Ob as w,Pb as L,Rb as j,Sb as q,Tb as o,Ub as i,Vb as l,Vc as $,Zb as S,a as M,ac as y,b as I,cc as u,db as O,ea as T,ib as r,ka as x,kd as N,n as D,nc as a,oa as U,oc as f,pc as v,tb as C,vc as V,wc as R,xc as m,ya as g,yc as E,za as b,zc as B}from"./chunk-VO6IE2C5.js";var A=(()=>{class t{constructor(){this._networkService=x(J),this.user=C({email:"",name:"",roles:[],password:"",passwordRetries:0,_id:""})}changePassword(e,n){return this._networkService.post(_.USER.changePassword,{newPassword:e,oldPassword:n})}enable2Fa(){return this._networkService.post(_.USER.enable2FA,{})}disable2Fa(e){return this._networkService.post(_.USER.disable2FA,{token:e})}verify2Fa(e){return this._networkService.post(_.USER.verify2FA,{token:e})}getLoggedInUser(){this._networkService.get(_.USER.loggedInUser).pipe(d(1)).subscribe(e=>{e?.data&&this.user.set(e.data)})}deleteTrustedDevice(e){this._networkService.delete(_.USER.trustedDevices,{_id:e}).pipe(d(1)).subscribe(n=>{n?.data&&this.user.update(s=>I(M({},s),{trustedDevices:n.data}))})}static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275prov=T({token:t,factory:t.\u0275fac})}}return t})();var Z=()=>({icon:"icon_mail"}),ee=()=>({icon:"icon_calendar"}),te=()=>({icon:"icon_valid",size:"sm"}),ie=()=>({text:"Disable 2FA"}),ne=t=>({label:t,color:"warn",matType:"mat-flat-button",addClass:"rounded-2 w-100 w-md-auto"}),oe=()=>({icon:"icon_warning_triangle",size:"sm"}),re=()=>({text:"Verify & Activate"}),ae=t=>({label:t,matType:"mat-flat-button",addClass:"rounded-2 w-100 w-md-auto"}),se=()=>({text:"Enable 2FA"}),ce=t=>({label:t,addClass:"rounded-2 w-100 w-md-auto",matType:"mat-flat-button"}),de=()=>({text:"Remove"}),le=()=>({icon:"icon_delete"}),pe=(t,p)=>({label:t,color:"warn",matType:"mat-icon-button",prefixIcon:p});function me(t,p){if(t&1){let e=S();o(0,"p",21),l(1,"ks-base-icon",10),a(2," 2FA is enabled "),i(),o(3,"ks-base-button",22),y("onClick",function(){g(e);let s=u(2);return b(s.disable2FA())}),i()}t&2&&(r(),c("config",m(2,te)),r(2),c("config",E(4,ne,m(3,ie))))}function ue(t,p){if(t&1){let e=S();o(0,"div",24)(1,"p"),a(2,"Scan the QR code with your Authenticator App:"),i(),l(3,"img",25),o(4,"div",24)(5,"ks-base-button",22),y("onClick",function(){g(e);let s=u(3);return b(s.verify2FA())}),i()()()}if(t&2){let e=u(3);r(3),c("src",e.qrCode(),O),r(2),c("config",E(3,ae,m(2,re)))}}function fe(t,p){if(t&1){let e=S();o(0,"ks-base-button",22),y("onClick",function(){g(e);let s=u(3);return b(s.enable2FA())}),i()}t&2&&c("config",E(2,ce,m(1,se)))}function _e(t,p){if(t&1&&(o(0,"p",23),l(1,"ks-base-icon",10),a(2," 2FA is not enabled "),i(),h(3,ue,6,5,"div",24)(4,fe,1,4,"ks-base-button",10)),t&2){let e=u(2);r(),c("config",m(2,oe)),r(2),w(e.qrCode()?3:4)}}function xe(t,p){if(t&1){let e=S();o(0,"div",27)(1,"div")(2,"div")(3,"strong"),a(4,"OS:"),i(),a(5),i(),o(6,"div")(7,"strong"),a(8,"Type:"),i(),a(9),i(),o(10,"div")(11,"strong"),a(12,"Browser:"),i(),a(13),i(),o(14,"div")(15,"strong"),a(16,"First Used At:"),i(),a(17),P(18,"date"),i(),o(19,"div")(20,"strong"),a(21,"Last Used At:"),i(),a(22),P(23,"date"),i()(),o(24,"div",28)(25,"ks-base-button",22),y("onClick",function(){let s=g(e).$implicit,k=u(3);return b(k.removeDevice(s._id))}),i()()()}if(t&2){let e=p.$implicit;r(5),v(" ",e.deviceDetails.os," "),r(4),v(" ",e.deviceDetails.type," "),r(4),v(" ",e.deviceDetails.browser," "),r(4),v(" ",F(18,6,e.createdAt,"EEEE d MMMM y h:mm a")," "),r(5),v(" ",F(23,9,e.updatedAt,"EEEE d MMMM y h:mm a")," "),r(3),c("config",B(14,pe,m(12,de),m(13,le)))}}function ve(t,p){if(t&1&&(l(0,"hr",14),o(1,"div",15)(2,"div",26)(3,"h3",16),a(4,"Trusted Devices"),i(),j(5,xe,26,17,"div",27,L),i()()),t&2){let e=u();r(5),q(e.trustedDevices)}}function ge(t,p){if(t&1&&(o(0,"div",1)(1,"div",2)(2,"div",3)(3,"span"),a(4),i()(),o(5,"div",4)(6,"h3",5),a(7),i(),o(8,"p",6),a(9),i()()(),o(10,"div",7)(11,"div",8)(12,"div",9),l(13,"ks-base-icon",10),o(14,"div")(15,"div",11),a(16,"Email"),i(),o(17,"p",12),a(18),i()()()(),o(19,"div",8)(20,"div",9),l(21,"ks-base-icon",10),o(22,"div")(23,"div",11),a(24,"Joined At"),i(),o(25,"p",13),a(26),P(27,"date"),i()()()()(),l(28,"hr",14),o(29,"div",15)(30,"h5",16),a(31,"Two-Factor Authentication (2FA)"),i(),h(32,me,4,6)(33,_e,5,3),i(),h(34,ve,7,0),l(35,"hr",14),o(36,"div",17)(37,"div",18)(38,"h5",16),a(39,"Change Password"),i(),o(40,"div"),l(41,"ks-dynamic-form",19),i(),o(42,"div",20),a(43),i(),l(44,"ks-base-button",10),i()()()),t&2){let e=p,n=u();r(4),f(n.avatar()),r(3),f(e.name),r(2),f(e.roleNames),r(4),c("config",m(16,Z)),r(5),f(e.email),r(3),c("config",m(17,ee)),r(5),f(F(27,13,e.createdAt,"EEEE d MMMM y")),r(6),w(e.twoFactorEnabled?32:33),r(2),w(e.trustedDevices!=null&&e.trustedDevices.length?34:-1),r(7),c("config",n.formConfig)("action$",n.action$),r(2),f(n.error()),r(),c("config",n.saveConfig)}}var Oe=(()=>{class t{constructor(){this._dialog=x(K),this._profileService=x(A),this._navService=x(X),this.error=C(""),this.qrCode=C(""),this.user=this._profileService.user,this.avatar=$(()=>this.user()?.name?.split(/\s+/).map(e=>e[0]?.toUpperCase()).join("")||""),this.saveConfig={label:{text:"Save"},prefixIcon:{icon:"icon_save"},addClass:"rounded-2",matType:"mat-flat-button",onClick:()=>{this.action$.next("save")},id:"save"},this.action$=new D,this.formConfig={fields:[{label:{text:"Old Password"},type:"password",name:"oldPassword",required:!0},{label:{text:"new Password"},type:"password",name:"newPassword",required:!0,extraValidators:[Q({forceLowerCase:!0,forceNumbers:!0,forceSpecialCharacters:!0,forceUppercase:!0,maxLength:20,minLength:4,preventSpace:!0})]},{label:{text:"Confirm Password"},type:"password",name:"confirmPassword",required:!0}],onSave:e=>{e&&e.newPassword&&e.newPassword&&(e.newPassword!==e.confirmPassword?this.error.set("Confirm password does not match the new password!"):(this.error.set(""),this._profileService.changePassword(e.newPassword,e.oldPassword).pipe(d(1)).subscribe(n=>{n&&this.action$.next("clear")})))}}}ngOnInit(){this._profileService.getLoggedInUser(),this._navService.updateNav({title:"Profile",show:!1,back:!1})}removeDevice(e){let n={title:{text:"Confirm Delete"},message:{text:"Are you sure you want to remove this device?"}};this._dialog.openConfirmPopup(n).afterClosed().pipe(d(1)).subscribe(s=>{s&&this._profileService.deleteTrustedDevice(e)})}enable2FA(){this._profileService.enable2Fa().pipe(d(1)).subscribe(e=>{e.data&&this.qrCode.set(e.data)})}disable2FA(){let e={title:{text:"Disable 2FA"},form:{fields:[{label:{text:"Authenticator Code"},type:"text",name:"token",required:!0,minLength:6,maxLength:8,onlyNumeric:!0}]}};this._dialog.openFormPopup(e,"500px").afterClosed().pipe(d(1)).subscribe(n=>{n?.token&&this._profileService.disable2Fa(n.token).pipe(d(1)).subscribe(s=>{s&&this._profileService.getLoggedInUser()})})}verify2FA(){let e={title:{text:"Verify 2FA"},form:{fields:[{label:{text:"Authenticator Code"},type:"text",name:"token",required:!0,minLength:6,maxLength:8,onlyNumeric:!0}]}};this._dialog.openFormPopup(e,"500px").afterClosed().pipe(d(1)).subscribe(n=>{n?.token&&this._profileService.verify2Fa(n.token).pipe(d(1)).subscribe(s=>{s&&this._profileService.getLoggedInUser()})})}static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275cmp=U({type:t,selectors:[["ks-solutions-profile"]],standalone:!0,features:[V([A]),R],decls:2,vars:1,consts:[[1,"container"],[1,"m-auto","p-3","p-4",2,"max-width","1000px"],[1,"profile-header","d-flex","align-items-center","gap-4","mb-4","flex-wrap"],[1,"avatar"],[1,"user-details","text-center","text-md-start"],[1,"mb-1"],[1,"text-muted","text-break"],[1,"row","g-3"],[1,"col-12","col-md-6"],[1,"info-box"],[3,"config"],[1,"info-label"],[1,"info-text","text-break"],[1,"info-text"],[1,"my-4"],[1,"glassmorphism-box","text-center","p-4"],[1,"mb-3"],[1,"text-center"],[1,"glassmorphism-box","mx-auto","p-4"],[3,"config","action$"],[1,"text-danger","mb-3","small"],[1,"text-success","fw-bold","d-flex","align-items-center","justify-content-center","gap-2"],[3,"onClick","config"],[1,"text-warning","d-flex","align-items-center","justify-content-center","gap-2"],[1,"mt-3"],["alt","qrCode",1,"img-fluid","border","rounded","p-2","shadow-sm",3,"src"],[1,"trusted-devices"],[1,"row","border","rounded","mb-2","py-2",2,"display","grid","grid-template-columns","1fr auto"],[1,"d-flex","align-items-center","justify-content-center"]],template:function(n,s){if(n&1&&(o(0,"div",0),h(1,ge,45,18,"div",1),i()),n&2){let k;r(),w((k=s.user())?1:-1,k)}},dependencies:[z,G,H,W,N],styles:["[_nghost-%COMP%]{--card-background: rgb(125 125 125 / 5%);--card-shadow: 0 0px 6px rgba(0, 0, 0, .25)}.profile-header[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;text-align:center;flex-wrap:wrap}.avatar[_ngcontent-%COMP%]{width:80px;height:80px;border-radius:50%;background:linear-gradient(135deg,var(--primary-color),rgb(2,0,90));color:#fff;display:flex;justify-content:center;align-items:center;font-size:28px;font-weight:700;text-transform:uppercase;letter-spacing:3px}.user-details[_ngcontent-%COMP%]{flex:1}.info-box[_ngcontent-%COMP%]{display:flex;align-items:center;background:var(--card-background);box-shadow:var(--card-shadow);gap:12px;padding:12px;border-radius:8px}.info-label[_ngcontent-%COMP%]{font-size:12px;text-transform:uppercase}.info-text[_ngcontent-%COMP%]{font-size:16px;font-weight:500;margin:4px 0 0}.glassmorphism-box[_ngcontent-%COMP%]{border-radius:12px;-webkit-backdrop-filter:blur(15px);backdrop-filter:blur(15px);box-shadow:var(--card-shadow);padding:20px;background:var(--card-background)}@media (max-width: 768px){.profile-header[_ngcontent-%COMP%], .info-box[_ngcontent-%COMP%]{flex-direction:column;text-align:center}}"],changeDetection:0})}}return t})();export{Oe as ProfileComponent};
