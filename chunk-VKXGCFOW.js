import{a as g}from"./chunk-VMV3LQCJ.js";import{a as Q}from"./chunk-AOWBTXPG.js";import{D as $,E as c,K as N,M as V,_ as z,ba as L,ga as B,ia as J,la as K,ra as G}from"./chunk-6OZBD6B5.js";import"./chunk-CARY4E7O.js";import"./chunk-F5WOQGUX.js";import{$b as v,Fa as U,Hb as l,N as p,Nb as y,Oc as q,Sb as o,Tb as r,Ub as d,Yb as h,a as A,b as E,bc as b,db as T,ea as D,hb as a,ka as m,mc as s,n as I,nc as u,o as O,oa as M,sb as S,uc as R,vc as j,wc as f,xc as C,ya as _,za as w,zb as k}from"./chunk-RQMRH3XI.js";var P=(()=>{class t{constructor(){this._networkService=m(L),this.user=new O(null)}changePassword(e,i){return this._networkService.post(g.USER.changePassword,{newPassword:e,oldPassword:i})}enable2Fa(){return this._networkService.post(g.USER.enable2FA,{})}disable2Fa(e){return this._networkService.post(g.USER.disable2FA,{token:e})}verify2Fa(e){return this._networkService.post(g.USER.verify2FA,{token:e})}getLoggedInUser(){this._networkService.get(g.USER.loggedInUser).pipe(p(1)).subscribe(e=>{e?.data&&this.user.next(e.data)})}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=D({token:t,factory:t.\u0275fac})}}return t})();var ee=()=>({icon:"icon_mail"}),te=()=>({icon:"icon_calendar"}),ne=()=>({icon:"icon_valid",size:"sm"}),ie=()=>({text:"Disable 2FA"}),oe=t=>({label:t,color:"warn",matType:"mat-flat-button",addClass:"rounded-2 w-100 w-md-auto"}),re=()=>({icon:"icon_warning_triangle",size:"sm"}),ae=()=>({text:"Verify & Activate"}),se=t=>({label:t,matType:"mat-flat-button",addClass:"rounded-2 w-100 w-md-auto"}),ce=()=>({text:"Enable 2FA"}),le=t=>({label:t,addClass:"rounded-2 w-100 w-md-auto",matType:"mat-flat-button"});function de(t,F){if(t&1){let e=h();o(0,"p",21),d(1,"ks-base-icon",10),s(2," 2FA is enabled "),r(),o(3,"ks-base-button",22),v("onClick",function(){_(e);let n=b();return w(n.disable2FA())}),r()}t&2&&(a(),l("config",f(2,ne)),a(2),l("config",C(4,oe,f(3,ie))))}function pe(t,F){if(t&1){let e=h();o(0,"div",24)(1,"p"),s(2,"Scan the QR code with your Authenticator App:"),r(),d(3,"img",25),o(4,"div",24)(5,"ks-base-button",22),v("onClick",function(){_(e);let n=b(2);return w(n.verify2FA())}),r()()()}if(t&2){let e=b(2);a(3),l("src",e.qrCode(),T),a(2),l("config",C(3,se,f(2,ae)))}}function me(t,F){if(t&1){let e=h();o(0,"ks-base-button",22),v("onClick",function(){_(e);let n=b(2);return w(n.enable2FA())}),r()}t&2&&l("config",C(2,le,f(1,ce)))}function fe(t,F){if(t&1&&(o(0,"p",23),d(1,"ks-base-icon",10),s(2," 2FA is not enabled "),r(),k(3,pe,6,5,"div",24)(4,me,1,4,"ks-base-button",10)),t&2){let e=b();a(),l("config",f(2,re)),a(2),y(e.qrCode()?3:4)}}var Ee=(()=>{class t{constructor(){this._destroyRef=m(U),this._cdr=m(q),this._dialog=m(z),this._profileService=m(P),this._navService=m(Q),this.error=S(""),this.qrCode=S(""),this.userForm=new $({_id:new c(""),name:new c(""),role:new c(""),email:new c(""),password:new c(""),passwordRetries:new c(""),active:new c(""),isDeleted:new c(""),twoFactorEnabled:new c(""),isOAuthUser:new c(""),createdAt:new c(""),suspended:new c("")}),this.saveConfig={label:{text:"Save"},prefixIcon:{icon:"icon_save"},addClass:"rounded-2",matType:"mat-flat-button",onClick:()=>{this.action$.next("save")},id:"save"},this.action$=new I,this.formConfig={fields:[{label:{text:"Old Password"},type:"password",name:"oldPassword",required:!0},{label:{text:"new Password"},type:"password",name:"newPassword",required:!0,extraValidators:[B({forceLowerCase:!0,forceNumbers:!0,forceSpecialCharacters:!0,forceUppercase:!0,maxLength:20,minLength:4,preventSpace:!0})]},{label:{text:"Confirm Password"},type:"password",name:"confirmPassword",required:!0}],onSave:e=>{e&&e.newPassword&&e.newPassword&&(e.newPassword!==e.confirmPassword?this.error.set("Confirm password does not match the new password!"):(this.error.set(""),this._profileService.changePassword(e.newPassword,e.oldPassword).pipe(p(1)).subscribe(i=>{i&&this.action$.next("clear")})))}}}ngOnInit(){this._profileService.getLoggedInUser(),this._profileService.user.pipe(V(this._destroyRef)).subscribe(e=>{if(e){let i=x=>{let Y=new Intl.DateTimeFormat("en-US",{weekday:"long"}).format(x),H=x.getDate(),W=new Intl.DateTimeFormat("en-US",{month:"long"}).format(x),X=x.getFullYear();return`${Y} ${H} ${W} ${X}`},n=new Date(e.createdAt);this.userForm.patchValue(E(A({},e),{createdAt:i(n)})),this._cdr.markForCheck()}}),this._navService.updateNav({title:"Profile",show:!1,back:!1})}enable2FA(){this._profileService.enable2Fa().pipe(p(1)).subscribe(e=>{e.data&&this.qrCode.set(e.data)})}disable2FA(){let e={title:{text:"Disable 2FA"},form:{fields:[{label:{text:"Authenticator Code"},type:"number",name:"token",required:!0}]}};this._dialog.openFormPopup(e,"500px").afterClosed().pipe(p(1)).subscribe(i=>{i?.token&&this._profileService.disable2Fa(JSON.stringify(i.token)).pipe(p(1)).subscribe(n=>{n&&this._profileService.getLoggedInUser()})})}verify2FA(){let e={title:{text:"Verify 2FA"},form:{fields:[{label:{text:"Authenticator Code"},type:"number",name:"token",required:!0}]}};this._dialog.openFormPopup(e,"500px").afterClosed().pipe(p(1)).subscribe(i=>{i?.token&&this._profileService.verify2Fa(JSON.stringify(i.token)).pipe(p(1)).subscribe(n=>{n&&this._profileService.getLoggedInUser()})})}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=M({type:t,selectors:[["ks-solutions-profile"]],standalone:!0,features:[R([P]),j],decls:44,vars:14,consts:[[1,"container"],[1,"profile-card","shadow-lg","p-4"],[1,"profile-header","d-flex","align-items-center","gap-4","mb-4","flex-wrap"],[1,"avatar"],[1,"user-details","text-center","text-md-start"],[1,"mb-1"],[1,"text-muted","text-break"],[1,"row","g-3"],[1,"col-12","col-md-6"],[1,"info-box"],[3,"config"],[1,"info-label"],[1,"info-text","text-break"],[1,"info-text"],[1,"my-4"],[1,"glassmorphism-box","text-center","p-4"],[1,"mb-3"],[1,"text-center"],[1,"glassmorphism-box","mx-auto","p-4","change-password"],[3,"config","action$"],[1,"text-danger","mb-3","small"],[1,"text-success","fw-bold","d-flex","align-items-center","justify-content-center","gap-2"],[3,"onClick","config"],[1,"text-warning","d-flex","align-items-center","justify-content-center","gap-2"],[1,"mt-3"],["alt","qrCode",1,"img-fluid","border","rounded","p-2","shadow-sm",3,"src"]],template:function(i,n){i&1&&(o(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"span"),s(5),r()(),o(6,"div",4)(7,"h3",5),s(8),r(),o(9,"p",6),s(10),r()()(),o(11,"div",7)(12,"div",8)(13,"div",9),d(14,"ks-base-icon",10),o(15,"div")(16,"div",11),s(17,"Email"),r(),o(18,"p",12),s(19),r()()()(),o(20,"div",8)(21,"div",9),d(22,"ks-base-icon",10),o(23,"div")(24,"div",11),s(25,"Joined At"),r(),o(26,"p",13),s(27),r()()()()(),d(28,"hr",14),o(29,"div",15)(30,"h5",16),s(31,"Two-Factor Authentication (2FA)"),r(),k(32,de,4,6)(33,fe,5,3),r(),d(34,"hr",14),o(35,"div",17)(36,"div",18)(37,"h4",16),s(38,"Change Password"),r(),o(39,"div"),d(40,"ks-dynamic-form",19),r(),o(41,"div",20),s(42),r(),d(43,"ks-base-button",10),r()()()()),i&2&&(a(5),u(n.userForm.controls.name.value==null?null:n.userForm.controls.name.value[0]),a(3),u(n.userForm.controls.name.value),a(2),u(n.userForm.controls.role.value),a(4),l("config",f(12,ee)),a(5),u(n.userForm.controls.email.value),a(3),l("config",f(13,te)),a(5),u(n.userForm.controls.createdAt.value),a(5),y(n.userForm.controls.twoFactorEnabled.value?32:33),a(8),l("config",n.formConfig)("action$",n.action$),a(2),u(n.error()),a(),l("config",n.saveConfig))},dependencies:[N,J,K,G],styles:[".profile-card[_ngcontent-%COMP%]{background:#ffffff1a;border-radius:16px;-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);padding:20px;max-width:1000px;margin:auto}.profile-header[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;text-align:center;flex-wrap:wrap}.avatar[_ngcontent-%COMP%]{width:80px;height:80px;border-radius:50%;background:linear-gradient(135deg,#6a11cb,#2575fc);display:flex;justify-content:center;align-items:center;font-size:28px;font-weight:700}.user-details[_ngcontent-%COMP%]{flex:1}.info-box[_ngcontent-%COMP%]{display:flex;align-items:center;background:#ffffff0d;box-shadow:0 0 6px #0000001a;gap:12px;padding:12px;border-radius:8px}.icon[_ngcontent-%COMP%]{font-size:24px;color:#6a11cb}.info-label[_ngcontent-%COMP%]{font-size:12px;text-transform:uppercase}.info-text[_ngcontent-%COMP%]{font-size:16px;font-weight:600;margin:4px 0 0}.glassmorphism-box[_ngcontent-%COMP%]{border-radius:12px;-webkit-backdrop-filter:blur(15px);backdrop-filter:blur(15px);box-shadow:0 0 6px #0000001a;padding:20px}@media (max-width: 768px){.profile-header[_ngcontent-%COMP%], .info-box[_ngcontent-%COMP%]{flex-direction:column;text-align:center}.icon[_ngcontent-%COMP%]{margin-bottom:5px}.change-password[_ngcontent-%COMP%]{width:100%}.w-100[_ngcontent-%COMP%]{width:100%!important}}"],changeDetection:0})}}return t})();export{Ee as ProfileComponent};
