import{a as d}from"./chunk-IXTZP2PS.js";import{a as G}from"./chunk-JHOHYJWD.js";import{a as I}from"./chunk-WXUQAWQR.js";import{a}from"./chunk-O4Z7XCTG.js";import{a as j}from"./chunk-EYMYV4JT.js";import"./chunk-HMNUYURD.js";import{a as H}from"./chunk-DGQRDBDH.js";import{$ as E,P as T,ba as R,ea as $,ga as F,wa as N}from"./chunk-YIOKFAT3.js";import"./chunk-CARY4E7O.js";import"./chunk-WLEIZKK2.js";import{Bb as C,Fa as x,Jb as b,N as r,Pb as L,Ub as w,Vb as P,Wc as A,_b as y,bc as v,dc as c,ea as u,ka as o,n as m,o as p,oa as g,u as f,ub as l,v as n,wc as D,xc as k,ya as _,za as S}from"./chunk-E5CLUL7I.js";var h=(()=>{class i{constructor(){this._networkService=o($),this._carPlatesLogs$=new p([]),this.carPlatesLogs$=this._carPlatesLogs$.asObservable()}getAllSearchCarPlatesLogs(t){this._networkService.post(a.CARS_PLATES_LOGS.search,t).pipe(r(1)).subscribe({next:e=>{e&&e.data&&this._carPlatesLogs$.next(e.data)}})}deleteCarPlatesLogs(t){this._networkService.delete(a.CARS_PLATES_LOGS.logs,void 0,t._id).pipe(r(1)).subscribe({next:()=>{this._updateLogs(t,"delete")}})}deleteSelectedCarPlatesLogs(t){this._networkService.delete(a.CARS_PLATES_LOGS.selectedLogs,{ids:t.map(e=>e._id)}).pipe(r(1)).subscribe({next:()=>{this._updateLogs(t,"delete")}})}_updateLogs(t,e){G.UpdateArrayBehaviorSubject(this._carPlatesLogs$,t,e,"_id")}static{this.\u0275fac=function(e){return new(e||i)}}static{this.\u0275prov=u({token:i,factory:i.\u0275fac})}}return i})();function V(i,W){if(i&1){let t=y();w(0,"ks-basic-grid",1),v("selectionChange",function(s){_(t);let O=c();return S(O.selectionChange(s))}),P()}if(i&2){let t=c();b("config",t.gridConfig)("refresh$",t.refresh$)}}var le=(()=>{class i{constructor(){this._destroyRef=o(x),this._navService=o(H),this._dialog=o(R),this._carPlatesLogsService=o(h),this._snackbar=o(F),this._data=[],this._currentScreen=j("cars_plates_logs"),this._showDeleteAll=l(!1),this._selectedLogs=[],this.refresh$=new m}ngOnInit(){this._navService.updateNav({show:!0,back:!1,title:this._currentScreen.screenName,buttons:[{label:{text:"Delete Selected"},prefixIcon:{icon:"icon_delete_filled"},show:A(()=>this._currentScreen.delete&&this._showDeleteAll()),onClick:()=>{this._deleteSelectedLogs()}},{label:{text:"Advance Search"},prefixIcon:{icon:"icon_search"},onClick:()=>{this._openSearch()},hide:!this._currentScreen.search}]}),this._carPlatesLogsService.getAllSearchCarPlatesLogs({fromDate:d("start"),toDate:d("end")}),this._initializeGrid(),this._carPlatesLogsService.carPlatesLogs$.pipe(T(this._destroyRef)).subscribe(t=>{this._data=t,this.refresh$.next({data:this._data})})}selectionChange(t){this._showDeleteAll.set(!!t.length),this._selectedLogs=t}_initializeGrid(){this.gridConfig={multiSelect:this._currentScreen.delete,data:l([]),defaultPagination:150,maxTableHeight:I.maxTableHeightWithSearch,noDataMessage:{text:"No logs Found"},features:{showSearch:!0},elevation:2,columns:[{field:"name",title:"Name",type:"string",extraStyles:{"min-width":"120px","max-width":"120px"}},{field:"plateNumber",title:"Plate",type:"string",extraStyles:{"min-width":"120px","max-width":"200px"}},{field:"plateSymbol",title:"Code",type:"string",extraStyles:{"min-width":"120px","max-width":"200px"}},{field:"resultsCount",title:"Count",type:"number",extraStyles:{"min-width":"120px","max-width":"200px"}},{field:"createdAt",title:"Time",type:"date",dateFormat:"dd/MM/yyyy - HH:mm:ss a",extraStyles:{"min-width":"120px","max-width":"120px"}},{field:"email",title:"Email",type:"string",extraStyles:{"min-width":"120px","max-width":"120px"}}],actionsColumn:{enabled:this._currentScreen.insert||this._currentScreen.delete,maxButtons:window.innerWidth<700?1:void 0,maxWidth:window.innerWidth<700?void 0:"110px",minWidth:window.innerWidth<700?void 0:"110px",buttons:[{prefixIcon:{icon:"icon_delete",color:"red"},label:{text:"Delete"},onClickFn:t=>this._deleteLog(t),isVisibleFn:()=>this._currentScreen.delete,matType:"mat-icon-button"}]}}}_openSearch(){if(!this._currentScreen.search)return;let t={title:{text:"Logs Search"},saveButton:{prefixIcon:{icon:"icon_search"},label:{text:"Search"},matType:"mat-stroked-button"},form:{fields:[{name:"fromDate",label:{text:"From Date"},type:"date",required:!0,formatTime:"start",range:{max:"toDate"}},{name:"toDate",label:{text:"To Date"},type:"date",range:{min:"fromDate"},required:!0,formatTime:"end"}]},beforeCloseObservable:e=>e.fromDate&&e.toDate&&!E.isValidDateRange(366,e.fromDate,e.toDate)?(this._snackbar.open({text:"Maximum allowed date gap is 1 year."},"error"),n(()=>"")):e.fromHour!==void 0&&e.toHour!==void 0&&e.fromHour>=e.toHour?(this._snackbar.open({text:"From hour should be smaller than to hour."},"error"),n(()=>"")):f(e)};this._dialog.openFormPopup(t,"800px").afterClosed().pipe(r(1)).subscribe(e=>{e&&this._carPlatesLogsService.getAllSearchCarPlatesLogs({fromDate:e.fromDate,toDate:e.toDate})})}_deleteLog(t){let e={title:{text:"Confirm Delete"},message:{text:"Are you sure you want to delete this log?"}};this._dialog.openConfirmPopup(e).afterClosed().pipe(r(1)).subscribe(s=>{s&&t&&t._id&&this._carPlatesLogsService.deleteCarPlatesLogs(t)})}_deleteSelectedLogs(){let t={title:{text:"Confirm Delete"},message:{text:"Are you sure you want to delete all selected logs?"}};this._dialog.openConfirmPopup(t).afterClosed().pipe(r(1)).subscribe(e=>{e&&this._carPlatesLogsService.deleteSelectedCarPlatesLogs(this._selectedLogs)})}static{this.\u0275fac=function(e){return new(e||i)}}static{this.\u0275cmp=g({type:i,selectors:[["ks-solutions-car-plates-logs-listing"]],standalone:!0,features:[D([h]),k],decls:1,vars:1,consts:[[3,"config","refresh$"],[3,"selectionChange","config","refresh$"]],template:function(e,s){e&1&&C(0,V,1,2,"ks-basic-grid",0),e&2&&L(s.gridConfig?0:-1)},dependencies:[N],changeDetection:0})}}return i})();export{le as CarPlatesLogsComponent};
