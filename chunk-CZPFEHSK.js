import{a as w}from"./chunk-NBTBCQQP.js";import{a as _}from"./chunk-7YJWRT5B.js";import{a as m}from"./chunk-HMNUYURD.js";import{da as v,ea as y}from"./chunk-VY5GT2Q6.js";import{m as S,o as b}from"./chunk-4KKA7PE6.js";import{N as u,a as c,b as g,ea as p,h as x,ka as l,o as f,tb as d}from"./chunk-VO6IE2C5.js";var A=(()=>{class h{constructor(){this._networkService=l(v),this._activatedRoute=l(S),this._storageService=l(y),this._router=l(b),this._menu=d(null),this._lang=d(void 0),this._loading$=new f(!0),this.menu=this._menu.asReadonly(),this.lang=this._lang.asReadonly(),this.loading$=this._loading$.asObservable(),this.selectedSectionSig=d(null)}getMenuData(){this._activatedRoute.params.pipe(u(1)).subscribe(t=>{if(t&&t.businessName){let e=t.businessName;if(this._loading$.next(!0),e.length>3){this._networkService.get(`${_.MENU.getMenuByEndpoint}/${e}`).pipe(u(1)).subscribe({next:r=>{if(r){let i=r.data;if(i){if(i.redirect){window.location.href=i.redirect;return}this._callLogApi(i.store.menuId),this._lang.set(i.store.mainLang);let s=g(c({},i),{sub_categories:i.sub_categories.map(n=>g(c({},n),{items:i.items.filter(o=>!o.hide&&o.subcategoryId===n._id).sort((o,L)=>o.order-L.order)})).filter(n=>!n.hide&&n.items.length).sort((n,o)=>n.order-o.order)});this._menu.set(s);let a=document.documentElement;Object.entries(i.templateConfig??{}).forEach(([n,o])=>{o&&typeof o=="string"&&a.style.setProperty(n,o)}),this._lang.set(i.store.mainLang??"en")}}else this._router.navigateByUrl("")},error:()=>{this._router.navigateByUrl("")},complete:()=>{this._loading$.next(!1)}});return}this._networkService.getAssets("assets/json/mock-data.json").pipe(u(1)).subscribe({next:r=>{this._lang.set(r.store.mainLang);let i=g(c({},r),{store:g(c({},r.store),{templateId:e}),sub_categories:r.sub_categories.map(s=>g(c({},s),{items:r.items.filter(a=>!a.hide&&a.subcategoryId===s._id).sort((a,n)=>a.order-n.order)})).filter(s=>!s.hide&&s.items.length).sort((s,a)=>s.order-a.order)});this._menu.set(i),this._lang.set(r.store.mainLang)},error:()=>{this._router.navigateByUrl("")},complete:()=>{this._loading$.next(!1)}})}else this._router.navigateByUrl("")})}changeLang(t){t&&this._lang.set(t)}_callLogApi(t){return x(this,null,function*(){let e=new Date().getTime(),r=this._storageService.getItem(m.LS.menuTrack)||{},i=r[t];try{if(i){let s=Number(i);if(e-s<18e5)return}yield fetch(w.API_HOST+_.LOGS.logs,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(this._sendLogData(t))}),r[t]=e.toString(),this._storageService.setItem(m.LS.menuTrack,r)}catch{}})}_sendLogData(t){let e=this._storageService.getItem(m.LS.uuid);return e||(e=this._generateUUID(),this._storageService.setItem(m.LS.uuid,e)),{uuid:e,screenWidth:window.screen.width,screenHeight:window.screen.height,deviceOrientation:screen.orientation.type,service:t}}_generateUUID(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){let e=Math.random()*16|0;return(t==="x"?e:e&3|8).toString(16)})}static{this.\u0275fac=function(e){return new(e||h)}}static{this.\u0275prov=p({token:h,factory:h.\u0275fac,providedIn:"root"})}}return h})();export{A as a};
