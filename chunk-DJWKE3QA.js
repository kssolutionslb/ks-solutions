import{a as p}from"./chunk-JHOHYJWD.js";import{a as E}from"./chunk-5BWCYXSX.js";import{a as ne}from"./chunk-MJ7DCTJM.js";import{a as k}from"./chunk-NZP3AJU7.js";import{a as T}from"./chunk-2OEIZLNB.js";import"./chunk-HMNUYURD.js";import{a as ie}from"./chunk-5LHP7IWU.js";import{F as Y,G as R,O as y,aa as w,ba as J,da as Q,la as X,ra as Z,sa as ee,ua as te,v as H,va as N,w as z}from"./chunk-7Y4QU53B.js";import"./chunk-CARY4E7O.js";import"./chunk-QLWHFAAO.js";import{$b as L,Fa as I,Hb as r,Ka as D,La as M,N as l,Nb as x,Sb as c,Tb as u,Ub as d,a as o,b as m,bc as b,ea as O,hb as s,ib as P,ka as a,mc as j,n as f,nc as q,o as h,oa as S,sb as g,uc as U,vc as C,wc as v,xc as K,yc as $,zb as _}from"./chunk-72DPVO72.js";var W=(()=>{class n{constructor(){this._networkService=a(Q),this._service$=new h([]),this.service$=this._service$.asObservable(),this.serviceValue$=this._service$}getAllServices(){this._networkService.get(k.SERVICES.service).pipe(l(1)).subscribe({next:e=>{e&&e.data&&this._service$.next(e.data)}})}addService(e){return this._networkService.post(k.SERVICES.service,e)}updateService(e){return this._networkService.patch(k.SERVICES.service,e,e._id)}deleteService(e){this._networkService.delete(k.SERVICES.service,void 0,e._id).pipe(l(1)).subscribe({next:()=>{this._updateServices(e,"delete")}})}_updateServices(e,i){p.UpdateArrayBehaviorSubject(this._service$,e,i,"_id")}static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275prov=O({token:n,factory:n.\u0275fac})}}return n})();var ae=()=>({text:"Configuration",tag:"h3",fontWeight:"500",case:"titlecase"}),se=()=>({text:"Expand Only One"}),G=(n,F)=>({control:n,label:F}),le=()=>({text:"Format Form Value"}),de=()=>({text:"Use Expansion Panel"}),pe=()=>({text:"Groups",tag:"h3",fontWeight:"500",case:"titlecase"}),ce=()=>({text:"Fields",tag:"h3",fontWeight:"500",case:"titlecase"});function ue(n,F){if(n&1&&d(0,"ks-base-label",3)(1,"ks-basic-grid",7),n&2){let e=b();r("config",v(3,pe)),s(),r("config",e.groupsGridConfig)("refresh$",e.groupsRefresh$)}}function me(n,F){if(n&1&&d(0,"ks-base-label",3)(1,"ks-basic-grid",7),n&2){let e=b();r("config",v(3,ce)),s(),r("config",e.fieldsGridConfig)("refresh$",e.fieldsRefresh$)}}var re=(()=>{class n{constructor(){this._destroyRef=a(I),this._dialog=a(w),this._fields$=new h([]),this._groups$=new h([]),this.test=D(),this.save=D(),this.config=M.required(),this.fieldsRefresh$=new f,this.groupsRefresh$=new f,this.form=new Y({expandOnlyOne:new R(!1),formatFormValue:new R(!1),useExpansionPanel:new R(!1)})}ngOnInit(){this._initializeGrid(),this.config().stream.pipe(y(this._destroyRef)).subscribe(e=>{this.form.patchValue(e),this._groups$.next(e.groups?.map((i,t)=>m(o({},i),{__id:t+1,__name:i.name?.text}))||[]),this._fields$.next(e.fields?.map((i,t)=>m(o({},i),{__id:t+1,__label:i.label?.text,order:t+1})).sort((i,t)=>(i.order??0)-(t.order??0))||[])}),this.config().save$?.pipe(y(this._destroyRef)).subscribe(e=>{let i={expandOnlyOne:!!this.form.value.expandOnlyOne,formatFormValue:!!this.form.value.formatFormValue,useExpansionPanel:!!this.form.value.useExpansionPanel,fields:[]};i.fields=this._fields$.getValue().map(t=>(e==="save"&&(delete t.__id,delete t.__label,delete t.__options),t)).sort((t,A)=>(t.order??0)-(A.order??0)),i.groups=this._groups$.getValue().map(t=>(e==="save"&&(delete t.__id,delete t.__tag,delete t.__name,delete t.__addClass,delete t.__fontWeight),t)),e==="save"?this.save.emit(i):this.test.emit(i)})}ngAfterViewInit(){this._fields$.pipe(y(this._destroyRef)).subscribe(e=>{this.fieldsRefresh$.next({data:e})}),this._groups$.pipe(y(this._destroyRef)).subscribe(e=>{this.groupsRefresh$.next({data:e})})}_initializeGrid(){let e=this.config().currentScreen;this.fieldsGridConfig={data:g([]),defaultPagination:100,maxTableHeight:E.maxTableHeightWithSearch,noDataMessage:{text:"No Fields Found"},features:{showSearch:!0,showAddButton:!0,addButtonClicked:()=>this._openField()},elevation:2,columns:[{field:"name",title:"Name",type:"string",extraStyles:{"min-width":"100px"}},{field:"label.text",title:"Label",type:"string",extraStyles:{"min-width":"100px"}},{field:"type",title:"Type",type:"string",extraStyles:{"min-width":"100px"}},{field:"groupId",title:"Group Id",type:"number",extraStyles:{"min-width":"100px"}},{field:"order",title:"Order",type:"number",extraStyles:{"min-width":"100px"}},{field:"required",title:"Required",type:"chip",extraStyles:{"min-width":"100px"},truthy:{false:"No",true:"Yes"},setChipClass:i=>i.required===!0?"rounded rounded-5 px-3 py-1 text-bg-success cs-w-120":"rounded rounded-5 px-3 py-1 text-bg-danger cs-w-120"}],actionsColumn:{enabled:e.update||e.delete,maxButtons:window.innerWidth<700?1:void 0,width:window.innerWidth<700?void 0:"110px",maxWidth:window.innerWidth<700?void 0:"110px",minWidth:window.innerWidth<700?void 0:"110px",buttons:[{prefixIcon:{icon:"icon_edit"},label:{text:"Edit"},onClickFn:i=>this._openField(i),isVisibleFn:()=>e.update,matType:"mat-icon-button"},{prefixIcon:{icon:"icon_delete",color:"red"},label:{text:"Delete"},onClickFn:i=>this._deleteField(i),isVisibleFn:()=>e.delete,matType:"mat-icon-button"}]}},this.groupsGridConfig={data:g([]),defaultPagination:100,maxTableHeight:E.maxTableHeightWithSearch,noDataMessage:{text:"No Groups Found"},features:{showSearch:!0,showAddButton:!0,addButtonClicked:()=>this._openGroup()},elevation:2,columns:[{field:"name.text",title:"Name",type:"string",extraStyles:{"min-width":"100px"}},{field:"id",title:"Group Id",type:"number",extraStyles:{"min-width":"100px"}},{field:"order",title:"Order",type:"number",extraStyles:{"min-width":"100px"}},{field:"expanded",title:"Expanded",type:"chip",extraStyles:{"min-width":"100px"},truthy:{false:"No",true:"Yes"},setChipClass:i=>i.expanded===!0?"rounded rounded-5 px-3 py-1 text-bg-success cs-w-120":"rounded rounded-5 px-3 py-1 text-bg-danger cs-w-120"},{field:"name.tag",title:"Tag",type:"string",extraStyles:{"min-width":"100px"}},{field:"name.fontWeight",title:"Font Weight",type:"string",extraStyles:{"min-width":"100px"}},{field:"name.addClass",title:"Class",type:"string",extraStyles:{"min-width":"100px"}}],actionsColumn:{enabled:e.update||e.delete,maxButtons:window.innerWidth<700?1:void 0,width:window.innerWidth<700?void 0:"110px",maxWidth:window.innerWidth<700?void 0:"110px",minWidth:window.innerWidth<700?void 0:"110px",buttons:[{prefixIcon:{icon:"icon_edit"},label:{text:"Edit"},onClickFn:i=>this._openGroup(i),isVisibleFn:()=>e.update,matType:"mat-icon-button"},{prefixIcon:{icon:"icon_delete",color:"red"},label:{text:"Delete"},onClickFn:i=>this._deleteGroup(i),isVisibleFn:()=>e.delete,matType:"mat-icon-button"}]}}}_openField(e){let i={hideClearButton:!0,title:{text:e?"Edit Group":"Add Group"},form:{value:m(o({},e),{__label:e?.label?.text,__options:e?.options?JSON.stringify(e?.options):void 0}),fields:[{name:"name",type:"text",label:{text:"Name"},required:!0},{name:"__label",type:"text",label:{text:"Label"},required:!0},{name:"type",type:"select",label:{text:"Type"},required:!0,options:["text","number","date","password","color","textaria","checkbox","toggle","image","select","autocomplete"].map(t=>({name:t,value:t}))},{name:"groupId",label:{text:"Group"},type:"select",stream:this._groups$,transformer:{nameKey:"__name",valueKey:"id"}},{name:"order",label:{text:"Order"},type:"number",disableNegativeValues:!0,integer:!0},{name:"requiredParent",label:{text:"Required Parents"},type:"select",multiple:!0,stream:this._fields$,transformer:{nameKey:"__label",valueKey:"name"}},{name:"maxLength",label:{text:"Max Length"},type:"number",disableNegativeValues:!0,integer:!0},{name:"minLength",label:{text:"Min Length"},type:"number",disableNegativeValues:!0,integer:!0},{name:"maxSizeInMB",label:{text:"Max Size In MB"},type:"number",disableNegativeValues:!0},{name:"maxMonthFromRequired",label:{text:"Max Month From Required"},type:"number",disableNegativeValues:!0,integer:!0},{name:"__options",label:{text:"Options"},type:"textaria"},{name:"required",label:{text:"Required"},type:"toggle"},{name:"multiple",label:{text:"Multiple"},type:"toggle"},{name:"preventSpace",label:{text:"Prevent Space"},type:"toggle"},{name:"integer",label:{text:"Integer"},type:"toggle"},{name:"disableNegativeValues",label:{text:"Disable Negative Values"},type:"toggle"},{name:"hide",label:{text:"Hide"},type:"toggle"},{name:"readonly",label:{text:"Readonly"},type:"toggle"}]}};this._dialog.openFormPopup(i,"1300px").afterClosed().pipe(l(1)).subscribe(t=>{if(t){t.label={text:t.__label};try{t.options=JSON.parse(t.__options)}catch{t.options=e?.options}e?p.UpdateArrayBehaviorSubject(this._fields$,o(o({},e),t),"edit","__id"):(t.__id=new Date().getTime(),p.UpdateArrayBehaviorSubject(this._fields$,t,"add","__id"))}})}_deleteField(e){let i={title:{text:"Confirm Delete"},message:{text:"Are you sure you want to delete this field?"}};this._dialog.openConfirmPopup(i).afterClosed().pipe(l(1)).subscribe(t=>{t&&e?.name&&p.UpdateArrayBehaviorSubject(this._fields$,e,"delete","__id")})}_openGroup(e){let i={hideClearButton:!0,title:{text:e?"Edit Group":"Add Group"},form:{groups:[{id:1,name:{text:"Styling"},order:1}],value:m(o({},e),{__name:e?.name?.text,__tag:e?.name?.tag,__fontWeight:e?.name?.fontWeight,__addClass:e?.name.addClass}),fields:[{name:"__name",type:"text",label:{text:"Name"},required:!0},{name:"id",type:"number",label:{text:"Group Id"},required:!0},{name:"order",type:"number",label:{text:"Order"},required:!0},{name:"expanded",label:{text:"Expanded"},type:"toggle"},{name:"__tag",type:"select",label:{text:"Tag"},options:["h1","h2","h3","h4","p","small","span"].map(t=>({name:t,value:t})),groupId:1},{name:"__fontWeight",type:"select",label:{text:"Font Weight"},options:["400","500","600","700"].map(t=>({name:t,value:t})),groupId:1},{name:"__addClass",type:"text",label:{text:"Add Class"},groupId:1}]}};this._dialog.openFormPopup(i,"1000px").afterClosed().pipe(l(1)).subscribe(t=>{t&&(t.name={text:t.__name,tag:t.__tag,fontWeight:t.__fontWeight,addClass:t.__addClass},e?p.UpdateArrayBehaviorSubject(this._groups$,o(o({},e),t),"edit","__id"):(t.__id=new Date().getTime(),p.UpdateArrayBehaviorSubject(this._groups$,t,"add","__id")))})}_deleteGroup(e){let i={title:{text:"Confirm Delete"},message:{text:"Are you sure you want to delete this group?"}};this._dialog.openConfirmPopup(i).afterClosed().pipe(l(1)).subscribe(t=>{t&&e?.id&&p.UpdateArrayBehaviorSubject(this._groups$,e,"delete","__id")})}static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275cmp=S({type:n,selectors:[["kss-lib-form-builder"]],inputs:{config:[1,"config"]},outputs:{test:"test",save:"save"},standalone:!0,features:[C],decls:13,vars:19,consts:[[1,"container-fluid"],[1,"row"],[1,"col-12"],[3,"config"],[1,"col-12","mb-2"],[1,"col-12","col-sm-6","col-md-4","col-lg-3","mb-2",3,"config"],[1,"col-12","mb-4"],[3,"config","refresh$"]],template:function(i,t){i&1&&(c(0,"div",0)(1,"div",1)(2,"div",2),d(3,"ks-base-label",3),u(),c(4,"div",4)(5,"div",1),d(6,"ks-base-slide-toggle",5)(7,"ks-base-slide-toggle",5)(8,"ks-base-slide-toggle",5),u()(),c(9,"div",6),_(10,ue,2,4),u(),c(11,"div",2),_(12,me,2,4),u()()()),i&2&&(s(3),r("config",v(6,ae)),s(3),r("config",$(8,G,t.form.controls.expandOnlyOne,v(7,se))),s(),r("config",$(12,G,t.form.controls.formatFormValue,v(11,le))),s(),r("config",$(16,G,t.form.controls.useExpansionPanel,v(15,de))),s(2),x(t.groupsGridConfig?10:-1),s(2),x(t.fieldsGridConfig?12:-1))},dependencies:[N,X,ee],changeDetection:0})}}return n})();var fe=n=>({loading:n,disableInteractions:!0,position:"fixed"});function he(n,F){if(n&1&&d(0,"ks-loader-overlay",0),n&2){let e=b();r("config",K(1,fe,e.trueSignal))}}var oe=(()=>{class n{constructor(e,i){this._dialogRef=e,this.data=i,this._dialog=a(w),this._loaderService=a(J),this._currentScreen=T("services_listing"),this._save$=new f,this.trueSignal=g(!0),this.loading=this._loaderService.isLoading,this.cardConfig={header:{title:{text:"Service Settings",tag:"h3",fontWeight:"700"},position:"center",suffixButton:{label:{text:"Close"},matType:"mat-icon-button",prefixIcon:{icon:"icon_x_circle"},onClick:()=>{this._dialogRef.close()}}},content:{addClass:"card p-2"},footer:{buttons:this._currentScreen.update?[{label:{text:"Save"},matType:"mat-flat-button",prefixIcon:{icon:"icon_save"},onClick:()=>{this._save()}},{label:{text:"Test"},matType:"mat-stroked-button",onClick:()=>{this._test()}}]:[{label:{text:"Close"},onClick:()=>{this._dialogRef.close()},matType:"mat-flat-button"}],position:"center"}},this.config={save$:this._save$,currentScreen:T("menu_invoice"),stream:new h({fields:[]})}}ngAfterViewInit(){this.data?.service?.fields&&this.config.stream.next(this.data.service.fields)}onSave(e){this.data?.servicesService.updateService(m(o({},this.data.service),{fields:e})).pipe(l(1)).subscribe(i=>{i?.data&&(this.data?.servicesService._updateServices(i.data,"edit"),this._dialogRef.close())})}onTest(e){this._dialog.openFormPopup({title:{text:"Test"},form:e,hideClearButton:!0,saveButton:{label:{text:"Test Save"},matType:"mat-flat-button"}})}_save(){this._save$.next("save")}_test(){this._save$.next("test")}static{this.\u0275fac=function(i){return new(i||n)(P(H),P(z))}}static{this.\u0275cmp=S({type:n,selectors:[["ks-solutions-service-settings"]],standalone:!0,features:[C],decls:5,vars:4,consts:[[3,"config"],[1,"h3","text-center"],[3,"save","test","config"]],template:function(i,t){i&1&&(c(0,"ks-base-card",0)(1,"div",1),j(2),u(),c(3,"kss-lib-form-builder",2),L("save",function(B){return t.onSave(B)})("test",function(B){return t.onTest(B)}),u()(),_(4,he,1,3,"ks-loader-overlay",0)),i&2&&(r("config",t.cardConfig),s(2),q(t.data==null||t.data.service==null?null:t.data.service.name),s(),r("config",t.config),s(),x(t.loading()?4:-1))},dependencies:[Z,re,te],changeDetection:0})}}return n})();function ge(n,F){if(n&1&&d(0,"ks-basic-grid",0),n&2){let e=b();r("config",e.gridConfig)("refresh$",e.refresh$)}}var ot=(()=>{class n{constructor(){this._destroyRef=a(I),this._navService=a(ie),this._lovService=a(ne),this._dialog=a(w),this._servicesService=a(W),this._data=[],this._currentScreen=T("services_listing"),this.refresh$=new f}ngOnInit(){this._navService.updateNav({show:!0,back:!1,title:this._currentScreen.screenName,buttons:[{label:{text:"Create New"},prefixIcon:{icon:"icon_plus_circle"},hide:!this._currentScreen.insert,onClick:()=>{this._openService()}}]}),this._servicesService.getAllServices(),this._initializeGrid(),this._servicesService.service$.pipe(y(this._destroyRef)).subscribe(e=>{this._data=e,this.refresh$.next({data:this._data})})}_initializeGrid(){this.gridConfig={data:g([]),defaultPagination:100,maxTableHeight:E.maxTableHeightWithSearch,noDataMessage:{text:"No Items Found"},features:{showSearch:!0,trackChanges:!0},elevation:2,columns:[{field:"name",title:"Name",type:"string",extraStyles:{"min-width":"250px"}},{field:"type",title:"Service Type",type:"string",extraStyles:{"min-width":"150px"}},{field:"ownerId",title:"Owner",type:"select",stream:{name:"name",value:"_id",stream:this._lovService.userLov$},extraStyles:{"min-width":"120px"}},{field:"url",title:"Service Url",type:"string",extraStyles:{"min-width":"250px"}},{field:"viewLogs",title:"View Logs",type:"chip",extraStyles:{"min-width":"100px"},truthy:{false:"No",true:"Yes"},setChipClass:e=>e.viewLogs===!0?"rounded rounded-5 px-3 py-1 text-bg-success cs-w-120":"rounded rounded-5 px-3 py-1 text-bg-danger cs-w-120"},{field:"editable",title:"Editable",type:"chip",extraStyles:{"min-width":"100px"},truthy:{false:"No",true:"Yes"},setChipClass:e=>e.editable===!0?"rounded rounded-5 px-3 py-1 text-bg-success cs-w-120":"rounded rounded-5 px-3 py-1 text-bg-danger cs-w-120"},{field:"isExternal",title:"External",type:"chip",extraStyles:{"min-width":"100px"},truthy:{false:"No",true:"Yes"},setChipClass:e=>e.isExternal===!0?"rounded rounded-5 px-3 py-1 text-bg-success cs-w-120":"rounded rounded-5 px-3 py-1 text-bg-danger cs-w-120"},{field:"createdAt",title:"Created At",type:"date",dateFormat:"dd/MM/yyyy - HH:mm:ss a",extraStyles:{"min-width":"180px"}},{field:"expiresAt",title:"Expires At",type:"date",dateFormat:"dd/MM/yyyy",extraStyles:{"min-width":"100px","max-width":"100px"}}],actionsColumn:{enabled:this._currentScreen.update||this._currentScreen.delete,maxButtons:window.innerWidth<700?1:void 0,maxWidth:window.innerWidth<700?void 0:"160px",minWidth:window.innerWidth<700?void 0:"160px",buttons:[{prefixIcon:{icon:"icon_settings"},label:{text:"Settings"},onClickFn:e=>this._openServiceSettings(e),isVisibleFn:()=>this._currentScreen.update,matType:"mat-icon-button"},{prefixIcon:{icon:"icon_edit"},label:{text:"Edit"},onClickFn:e=>this._openService(e),isVisibleFn:()=>this._currentScreen.update,matType:"mat-icon-button"},{prefixIcon:{icon:"icon_delete",color:"red"},label:{text:"Delete"},onClickFn:e=>this._deleteService(e),isVisibleFn:()=>this._currentScreen.delete,matType:"mat-icon-button"}]}}}_openService(e){let i={title:{text:e?"Edit Service":"Add Service"},form:{value:e,groups:[{id:1,name:{text:"Credentials"},order:1}],fields:[{name:"name",type:"text",label:{text:"Service Name"},required:!0},{name:"type",type:"autocomplete",flexibleValue:!0,label:{text:"Service Type"},options:Array.from(new Set(this._servicesService.serviceValue$.value.map(t=>t.type))).map(t=>({name:t,value:t})),required:!0},{name:"url",type:"text",label:{text:"Service Url"},required:!0,minLength:4},{name:"ownerId",type:"autocomplete",label:{text:"Service Owner"},transformer:{nameKey:"name",valueKey:"_id"},stream:this._lovService.userLov$,required:!0},{name:"editorsId",type:"select",label:{text:"Editors"},transformer:{nameKey:"name",valueKey:"_id"},multiple:!0,stream:this._lovService.userLov$},{name:"expiresAt",type:"date",label:{text:"Expires At"},required:!0},{name:"viewLogs",type:"toggle",label:{text:"View Logs"}},{name:"editable",type:"toggle",label:{text:"Editable"}},{name:"isExternal",label:{text:"External"},type:"toggle"},{name:"githubRepo",label:{text:"Github Account"},type:"text",groupId:1},{name:"filePath",label:{text:"Github Repo Name"},type:"text",groupId:1},{name:"fileName",label:{text:"FilePath & File Name"},type:"text",groupId:1},{name:"fileTemplate",label:{text:"File Template"},type:"textaria",groupId:1}]},beforeCloseObservable:t=>e?this._servicesService.updateService(o(o({},e),t)):this._servicesService.addService(t),getAfterSuccessResponse:t=>{t.data&&this._servicesService._updateServices(t.data,e?"edit":"add")}};this._dialog.openFormPopup(i,"1000px")}_deleteService(e){let i={title:{text:"Confirm Delete"},message:{text:"Are you sure you want to delete this service?"}};this._dialog.openConfirmPopup(i).afterClosed().pipe(l(1)).subscribe(t=>{t&&e?._id&&this._servicesService.deleteService(e)})}_openServiceSettings(e){this._dialog.open(oe,{data:{servicesService:this._servicesService,service:e},width:"95vw",maxWidth:"100%"})}static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275cmp=S({type:n,selectors:[["ks-solutions-services-listing"]],standalone:!0,features:[U([W]),C],decls:1,vars:1,consts:[[3,"config","refresh$"]],template:function(i,t){i&1&&_(0,ge,1,2,"ks-basic-grid",0),i&2&&x(t.gridConfig?0:-1)},dependencies:[N],changeDetection:0})}}return n})();export{ot as ServiceComponent};
