import{a as h}from"./chunk-EDHW7UVH.js";import{a as q}from"./chunk-ERG5Z3O3.js";import{a as M}from"./chunk-V3RKPLKU.js";import{a as z}from"./chunk-O6Z6ZKPB.js";import"./chunk-5YWUWVK4.js";import{a as b}from"./chunk-DDY2ZFNV.js";import{L as K,V as G,Y as H,ja as Y}from"./chunk-E5MLKHCJ.js";import"./chunk-CARY4E7O.js";import"./chunk-ARNZMF2R.js";import{Dc as S,Ec as k,Fa as D,Fc as w,Hb as v,N as _,Nb as m,Ob as y,Qb as E,Rb as I,Sb as r,Tb as a,Ub as O,a as x,bc as u,ea as N,gd as L,hb as s,id as j,ka as c,mc as d,n as F,oa as P,oc as g,pc as U,sb as C,tc as B,uc as A,vc as R,wc as f,x as T,zb as p}from"./chunk-42PURYOY.js";var $=(()=>{class e{constructor(){this._navbarService=c(b),this._networkService=c(H),this._menu$=new F,this._menuId="",this.menu$=this._menu$.asObservable()}updateMenuData(t){this._networkService.patch(M.MENU_SETTINGS.updateFile,{menuId:t}).pipe(_(1)).subscribe()}updateMenu(t){return this._networkService.patch(M.MENU_PANEL.menus,t,t._id)}getMenuById(t){this._networkService.get(M.MENU_SETTINGS.byMenuId,t).pipe(_(1)).subscribe({next:i=>{i?i.data&&(this._menu$.next(i.data),this._menuId=t):this._navbarService.navigateTo(h.LAYOUT.children.HOME.route)},error:()=>{this._navbarService.navigateTo(h.LAYOUT.children.HOME.route)}})}$update(){this.getMenuById(this._menuId)}static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275prov=N({token:e,factory:e.\u0275fac})}}return e})();var W=()=>({text:"Menu Template",translate:!1,addClass:"h4"}),J=e=>({title:e}),Q=e=>({header:e}),X=e=>({text:e,translate:!1});function Z(e,n){e&1&&(r(0,"p")(1,"strong"),d(2,"Menu Owner:"),a(),d(3),a()),e&2&&(s(3),g(" ",n," "))}function ee(e,n){if(e&1&&(r(0,"ks-base-card",0)(1,"div",3),p(2,Z,4,1,"p"),r(3,"p")(4,"strong"),d(5,"Created Date:"),a(),d(6),S(7,"date"),a(),r(8,"p")(9,"strong"),d(10,"Expiry Date:"),a(),d(11),S(12,"date"),a()()()),e&2){let t,i=u(),o=u();v("config",n),s(2),m((t=o.owner())?2:-1,t),s(4),g(" ",w(7,4,i.createdAt,"medium")," "),s(5),g(" ",w(12,7,i.expiresAt,"medium")," ")}}function te(e,n){if(e&1&&(r(0,"li",4),d(1),a()),e&2){let t=n.$implicit;s(),U("",t.name," (",t.email,")")}}function ie(e,n){if(e&1&&(r(0,"ul"),E(1,te,2,2,"li",4,y),a()),e&2){let t=u();s(),I(t)}}function ne(e,n){e&1&&(r(0,"div",2)(1,"p"),d(2,"This menu does not have any editors."),a()())}function oe(e,n){e&1&&p(0,ie,3,0,"ul")(1,ne,3,0,"div",2),e&2&&m(n.length?0:1)}function ae(e,n){if(e&1&&(r(0,"ks-base-card",0),p(1,oe,2,1),a()),e&2){let t,i=u(2);v("config",n),s(),m((t=i.editors())?1:-1,t)}}function re(e,n){if(e&1&&O(0,"ks-base-card",0),e&2){let t=n.$implicit;v("config",f(5,Q,f(3,J,f(1,X,t.name))))}}function se(e,n){if(e&1&&(E(0,re,1,7,"ks-base-card",0,y),S(2,"async")),e&2){let t=u(2);I(k(2,0,t.templates$))}}function de(e,n){e&1&&(r(0,"div",2)(1,"p"),d(2,"This menu is external and does not support template changes."),a()())}function ce(e,n){if(e&1&&(p(0,ee,13,10,"ks-base-card",0),r(1,"div",1),p(2,ae,2,2,"ks-base-card",0),a(),r(3,"ks-base-card",0),p(4,se,3,2)(5,de,3,0,"div",2),a()),e&2){let t,i,o=u();m((t=o.menuCard())?0:-1,t),s(2),m((i=o.editorsCard())?2:-1,i),s(),v("config",f(7,Q,f(5,J,R(4,W)))),s(),m(n.isExternal?5:4)}}var $e=(()=>{class e{constructor(){this._destroyRef=c(D),this._dialog=c(G),this._lovService=c(q),this._menuSettingsService=c($),this._navService=c(b),this.templates$=this._lovService.menuTemplatesLov$.pipe(T(t=>t.filter(i=>!i.isCustom))),this.menu$=this._menuSettingsService.menu$,this.currentScreen=z("menu_settings"),this.menuCard=C(void 0),this.editorsCard=C(void 0),this.editors=C([]),this.owner=C("")}ngOnInit(){this._lovService.getMenuTemplatesLov();let t=this._navService.readUrlParams().MenuId;this._navService.updateNav({show:!0,back:!0,title:this.currentScreen.screenName,buttons:[]}),t?this._menuSettingsService.getMenuById(t):this._navService.navigateTo(h.LAYOUT.children.HOME.route),this._menuSettingsService.menu$.pipe(K(this._destroyRef)).subscribe(i=>{this._lovService.userLov$.pipe(_(1)).subscribe(o=>{this.owner.set(o.find(l=>l._id===i.ownerId)?.name??""),this.editors.set(o.filter(l=>i.editorsId.includes(l._id)))}),this.editorsCard.set({header:{title:{text:"Menu Editors",addClass:"h4"},suffixButton:{label:{text:"Edit Editors"},matType:"mat-icon-button",prefixIcon:{icon:"icon_edit"},onClick:()=>{this._openMenu(i)}}}}),this.menuCard.set({header:{title:{text:i.name,translate:!1,tag:"h4"},position:"center"},footer:{buttons:[{label:{text:"Update Menu Data"},matType:"mat-flat-button",suffixIcon:{icon:"icon_refresh"},onClick:()=>{this._updateMenu(i)}},{label:{text:"Open Menu"},matType:"mat-flat-button",suffixIcon:{icon:"icon_arrow_right",size:"sm"},onClick:()=>{i.redirect&&i.activateRedirection?window.open(i.redirect,"_blank"):this._navService.navigateTo(h.MENUS.route+"/"+i.endpoint,{})}}],position:"end"}})})}_openMenu(t){let i={title:{text:"Editors"},form:{value:x({},t||{}),fields:[{name:"editorsId",type:"select",label:{text:"Editors"},stream:this._lovService.userLov$.pipe(T(o=>o.filter(l=>l._id!==t?.ownerId))),transformer:{nameKey:"name",valueKey:"_id"},multiple:!0}]},beforeCloseObservable:o=>this._menuSettingsService.updateMenu(x(x({},t),o)),getAfterSuccessResponse:o=>{o.data&&this._menuSettingsService.$update()}};this._dialog.openFormPopup(i,"500px")}_updateMenu(t){let i={title:{text:"Confirm Update"},message:{text:"Are you sure you want to update this menu? This will take 5 min to reflect the changes on the menu"}};this._dialog.openConfirmPopup(i).afterClosed().pipe(_(1)).subscribe(o=>{o&&this._menuSettingsService.updateMenu(t)})}static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275cmp=P({type:e,selectors:[["ks-solutions-menu-settings"]],standalone:!0,features:[B([$]),A],decls:2,vars:3,consts:[[3,"config"],[1,"my-3"],[1,"external-menu-info"],[1,"dates-section"],[1,"text-break"]],template:function(i,o){if(i&1&&(p(0,ce,6,9),S(1,"async")),i&2){let l;m((l=k(1,1,o.menu$))?0:-1,l)}},dependencies:[Y,L,j],styles:[".external-menu-info[_ngcontent-%COMP%]{font-size:16px;color:#6c757d}"],changeDetection:0})}}return e})();export{$e as MenuSettingsComponent};
