import{a as v}from"./chunk-U5RD573Z.js";import{a as I}from"./chunk-JDEWHVZM.js";import"./chunk-HMNUYURD.js";import{a as g}from"./chunk-VMV3LQCJ.js";import{a as X}from"./chunk-VL4WVYQ7.js";import{O as Y,aa as T,da as J,ra as P,v as K,va as Q,w as z}from"./chunk-OMSYFKJ3.js";import"./chunk-CARY4E7O.js";import"./chunk-Z72V5FLM.js";import{Dc as x,Ec as h,Fa as M,Fc as F,Hb as f,N as m,Nb as d,Ob as w,Qb as B,Rb as k,Sb as r,Tb as n,Ub as U,a as C,bc as c,bd as O,ea as R,gd as q,hb as i,ib as $,id as V,ka as _,kd as H,mc as a,n as A,nc as L,o as S,oa as E,oc as p,pc as W,sb as j,uc as G,vc as D,zb as u}from"./chunk-P5AQMEDB.js";var N=(()=>{class t{constructor(){this._networkService=_(J),this._cars$=new S([]),this.cars$=this._cars$.asObservable()}getCars(){this._networkService.get(g.CARS.cars).pipe(m(1)).subscribe(e=>{e.data&&this._cars$.next(e.data)})}addCar(e){return this._networkService.post(g.CARS.cars,e)}updateCar(e){return this._networkService.patch(g.CARS.cars,e,e._id)}deleteCar(e){this._networkService.delete(g.CARS.cars,e,e._id).pipe(m(1)).subscribe(o=>{o&&this.$updateCars(e,"delete")})}$updateCars(e,o){v.UpdateArrayBehaviorSubject(this._cars$,e,o)}static{this.\u0275fac=function(o){return new(o||t)}}static{this.\u0275prov=R({token:t,factory:t.\u0275fac})}}return t})();function ie(t,l){if(t&1&&U(0,"ks-basic-grid",1),t&2){let e=c();f("config",e.gridConfig)("refresh$",e.refresh$)}}var ee=(()=>{class t{constructor(e,o){this._dialogRef=e,this.data=o,this._destroyRef=_(M),this._dialog=_(T),this._currentScreen=I("cars_listing"),this._expense$=new S([]),this.refresh$=new A,this.cardConfig={header:{title:{text:"Car Expenses",tag:"h3",fontWeight:"700"},position:"center",suffixButton:{label:{text:"Close"},matType:"mat-icon-button",prefixIcon:{icon:"icon_x_circle"},onClick:()=>{this._dialogRef.close()}}},content:{addClass:"card p-2"},footer:{buttons:[this.data?.isReadonly?{label:{text:"Close"},onClick:()=>{this._dialogRef.close()},matType:"mat-flat-button"}:{label:{text:"Save"},matType:"mat-flat-button",prefixIcon:{icon:"icon_save"},onClick:()=>{this._save()}}],position:"center"}}}ngOnInit(){this._initializeGrid(),this._expense$.next(this.data?.expenses||[]),this._expense$.pipe(Y(this._destroyRef)).subscribe(e=>{this.refresh$.next({data:e})})}_initializeGrid(){this.gridConfig={data:j([]),defaultPagination:100,maxTableHeight:"calc(100dvh - 400px)",noDataMessage:{text:"This car has no expenses"},features:{showAddButton:!0,addButtonClicked:()=>{this._openExpensePopup()}},columns:[{field:"name",title:"Expense",type:"string",extraStyles:{"min-width":"150px"}},{field:"amount",title:"Amount",type:"number",extraStyles:{"min-width":"100px"}},{field:"isPayed",title:"Payed",type:"chip",extraStyles:{width:"120px"},position:"p-start",truthy:{false:"No",true:"Yes"},setChipClass:e=>e.isPayed===!0?"rounded rounded-5 px-3 py-1 text-bg-success cs-w-120":"rounded rounded-5 px-3 py-1 text-bg-danger cs-w-120"},{field:"date",title:"Date",type:"date",dateFormat:"dd/MM/yyyy",extraStyles:{"min-width":"100px"}},{field:"notes",title:"Notes",type:"string",extraStyles:{"min-width":"150px"}}],actionsColumn:{maxButtons:window.innerWidth<700?1:void 0,maxWidth:window.innerWidth<700?void 0:"110px",minWidth:window.innerWidth<700?void 0:"110px",enabled:this._currentScreen.update||this._currentScreen.delete,buttons:[{prefixIcon:{icon:"icon_edit"},label:{text:"Edit"},onClickFn:e=>this._openExpensePopup(e),isVisibleFn:()=>this._currentScreen.update,matType:"mat-icon-button"},{prefixIcon:{icon:"icon_delete",color:"red"},label:{text:"Delete"},onClickFn:e=>this._deleteExpense(e),isVisibleFn:()=>this._currentScreen.delete,matType:"mat-icon-button"}]}}}_openExpensePopup(e){let o={hideClearButton:!0,title:{text:e?"Edit Expense":"Add Expense"},form:{value:e,fields:[{name:"name",type:"text",label:{text:"Expense"},required:!0,maxLength:70,minLength:4},{name:"amount",label:{text:"Amount"},type:"number",required:!0},{name:"isPayed",label:{text:"Payed"},type:"toggle"},{name:"date",label:{text:"Date"},type:"date"},{name:"notes",label:{text:"Notes"},type:"textaria",maxLength:70}]}};this._dialog.openFormPopup(o,"500px").afterClosed().pipe(m(1)).subscribe(s=>{s&&(e?v.UpdateArrayBehaviorSubjectById(this._expense$,C(C({},e),s),"edit"):(s.id=new Date().getTime(),v.UpdateArrayBehaviorSubjectById(this._expense$,s,"add")))})}_deleteExpense(e){this._dialog.openConfirmPopup({title:{text:"Confirm Delete"},message:{text:"Are you sure you want to delete this Expense?"}}).afterClosed().pipe(m(1)).subscribe(o=>{o&&v.UpdateArrayBehaviorSubjectById(this._expense$,e,"delete")})}_save(){this._dialogRef.close(this._expense$.getValue())}static{this.\u0275fac=function(o){return new(o||t)($(K),$(z))}}static{this.\u0275cmp=E({type:t,selectors:[["ks-solutions-expenses-listing"]],standalone:!0,features:[D],decls:2,vars:2,consts:[[3,"config"],[3,"config","refresh$"]],template:function(o,s){o&1&&(r(0,"ks-base-card",0),u(1,ie,1,2,"ks-basic-grid",1),n()),o&2&&(f("config",s.cardConfig),i(),d(s.gridConfig?1:-1))},dependencies:[Q,P],changeDetection:0})}}return t})();function ne(t,l){if(t&1&&(r(0,"div",7)(1,"strong"),a(2,"Status:"),n(),r(3,"span",9),a(4),n()()),t&2){let e=c().$implicit;i(3),f("ngClass",e.isSold?"bg-success":"bg-warning"),i(),p(" ",e.isSold?"Sold":"Available"," ")}}function oe(t,l){if(t&1&&(r(0,"div",8)(1,"strong"),a(2,"Profit/Loss:"),n(),a(3),x(4,"currency"),n()),t&2){let e=c().$implicit;i(3),p(" ",h(4,1,e.pl)," ")}}function ae(t,l){if(t&1&&(r(0,"div",8)(1,"strong"),a(2,"Total Cost:"),n(),a(3),x(4,"currency"),n()),t&2){let e=c().$implicit;i(3),p(" ",h(4,1,e.totalCost)," ")}}function re(t,l){if(t&1&&(r(0,"div",8)(1,"strong"),a(2,"Bought At:"),n(),a(3),x(4,"date"),n()),t&2){let e=c().$implicit;i(3),p(" ",F(4,1,e.boughtDate,"dd MMM yyyy")," ")}}function le(t,l){if(t&1&&(r(0,"div",8)(1,"strong"),a(2,"Sold At:"),n(),a(3),x(4,"date"),n()),t&2){let e=c().$implicit;i(3),p(" ",F(4,1,e.sellDate,"dd MMM yyyy")," ")}}function se(t,l){if(t&1&&(r(0,"div",8)(1,"strong"),a(2,"Bought Price:"),n(),a(3),x(4,"currency"),n()),t&2){let e=c().$implicit;i(3),p(" ",h(4,1,e.boughtPrice)," ")}}function de(t,l){if(t&1&&(r(0,"div",8)(1,"strong"),a(2,"Sold Price:"),n(),a(3),x(4,"currency"),n()),t&2){let e=c().$implicit;i(3),p(" ",h(4,1,e.sellPrice)," ")}}function ce(t,l){if(t&1&&(r(0,"div",8)(1,"strong"),a(2,"Deal Type:"),n(),a(3),n()),t&2){let e=c().$implicit;i(3),p(" ",e.dealType," ")}}function pe(t,l){if(t&1&&(r(0,"div",8)(1,"strong"),a(2,"Seller Name:"),n(),a(3),n()),t&2){let e=c().$implicit;i(3),p(" ",e.sellerName," ")}}function me(t,l){if(t&1&&(r(0,"div",8)(1,"strong"),a(2,"Seller Contact:"),n(),a(3),n()),t&2){let e=c().$implicit;i(3),p(" ",e.sellerContact," ")}}function _e(t,l){if(t&1&&(r(0,"div",8)(1,"strong"),a(2,"Buyer Name:"),n(),a(3),n()),t&2){let e=c().$implicit;i(3),p(" ",e.buyerName," ")}}function Ce(t,l){if(t&1&&(r(0,"div",8)(1,"strong"),a(2,"Buyer Contact:"),n(),a(3),n()),t&2){let e=c().$implicit;i(3),p(" ",e.buyerContact," ")}}function xe(t,l){if(t&1&&(r(0,"div",7)(1,"strong"),a(2,"Notes:"),n(),a(3),n()),t&2){let e=c().$implicit;i(3),p(" ",e.notes," ")}}function ue(t,l){if(t&1&&(r(0,"li"),a(1),r(2,"b"),a(3),n()()),t&2){let e=l.$implicit;i(),W(" ",e.name," (",e.amount,") "),i(2),L(e.isPayed?"Paid":"Unpaid")}}function fe(t,l){if(t&1&&(r(0,"div",7)(1,"strong"),a(2,"Expenses:"),n(),r(3,"ul"),B(4,ue,4,3,"li",null,w),n()()),t&2){let e=c().$implicit;i(4),k(e.expenses)}}function he(t,l){if(t&1&&(r(0,"div",2)(1,"div",3)(2,"ks-base-card",4)(3,"div",5)(4,"div",6),u(5,ne,5,2,"div",7)(6,oe,5,3,"div",8)(7,ae,5,3,"div",8)(8,re,5,4,"div",8)(9,le,5,4,"div",8)(10,se,5,3,"div",8)(11,de,5,3,"div",8)(12,ce,4,1,"div",8)(13,pe,4,1,"div",8)(14,me,4,1,"div",8)(15,_e,4,1,"div",8)(16,Ce,4,1,"div",8)(17,xe,4,1,"div",7)(18,fe,6,0,"div",7),n()()()()()),t&2){let e=l.$implicit,o=c(3);i(2),f("config",o.getCardConfig(e)),i(3),d(e.isSold!==null?5:-1),i(),d(e.pl!==void 0&&e.pl!==null&&e.isSold?6:-1),i(),d(e.totalCost!==void 0&&e.totalCost!==null?7:-1),i(),d(e.boughtDate?8:-1),i(),d(e.sellDate&&e.isSold?9:-1),i(),d(e.boughtPrice!==void 0&&e.boughtPrice!==null?10:-1),i(),d(e.sellPrice!==void 0&&e.sellPrice!==null&&e.isSold?11:-1),i(),d(e.dealType?12:-1),i(),d(e.sellerName?13:-1),i(),d(e.sellerContact?14:-1),i(),d(e.buyerName&&e.isSold?15:-1),i(),d(e.buyerContact&&e.isSold?16:-1),i(),d(e.notes?17:-1),i(),d(e.expenses!=null&&e.expenses.length?18:-1)}}function ve(t,l){if(t&1&&(r(0,"div",1),B(1,he,19,15,"div",2,w),n()),t&2){let e=c();i(),k(e)}}function ge(t,l){t&1&&u(0,ve,3,0,"div",1),t&2&&d(l.length?0:-1)}var Qe=(()=>{class t{constructor(){this._dialog=_(T),this._carsService=_(N),this._navService=_(X),this._currentScreen=I("cars_listing"),this.cars$=this._carsService.cars$}ngOnInit(){this._carsService.getCars(),this._navService.updateNav({show:!0,back:!1,title:this._currentScreen.screenName,buttons:[{label:{text:"Create New"},prefixIcon:{icon:"icon_plus_circle"},hide:!this._currentScreen.insert,onClick:()=>{this._openCarDialog()}}]})}getCardConfig(e){return{header:{title:{text:e.carName,tag:"h4",translate:!1,addClass:"pt-3"}},footer:{buttons:[{label:{text:"Expenses"},prefixIcon:{icon:"icon_money"},onClick:()=>{this._openExpenseDialog(e)}},{label:{text:"Edit"},prefixIcon:{icon:"icon_edit"},onClick:()=>{this._openCarDialog(e)}},{label:{text:"Delete"},prefixIcon:{icon:"icon_delete"},color:"warn",onClick:()=>{this._deleteCar(e)}}],position:"end"},addClass:"h-100"}}_openExpenseDialog(e){this._dialog.open(ee,{data:e.expenses,width:"95vw",maxWidth:"900px"}).afterClosed().pipe(m(1)).subscribe(o=>{if(o){let s=o.reduce((b,te)=>b+te.amount,0),y=(e.sellPrice||0)-((e.boughtPrice||0)+s);e.expenses=o,e.totalCost=s+(e.boughtPrice||0),e.pl=y,this._carsService.updateCar(C({},e)).pipe(m(1)).subscribe(b=>{b.data&&this._carsService.$updateCars(b.data,"edit")})}})}_openCarDialog(e){let o={hideClearButton:!0,title:{text:e?"Edit Car":"Add Car"},form:{value:C({isSold:!1,boughtDate:new Date},e||{}),fields:[{name:"carName",label:{text:"Car Name"},type:"text",required:!0},{name:"boughtPrice",label:{text:"Bought Price"},type:"number",required:!0},{name:"boughtDate",label:{text:"Bought Date"},type:"date",required:!0},{name:"sellPrice",label:{text:"Sold Price"},type:"number"},{name:"sellDate",label:{text:"Sold Date"},type:"date"},{name:"buyerName",label:{text:"Buyer Name"},type:"text"},{name:"buyerContact",label:{text:"Buyer Contact"},type:"textaria"},{name:"sellerName",label:{text:"Seller Name"},type:"text"},{name:"sellerContact",label:{text:"Seller Contact"},type:"textaria"},{name:"notes",label:{text:"Notes"},type:"textaria"},{name:"dealType",label:{text:"Deal Type"},type:"autocomplete",flexibleValue:!0,options:[{name:"Cash",value:"Cash"},{name:"Dekishe",value:"Dekishe"}]},{name:"isSold",label:{text:"Is Sold"},type:"checkbox"}]},beforeCloseObservable:s=>e?this._carsService.updateCar(C(C({},e),s)):this._carsService.addCar(s),getAfterSuccessResponse:s=>{s.data&&this._carsService.$updateCars(s.data,e?"edit":"add")}};this._dialog.openFormPopup(o,"900px")}_deleteCar(e){let o={title:{text:"Confirm Delete"},message:{text:"Are you sure you want to delete this car?"}};this._dialog.openConfirmPopup(o).afterClosed().pipe(m(1)).subscribe(s=>{s&&e?._id&&this._carsService.deleteCar(e)})}static{this.\u0275fac=function(o){return new(o||t)}}static{this.\u0275cmp=E({type:t,selectors:[["ks-solutions-cars"]],standalone:!0,features:[G([N]),D],decls:3,vars:3,consts:[[1,"container-fluid","my-5"],[1,"row"],[1,"col-12","col-sm-6","col-md-6","col-lg-4","col-xl-3","mb-4"],[1,"cs-card","h-100","shadow-sm","border","border-1","rounded-2"],[3,"config"],[1,"container"],[1,"row","gy-2"],[1,"col-12"],[1,"col-12","col-md-6"],[1,"badge",3,"ngClass"]],template:function(o,s){if(o&1&&(r(0,"div",0),u(1,ge,1,1),x(2,"async"),n()),o&2){let y;i(),d((y=h(2,1,s.cars$))?1:-1,y)}},dependencies:[q,P,V,H,O],styles:[".cs-card[_ngcontent-%COMP%]{transition:transform .3s}"],changeDetection:0})}}return t})();export{Qe as CarsComponent};
