import{a as Ce,b as Se,c as xe,d as be}from"./chunk-HVYYIV3C.js";import{a as B}from"./chunk-N4O6L2UG.js";import{a as T}from"./chunk-ACYZVNWI.js";import{a as x}from"./chunk-UA3J3SVI.js";import{a as ve}from"./chunk-2OEIZLNB.js";import"./chunk-HMNUYURD.js";import{a as D}from"./chunk-5LHP7IWU.js";import{D as ae,E as se,F as le,G as y,H as de,I as ce,M as pe,N as me,O as $,aa as ue,da as _e,ma as fe,ra as ge,sa as he}from"./chunk-7Y4QU53B.js";import"./chunk-CARY4E7O.js";import"./chunk-QLWHFAAO.js";import{$b as k,Ec as b,Fa as w,Fc as G,Gc as N,Hb as c,Ka as q,La as J,N as m,Nb as f,Ob as R,Pc as ne,Qb as V,Rb as A,Sb as s,Tb as r,Ub as S,Yb as X,a as h,b as O,bc as u,db as Q,ea as H,hb as a,hd as oe,jd as re,ka as p,mc as d,o as K,oa as F,oc as I,pc as L,rc as Z,sb as C,sc as ee,tc as te,uc as ie,vc as U,wc as g,xc as M,y as P,ya as W,yc as E,za as Y,zb as _,zc as j}from"./chunk-72DPVO72.js";var z=(()=>{class t{constructor(){this._lovService=p(B),this._navbarService=p(D),this._networkService=p(_e),this._menu$=new K(void 0),this._menuId="",this.menu$=this._menu$.asObservable()}updateMenuData(e){this._networkService.patch(x.MENU_SETTINGS.updateFile,{menuId:e}).pipe(m(1)).subscribe()}updateMenuEditors(e){return this._networkService.patch(x.MENU_SETTINGS.menuEditors,O(h({},e),{menuId:e._id}))}updateMenuTemplate(e,i){this._networkService.patch(x.MENU_SETTINGS.menuTemplate,{menuId:e,newTemplateId:i}).pipe(m(1)).subscribe(n=>{if(n?.data){let l=this._menu$.getValue();l&&(l.templateId=n.data.templateId,this._menu$.next(l))}})}addInvoiceSettings(e){this._networkService.post(x.INVOICE.settings,O(h({},e),{menuId:this._menuId})).pipe(m(1)).subscribe(()=>{this.getMenuById(this._menuId)})}updateInvoiceSettings(e){this._networkService.patch(x.INVOICE.settings,e,e._id).pipe(m(1)).subscribe(()=>{this.getMenuById(this._menuId)})}getMenuById(e){this._networkService.post(x.MENU_SETTINGS.byMenuId,{menuId:e}).pipe(m(1)).subscribe({next:i=>{i?i.data&&(this._menu$.next(i.data),this._menuId=e,i.data.isExternal||this._lovService.getMenuTemplatesLov()):this._navbarService.navigateTo(T.LAYOUT.children.HOME.route)},error:()=>{this._navbarService.navigateTo(T.LAYOUT.children.HOME.route)}})}$update(e){this._menu$.next(e)}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=H({token:t,factory:t.\u0275fac})}}return t})();var Te=(()=>{class t{constructor(){this._destroyRef=p(w),this._crd=p(ne),this.control=J.required(),this.getValue=q(),this.editor=new be,this.htmlContent="",this.toolbar=[["bold","italic","underline"],["align_left","align_center","align_right","align_justify"],["bullet_list","ordered_list"],["horizontal_rule","format_clear","indent","outdent"],["undo","redo"]]}ngOnInit(){this.htmlContent=this.control().value,this.control().valueChanges.pipe($(this._destroyRef)).subscribe(e=>{this.htmlContent=e||"",this._crd.markForCheck()})}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=F({type:t,selectors:[["kss-lib-invoice-footer-text"]],inputs:{control:[1,"control"]},outputs:{getValue:"getValue"},standalone:!0,features:[U],decls:5,vars:4,consts:[[1,"w-100"],[1,"py-2","ps-2","text-center","h5","underline"],[3,"toolbar","editor"],[3,"ngModelChange","focusOut","editor","ngModel"]],template:function(i,n){i&1&&(s(0,"div",0)(1,"div",1),d(2,"Footer Text"),r(),S(3,"ngx-editor-menu",2),s(4,"ngx-editor",3),te("ngModelChange",function(v){return ee(n.htmlContent,v)||(n.htmlContent=v),v}),k("focusOut",function(){return n.getValue.emit(n.htmlContent)}),r()()),i&2&&(a(3),c("toolbar",n.toolbar)("editor",n.editor),a(),c("editor",n.editor),Z("ngModel",n.htmlContent))},dependencies:[xe,Ce,Se,pe,ae,de],changeDetection:0})}}return t})();var Fe=()=>({text:"Menu Template",translate:!1,addClass:"h4"}),Me=t=>({title:t}),we=()=>({addClass:"card p-3"}),ke=(t,o)=>({header:t,content:o}),Ue=()=>({text:"Menu Invoice Settings",translate:!1,addClass:"h4"}),Ne=()=>({text:"Save Settings"}),$e=()=>({icon:"icon_save"}),De=(t,o,e)=>({label:t,prefixIcon:o,matType:"mat-flat-button",onClick:e}),Be=t=>[t],Oe=t=>({position:"end",buttons:t}),Pe=()=>({addClass:"mb-1"}),Re=(t,o,e)=>({header:t,footer:o,content:e}),Ve=()=>({text:"Background Color"}),Ie=(t,o)=>({label:t,type:"color",control:o}),Ae=()=>({text:"Font Color"}),Le=()=>({text:"Show Item Unit In Invoice If Available"}),je=(t,o)=>({label:t,control:o});function Ge(t,o){t&1&&(s(0,"p")(1,"strong"),d(2,"Menu Owner:"),r(),d(3),r()),t&2&&(a(3),I(" ",o," "))}function ze(t,o){if(t&1&&(s(0,"p")(1,"strong"),d(2,"Last Updated By:"),r(),d(3),r(),s(4,"p")(5,"strong"),d(6,"Last Updated At:"),r(),d(7),b(8,"date"),r()),t&2){let e=u(2);a(3),L(" ",e.lastUpdate.name," (",e.lastUpdate.email,") "),a(4),I(" ",N(8,3,e.lastUpdate.createdAt,"medium")," ")}}function Ke(t,o){if(t&1&&(s(0,"div")(1,"ks-base-card",1)(2,"div",5),_(3,Ge,4,1,"p"),s(4,"p")(5,"strong"),d(6,"Created Date:"),r(),d(7),b(8,"date"),r(),s(9,"p")(10,"strong"),d(11,"Expiry Date:"),r(),d(12),b(13,"date"),r(),_(14,ze,9,6),r()()()),t&2){let e,i=u(),n=u();a(),c("config",o),a(2),f((e=n.owner())?3:-1,e),a(4),I(" ",N(8,5,i.createdAt,"medium")," "),a(5),I(" ",N(13,8,i.expiresAt,"medium")," "),a(2),f(i.lastUpdate?14:-1)}}function He(t,o){if(t&1&&(s(0,"li",6),d(1),r()),t&2){let e=o.$implicit;a(),L("",e.name," (",e.email,")")}}function We(t,o){if(t&1&&(s(0,"ul"),V(1,He,2,2,"li",6,R),r()),t&2){let e=u();a(),A(e)}}function Ye(t,o){t&1&&(s(0,"div",4)(1,"p"),d(2,"This menu currently has no editors. Please contact your administrator if you'd like to add one."),r()())}function qe(t,o){t&1&&_(0,We,3,0,"ul")(1,Ye,3,0,"div",4),t&2&&f(o.length?0:1)}function Je(t,o){if(t&1&&(s(0,"ks-base-card",1),_(1,qe,2,1),r()),t&2){let e,i=u(2);c("config",o),a(),f((e=i.editors())?1:-1,e)}}function Qe(t,o){if(t&1){let e=X();s(0,"div",2)(1,"ks-base-card",1)(2,"form")(3,"div",7)(4,"div",8)(5,"div",9),S(6,"ks-base-input",1),r(),s(7,"div",9),S(8,"ks-base-input",1),r(),s(9,"div",10),S(10,"ks-base-slide-toggle",1),r()()()(),s(11,"kss-lib-invoice-footer-text",11),k("getValue",function(n){W(e);let l=u(2);return Y(l.footerText=n)}),r()()()}if(t&2){let e=u(2);a(),c("config",j(19,Re,M(6,Me,g(5,Ue)),M(16,Oe,M(14,Be,j(10,De,g(8,Ne),g(9,$e),e.updateMenuInvoice.bind(e)))),g(18,Pe))),a(5),c("config",E(24,Ie,g(23,Ve),e.invoiceSettingsForm.controls.backgroundColor)),a(2),c("config",E(28,Ie,g(27,Ae),e.invoiceSettingsForm.controls.fontColor)),a(2),c("config",E(32,je,g(31,Le),e.invoiceSettingsForm.controls.showUnit)),a(),c("control",e.invoiceSettingsForm.controls.footerText)}}function Xe(t,o){if(t&1&&(s(0,"div",12)(1,"ks-base-card",1),S(2,"img",13),r()()),t&2){let e=o.$implicit,i=u(2),n=u();a(),c("config",n.getTemplateCardConfig(i,e)),a(),c("src",e.imageUrl,Q)}}function Ze(t,o){if(t&1&&(s(0,"div",3),V(1,Xe,3,2,"div",12,R),b(3,"async"),r()),t&2){let e=u(2);a(),A(G(3,0,e.templates$))}}function et(t,o){t&1&&(s(0,"div",4)(1,"p"),d(2,"This menu is external and does not support template changes."),r()())}function tt(t,o){if(t&1&&(_(0,Ke,15,11,"div"),s(1,"div",0),_(2,Je,2,2,"ks-base-card",1),r(),_(3,Qe,12,35,"div",2),s(4,"div")(5,"ks-base-card",1),_(6,Ze,4,2,"div",3)(7,et,3,0,"div",4),r()()),t&2){let e,i,n=o,l=u();f((e=l.menuCard())?0:-1,e),a(2),f((i=l.editorsCard())?2:-1,i),a(),f(n.hasInvoice?3:-1),a(2),c("config",E(9,ke,M(6,Me,g(5,Fe)),g(8,we))),a(),f(n.isExternal?7:6)}}var Dt=(()=>{class t{constructor(){this._destroyRef=p(w),this._dialog=p(ue),this._lovService=p(B),this._menuSettingsService=p(z),this._navService=p(D),this.templates$=this._lovService.menuTemplatesLov$.pipe(P(e=>e.filter(i=>!i.isCustom))),this.menu$=this._menuSettingsService.menu$,this.currentScreen=ve("menu_settings"),this.menuCard=C(void 0),this.editorsCard=C(void 0),this.editors=C([]),this.owner=C(""),this.footerText="",this.invoiceSettingsForm=new le({logoUrl:new y(""),backgroundColor:new y("#FFFFFF"),fontColor:new y("#000000"),footerText:new y(""),showUnit:new y(!1)})}ngOnInit(){let e=this._navService.readUrlParams().MenuId;this._navService.updateNav({show:!0,back:!0,title:this.currentScreen.screenName,buttons:[]}),e?this._menuSettingsService.getMenuById(e):this._navService.navigateTo(T.LAYOUT.children.HOME.route),this._menuSettingsService.menu$.pipe($(this._destroyRef)).subscribe(i=>{if(!i)return;this.invoiceSettingsForm.patchValue(i.invoiceSettings||{}),this.footerText=i.invoiceSettings?.footerText||"",this._lovService.userLov$.pipe(m(1)).subscribe(l=>{this.owner.set(l.find(v=>v._id===i.ownerId)?.name??""),this.editors.set(l.filter(v=>i.editorsId.includes(v._id)))}),this.editorsCard.set({header:{title:{text:"Menu Editors",addClass:"h4"}}});let n={header:{title:{text:i.name,translate:!1,tag:"h4"},position:"center"},footer:{buttons:[{label:{text:"Update Menu Data"},matType:"mat-flat-button",suffixIcon:{icon:"icon_refresh"},onClick:()=>{this._updateMenu(i)},hide:C(!i.isExternal)},{label:{text:"Open Menu"},matType:"mat-flat-button",suffixIcon:{icon:"icon_arrow_right",size:"sm"},onClick:()=>{i.redirect&&i.activateRedirection?window.open(i.redirect,"_blank"):window.open(`${window.location.origin}/${T.MENUS.route}/${i.endpoint}`,"_blank")}}],position:"end"}};this.menuCard.set(n)})}updateMenuInvoice(){this._dialog.openConfirmPopup({title:{text:"Confirm Save"},message:{text:"Are you sure you want to update the invoice settings?"}}).afterClosed().pipe(m(1)).subscribe(e=>{e&&this._menuSettingsService.menu$.pipe(m(1)).subscribe(i=>{let n=this.invoiceSettingsForm.value;n.footerText=this.footerText,i&&(i.invoiceSettings?this._menuSettingsService.updateInvoiceSettings(h(h({},i.invoiceSettings),n)):this._menuSettingsService.addInvoiceSettings(n))})})}getTemplateCardConfig(e,i){return{header:{title:{text:i.name,translate:!1,addClass:"h4"},position:"center"},footer:{buttons:[{label:{text:"Use"},matType:"mat-stroked-button",onClick:()=>{this._changeMenuTemplate(e._id,i)},hide:C(e.templateId===i.templateId)}],position:"center"},content:{addClass:"rounded overflow-hidden"},addClass:`h-100 w-100 ${e.templateId===i.templateId?"border-primary border-2 cs-primary-bg":""}`}}_openUpdateEditorsDialog(e){let i={title:{text:"Editors"},form:{value:h({},e||{}),fields:[{name:"editorsId",type:"select",label:{text:"Editors"},stream:this._lovService.userLov$.pipe(P(n=>n.filter(l=>l._id!==e?.ownerId))),transformer:{nameKey:"name",valueKey:"_id"},multiple:!0}]},beforeCloseObservable:n=>this._menuSettingsService.updateMenuEditors(h(h({},e),n)),getAfterSuccessResponse:n=>{n.data&&this._menuSettingsService.$update(n.data)}};this._dialog.openFormPopup(i,"500px")}_changeMenuTemplate(e,i){let n={title:{text:"Confirm Template"},message:{text:`Are you sure you want to use ${i.name}?`}};this._dialog.openConfirmPopup(n).afterClosed().pipe(m(1)).subscribe(l=>{l&&this._menuSettingsService.updateMenuTemplate(e,i._id)})}_updateMenu(e){let i={title:{text:"Confirm Update"},message:{text:"Are you sure you want to update this menu? Please note that it may take up to 5 minutes for the changes to take effect."}};this._dialog.openConfirmPopup(i).afterClosed().pipe(m(1)).subscribe(n=>{n&&e._id&&this._menuSettingsService.updateMenuData(e._id)})}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=F({type:t,selectors:[["ks-solutions-menu-settings"]],standalone:!0,features:[ie([z]),U],decls:2,vars:3,consts:[[1,"my-3"],[3,"config"],[1,"mb-3"],[1,"d-flex","overflow-x-auto","gap-3","h-100","pb-3"],[1,"external-menu-info"],[1,"dates-section"],[1,"text-break"],[1,"container-fluid"],[1,"row"],[1,"col-12","col-sm-12","col-md-6","col-lg-4"],[1,"col-12","col-sm-12","col-md-6","col-lg-4","pt-4",2,"min-height","75px"],[3,"getValue","control"],[2,"min-width","200px","max-width","200px"],["alt","",1,"template-img","img-fluid",3,"src"]],template:function(i,n){if(i&1&&(_(0,tt,8,12),b(1,"async")),i&2){let l;f((l=G(1,1,n.menu$))?0:-1,l)}},dependencies:[ge,oe,re,fe,me,ce,se,he,Te],styles:[".external-menu-info[_ngcontent-%COMP%]{font-size:16px;color:#6c757d}"],changeDetection:0})}}return t})();export{Dt as MenuSettingsComponent};
