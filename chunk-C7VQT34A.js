import{a as b}from"./chunk-MJ7DCTJM.js";import{a as h}from"./chunk-ACYZVNWI.js";import{a as z}from"./chunk-2OEIZLNB.js";import"./chunk-HMNUYURD.js";import{a as E}from"./chunk-NZP3AJU7.js";import{a as g}from"./chunk-5LHP7IWU.js";import{N as G,O as K,aa as H,da as V,ra as Y}from"./chunk-7Y4QU53B.js";import"./chunk-CARY4E7O.js";import"./chunk-QLWHFAAO.js";import{Ec as C,Fa as R,Fc as F,Gc as x,Hb as I,N as S,Nb as l,Ob as A,Qb as O,Rb as B,Sb as c,Tb as o,a as v,b as w,bc as m,ea as P,hb as a,hd as M,jd as j,ka as d,mc as s,o as U,oa as $,oc as u,pc as T,sb as f,uc as N,vc as L,y as D,zb as p}from"./chunk-72DPVO72.js";var k=(()=>{class t{constructor(){this._lovService=d(b),this._navbarService=d(g),this._networkService=d(V),this._service$=new U(void 0),this.service$=this._service$.asObservable()}updateServiceData(e){this._networkService.patch(E.SERVICE_SETTINGS.updateFile,{serviceId:e}).pipe(S(1)).subscribe()}updateServiceEditors(e){return this._networkService.patch(E.SERVICE_SETTINGS.serviceEditors,w(v({},e),{serviceId:e._id}))}getServiceById(e){this._networkService.post(E.SERVICE_SETTINGS.byServiceId,{serviceId:e}).pipe(S(1)).subscribe({next:i=>{i?i.data&&this._service$.next(i.data):this._navbarService.navigateTo(h.LAYOUT.children.HOME.route)},error:()=>{this._navbarService.navigateTo(h.LAYOUT.children.HOME.route)}})}$update(e){this._service$.next(e)}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=P({token:t,factory:t.\u0275fac})}}return t})();function J(t,r){t&1&&(c(0,"p")(1,"strong"),s(2,"Service Owner:"),o(),s(3),o()),t&2&&(a(3),u(" ",r," "))}function Q(t,r){if(t&1&&(c(0,"p")(1,"strong"),s(2,"Expiry Date:"),o(),s(3),C(4,"date"),o()),t&2){let e=m(2);a(3),u(" ",x(4,1,e.expiresAt,"medium")," ")}}function W(t,r){if(t&1&&(c(0,"p")(1,"strong"),s(2,"Last Updated By:"),o(),s(3),o(),c(4,"p")(5,"strong"),s(6,"Last Updated At:"),o(),s(7),C(8,"date"),o()),t&2){let e=m(2);a(3),T(" ",e.lastUpdate.name," (",e.lastUpdate.email,") "),a(4),u(" ",x(8,3,e.lastUpdate.createdAt,"medium")," ")}}function X(t,r){if(t&1&&(c(0,"ks-base-card",1)(1,"div",2),p(2,J,4,1,"p"),c(3,"p")(4,"strong"),s(5,"Created Date:"),o(),s(6),C(7,"date"),o(),p(8,Q,5,4,"p")(9,W,9,6),o()()),t&2){let e,i=m(),n=m();I("config",r),a(2),l((e=n.owner())?2:-1,e),a(4),u(" ",x(7,5,i.createdAt,"medium")," "),a(2),l(i.expiresAt?8:-1),a(),l(i.lastUpdate?9:-1)}}function Z(t,r){if(t&1&&(c(0,"li",4),s(1),o()),t&2){let e=r.$implicit;a(),T("",e.name," (",e.email,")")}}function ee(t,r){if(t&1&&(c(0,"ul"),O(1,Z,2,2,"li",4,A),o()),t&2){let e=m();a(),B(e)}}function te(t,r){t&1&&(c(0,"div",3)(1,"p"),s(2,"This service currently has no editors. Please contact your administrator if you'd like to add one."),o()())}function ie(t,r){t&1&&p(0,ee,3,0,"ul")(1,te,3,0,"div",3),t&2&&l(r.length?0:1)}function ne(t,r){if(t&1&&(c(0,"ks-base-card",1),p(1,ie,2,1),o()),t&2){let e,i=m(2);I("config",r),a(),l((e=i.editors())?1:-1,e)}}function oe(t,r){if(t&1&&(p(0,X,10,8,"ks-base-card",1),c(1,"div",0),p(2,ne,2,2,"ks-base-card",1),o()),t&2){let e,i,n=m();l((e=n.serviceCard())?0:-1,e),a(2),l((i=n.editorsCard())?2:-1,i)}}var we=(()=>{class t{constructor(){this._destroyRef=d(R),this._dialog=d(H),this._lovService=d(b),this._serviceSettingsService=d(k),this._navService=d(g),this.service$=this._serviceSettingsService.service$,this.currentScreen=z("service_settings"),this.serviceCard=f(void 0),this.editorsCard=f(void 0),this.editors=f([]),this.owner=f("")}ngOnInit(){let e=this._navService.readUrlParams().ServiceId;this._navService.updateNav({show:!0,back:!0,title:this.currentScreen.screenName,buttons:[]}),e?this._serviceSettingsService.getServiceById(e):this._navService.navigateTo(h.LAYOUT.children.HOME.route),this._serviceSettingsService.service$.pipe(K(this._destroyRef)).subscribe(i=>{if(!i)return;this._lovService.userLov$.pipe(S(1)).subscribe(_=>{this.owner.set(_.find(y=>y._id===i.ownerId)?.name??""),this.editors.set(_.filter(y=>i.editorsId.includes(y._id)))}),this.editorsCard.set({header:{title:{text:"Service Editors",addClass:"h4"}}});let n={header:{title:{text:i.name,translate:!1,tag:"h4"},position:"center"},footer:{buttons:[{label:{text:"Update Service Data"},matType:"mat-flat-button",suffixIcon:{icon:"icon_refresh"},onClick:()=>{this._updateService(i)},hide:f(!i.editable||!i.isExternal)},{label:{text:"Open Service"},matType:"mat-flat-button",suffixIcon:{icon:"icon_arrow_right",size:"sm"},onClick:()=>{i.url&&window.open(i.url,"_blank")}}],position:"end"}};this.serviceCard.set(n)})}_openUpdateEditorsDialog(e){let i={title:{text:"Editors"},form:{value:v({},e||{}),fields:[{name:"editorsId",type:"select",label:{text:"Editors"},stream:this._lovService.userLov$.pipe(D(n=>n.filter(_=>_._id!==e?.ownerId))),transformer:{nameKey:"name",valueKey:"_id"},multiple:!0}]},beforeCloseObservable:n=>this._serviceSettingsService.updateServiceEditors(v(v({},e),n)),getAfterSuccessResponse:n=>{n.data&&this._serviceSettingsService.$update(n.data)}};this._dialog.openFormPopup(i,"500px")}_updateService(e){let i={title:{text:"Confirm Update"},message:{text:"Are you sure you want to update this service? Please note that it may take up to 5 minutes for the changes to take effect."}};this._dialog.openConfirmPopup(i).afterClosed().pipe(S(1)).subscribe(n=>{n&&e._id&&this._serviceSettingsService.updateServiceData(e._id)})}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=$({type:t,selectors:[["ks-solutions-service-settings"]],standalone:!0,features:[N([k]),L],decls:2,vars:3,consts:[[1,"my-3"],[3,"config"],[1,"dates-section"],[1,"external-service-info"],[1,"text-break"]],template:function(i,n){if(i&1&&(p(0,oe,3,2,"div",0),C(1,"async")),i&2){let _;l((_=F(1,1,n.service$))?0:-1,_)}},dependencies:[Y,M,j,G],styles:[".external-service-info[_ngcontent-%COMP%]{font-size:16px;color:#6c757d}"],changeDetection:0})}}return t})();export{we as ServiceSettingsComponent};
