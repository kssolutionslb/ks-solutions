import{a as S}from"./chunk-U5RD573Z.js";import{a as w}from"./chunk-JDEWHVZM.js";import"./chunk-HMNUYURD.js";import{a as b}from"./chunk-VMV3LQCJ.js";import{a as ne}from"./chunk-VL4WVYQ7.js";import{O as ee,aa as I,da as te,ra as D,v as X,va as ie,w as Z}from"./chunk-OMSYFKJ3.js";import"./chunk-CARY4E7O.js";import"./chunk-Z72V5FLM.js";import{Dc as C,Ec as g,Fa as q,Fc as R,Hb as v,N as _,Nb as d,Ob as k,Qb as F,Rb as N,Sb as r,Tb as n,Ub as O,a as u,bc as c,bd as z,ea as W,gd as Y,hb as i,ib as B,id as J,ka as x,kd as Q,mc as a,n as U,nc as P,o as E,oa as T,oc as p,pc as V,sb as G,uc as H,vc as $,wc as K,xc as A,y as L,zb as h}from"./chunk-P5AQMEDB.js";var M=(()=>{class t{constructor(){this._networkService=x(te),this._cars$=new E([]),this.cars$=this._cars$.asObservable()}getCars(){this._networkService.get(b.CARS.cars).pipe(_(1)).subscribe(e=>{e.data&&this._cars$.next(e.data)})}addCar(e){return this._networkService.post(b.CARS.cars,e)}updateCar(e){return this._networkService.patch(b.CARS.cars,e,e._id)}deleteCar(e){this._networkService.delete(b.CARS.cars,e,e._id).pipe(_(1)).subscribe(o=>{o&&this.$updateCars(e,"delete")})}$updateCars(e,o){S.UpdateArrayBehaviorSubject(this._cars$,e,o)}static{this.\u0275fac=function(o){return new(o||t)}}static{this.\u0275prov=W({token:t,factory:t.\u0275fac})}}return t})();function re(t,s){if(t&1&&O(0,"ks-basic-grid",1),t&2){let e=c();v("config",e.gridConfig)("refresh$",e.refresh$)}}var ae=(()=>{class t{constructor(e,o){this._dialogRef=e,this.data=o,this._destroyRef=x(q),this._dialog=x(I),this._currentScreen=w("cars_listing"),this._expense$=new E([]),this.refresh$=new U,this.cardConfig={header:{title:{text:"Car Expenses",tag:"h3",fontWeight:"700"},position:"center",suffixButton:{label:{text:"Close"},matType:"mat-icon-button",prefixIcon:{icon:"icon_x_circle"},onClick:()=>{this._dialogRef.close()}}},content:{addClass:"card p-2"},footer:{buttons:[this._currentScreen.update?{label:{text:"Save"},matType:"mat-flat-button",prefixIcon:{icon:"icon_save"},onClick:()=>{this._save()}}:{label:{text:"Close"},onClick:()=>{this._dialogRef.close()},matType:"mat-flat-button"}],position:"center"}}}ngOnInit(){let e=this.data?.expenses||[];this._initializeGrid(e),this._expense$.next(e),this._expense$.pipe(ee(this._destroyRef)).subscribe(o=>{this.refresh$.next({data:o})})}_initializeGrid(e){this.gridConfig={data:G(e),defaultPagination:100,maxTableHeight:"calc(100dvh - 400px)",noDataMessage:{text:"This car has no expenses"},features:{showAddButton:this._currentScreen.update,addButtonClicked:()=>{this._openExpensePopup()}},columns:[{field:"name",title:"Expense",type:"string",extraStyles:{"min-width":"150px"}},{field:"amount",title:"Amount",type:"number",extraStyles:{"min-width":"100px"}},{field:"isPayed",title:"Payed",type:"chip",extraStyles:{width:"120px"},position:"p-start",truthy:{false:"No",true:"Yes"},setChipClass:o=>o.isPayed===!0?"rounded rounded-5 px-3 py-1 text-bg-success cs-w-120":"rounded rounded-5 px-3 py-1 text-bg-danger cs-w-120"},{field:"date",title:"Date",type:"date",dateFormat:"dd/MM/yyyy",extraStyles:{"min-width":"100px"}},{field:"notes",title:"Notes",type:"string",extraStyles:{"min-width":"150px"}}],actionsColumn:{maxButtons:window.innerWidth<700?1:void 0,maxWidth:window.innerWidth<700?void 0:"110px",minWidth:window.innerWidth<700?void 0:"110px",enabled:this._currentScreen.update||this._currentScreen.delete,buttons:[{prefixIcon:{icon:"icon_edit"},label:{text:"Edit"},onClickFn:o=>this._openExpensePopup(o),isVisibleFn:()=>this._currentScreen.update,matType:"mat-icon-button"},{prefixIcon:{icon:"icon_delete",color:"red"},label:{text:"Delete"},onClickFn:o=>this._deleteExpense(o),isVisibleFn:()=>this._currentScreen.delete,matType:"mat-icon-button"}]}}}_openExpensePopup(e){let o={hideClearButton:!0,title:{text:e?"Edit Expense":"Add Expense"},form:{value:e,fields:[{name:"name",type:"text",label:{text:"Expense"},required:!0,maxLength:70,minLength:4},{name:"amount",label:{text:"Amount"},type:"number",required:!0},{name:"date",label:{text:"Date"},type:"date",required:!0},{name:"notes",label:{text:"Notes"},type:"textaria",maxLength:70},{name:"isPayed",label:{text:"Payed"},type:"toggle"}]}};this._dialog.openFormPopup(o,"500px").afterClosed().pipe(_(1)).subscribe(l=>{l&&(e?S.UpdateArrayBehaviorSubjectById(this._expense$,u(u({},e),l),"edit"):(l.id=new Date().getTime(),S.UpdateArrayBehaviorSubjectById(this._expense$,l,"add")))})}_deleteExpense(e){this._dialog.openConfirmPopup({title:{text:"Confirm Delete"},message:{text:"Are you sure you want to delete this Expense?"}}).afterClosed().pipe(_(1)).subscribe(o=>{o&&S.UpdateArrayBehaviorSubjectById(this._expense$,e,"delete")})}_save(){this._dialogRef.close(this._expense$.getValue())}static{this.\u0275fac=function(o){return new(o||t)(B(X),B(Z))}}static{this.\u0275cmp=T({type:t,selectors:[["ks-solutions-expenses-listing"]],standalone:!0,features:[$],decls:2,vars:2,consts:[[3,"config"],[3,"config","refresh$"]],template:function(o,l){o&1&&(r(0,"ks-base-card",0),h(1,re,1,2,"ks-basic-grid",1),n()),o&2&&(v("config",l.cardConfig),i(),d(l.gridConfig?1:-1))},dependencies:[ie,D],changeDetection:0})}}return t})();var le=()=>({text:"Summary",tag:"h4",translate:!1}),se=t=>({title:t,position:"center"}),de=t=>({header:t});function ce(t,s){if(t&1&&(r(0,"div",1)(1,"div",2)(2,"div",3)(3,"ks-base-card",4)(4,"div",5)(5,"div",6)(6,"div",7)(7,"strong"),a(8,"Total Profit/Loss:"),n(),r(9,"span",8),a(10),n()(),r(11,"div",7)(12,"strong"),a(13,"Total Raymond:"),n(),r(14,"span",8),a(15),n()(),r(16,"div",7)(17,"strong"),a(18,"Total Sold Cars:"),n(),r(19,"span",8),a(20),n()(),r(21,"div",7)(22,"strong"),a(23,"Total Unsold Cars:"),n(),r(24,"span",8),a(25),n()()()()()()()()),t&2){let e=s;i(3),v("config",A(8,de,A(6,se,K(5,le)))),i(7),p("$",e.totalProfit,""),i(5),p("$",e.totalRaymond,""),i(5),P(e.totalSoldCars),i(5),P(e.totalUnsoldCars)}}function pe(t,s){if(t&1&&(r(0,"div",2)(1,"strong"),a(2,"Status:"),n(),r(3,"span",14),a(4),n()()),t&2){let e=c().$implicit;i(3),v("ngClass",e.isSold?"bg-success":"bg-warning"),i(),p(" ",e.isSold?"Sold":"Available"," ")}}function me(t,s){if(t&1&&(r(0,"div",13)(1,"strong"),a(2,"Profit/Loss:"),n(),a(3),C(4,"currency"),n()),t&2){let e=c().$implicit;i(3),p(" ",g(4,1,e.pl)," ")}}function _e(t,s){if(t&1&&(r(0,"div",13)(1,"strong"),a(2,"Total Cost:"),n(),a(3),C(4,"currency"),n()),t&2){let e=c().$implicit;i(3),p(" ",g(4,1,e.totalCost)," ")}}function xe(t,s){if(t&1&&(r(0,"div",13)(1,"strong"),a(2,"Bought At:"),n(),a(3),C(4,"date"),n()),t&2){let e=c().$implicit;i(3),p(" ",R(4,1,e.boughtDate,"dd MMM yyyy")," ")}}function Ce(t,s){if(t&1&&(r(0,"div",13)(1,"strong"),a(2,"Sold At:"),n(),a(3),C(4,"date"),n()),t&2){let e=c().$implicit;i(3),p(" ",R(4,1,e.sellDate,"dd MMM yyyy")," ")}}function ue(t,s){if(t&1&&(r(0,"div",13)(1,"strong"),a(2,"Bought Price:"),n(),a(3),C(4,"currency"),n()),t&2){let e=c().$implicit;i(3),p(" ",g(4,1,e.boughtPrice)," ")}}function fe(t,s){if(t&1&&(r(0,"div",13)(1,"strong"),a(2,"Sold Price:"),n(),a(3),C(4,"currency"),n()),t&2){let e=c().$implicit;i(3),p(" ",g(4,1,e.sellPrice)," ")}}function he(t,s){if(t&1&&(r(0,"div",13)(1,"strong"),a(2,"Deal Type:"),n(),a(3),n()),t&2){let e=c().$implicit;i(3),p(" ",e.dealType," ")}}function ve(t,s){if(t&1&&(r(0,"div",13)(1,"strong"),a(2,"Seller Name:"),n(),a(3),n()),t&2){let e=c().$implicit;i(3),p(" ",e.sellerName," ")}}function ge(t,s){if(t&1&&(r(0,"div",13)(1,"strong"),a(2,"Seller Contact:"),n(),a(3),n()),t&2){let e=c().$implicit;i(3),p(" ",e.sellerContact," ")}}function ye(t,s){if(t&1&&(r(0,"div",13)(1,"strong"),a(2,"Buyer Name:"),n(),a(3),n()),t&2){let e=c().$implicit;i(3),p(" ",e.buyerName," ")}}function Se(t,s){if(t&1&&(r(0,"div",13)(1,"strong"),a(2,"Buyer Contact:"),n(),a(3),n()),t&2){let e=c().$implicit;i(3),p(" ",e.buyerContact," ")}}function be(t,s){if(t&1&&(r(0,"div",2)(1,"strong"),a(2,"Notes:"),n(),a(3),n()),t&2){let e=c().$implicit;i(3),p(" ",e.notes," ")}}function Ee(t,s){if(t&1&&(r(0,"li"),a(1),r(2,"b"),a(3),n()()),t&2){let e=s.$implicit;i(),V(" ",e.name," (",e.amount,") "),i(2),P(e.isPayed?"Paid":"Unpaid")}}function Te(t,s){if(t&1&&(r(0,"div",2)(1,"strong"),a(2,"Expenses:"),n(),r(3,"ul"),F(4,Ee,4,3,"li",null,k),n()()),t&2){let e=c().$implicit;i(4),N(e.expenses)}}function Pe(t,s){if(t&1&&(r(0,"div",10)(1,"div",11)(2,"ks-base-card",4)(3,"div",12)(4,"div",6),h(5,pe,5,2,"div",2)(6,me,5,3,"div",13)(7,_e,5,3,"div",13)(8,xe,5,4,"div",13)(9,Ce,5,4,"div",13)(10,ue,5,3,"div",13)(11,fe,5,3,"div",13)(12,he,4,1,"div",13)(13,ve,4,1,"div",13)(14,ge,4,1,"div",13)(15,ye,4,1,"div",13)(16,Se,4,1,"div",13)(17,be,4,1,"div",2)(18,Te,6,0,"div",2),n()()()()()),t&2){let e=s.$implicit,o=c(3);i(2),v("config",o.getCardConfig(e)),i(3),d(e.isSold!==null?5:-1),i(),d(e.pl!==void 0&&e.pl!==null&&e.isSold?6:-1),i(),d(e.totalCost!==void 0&&e.totalCost!==null?7:-1),i(),d(e.boughtDate?8:-1),i(),d(e.sellDate&&e.isSold?9:-1),i(),d(e.boughtPrice!==void 0&&e.boughtPrice!==null?10:-1),i(),d(e.sellPrice!==void 0&&e.sellPrice!==null&&e.isSold?11:-1),i(),d(e.dealType?12:-1),i(),d(e.sellerName?13:-1),i(),d(e.sellerContact?14:-1),i(),d(e.buyerName&&e.isSold?15:-1),i(),d(e.buyerContact&&e.isSold?16:-1),i(),d(e.notes?17:-1),i(),d(e.expenses!=null&&e.expenses.length?18:-1)}}function $e(t,s){if(t&1&&(r(0,"div",9),F(1,Pe,19,15,"div",10,k),n()),t&2){let e=c();i(),N(e)}}function Ie(t,s){t&1&&h(0,$e,3,0,"div",9),t&2&&d(s.length?0:-1)}var at=(()=>{class t{constructor(){this._dialog=x(I),this._carsService=x(M),this._navService=x(ne),this._currentScreen=w("cars_listing"),this.cars$=this._carsService.cars$,this.stats$=this.cars$.pipe(L(e=>{let o=0,l=0,f=0,m=0;for(let y of e)if(y.isSold?(f+=1,o+=y.pl||0):m+=1,Array.isArray(y.expenses))for(let j of y.expenses)j?.name?.toLowerCase?.()==="raymond"&&(l+=j.amount||0);return{totalProfit:o,totalRaymond:l,totalSoldCars:f,totalUnsoldCars:m}}))}ngOnInit(){this._carsService.getCars(),this._navService.updateNav({show:!0,back:!1,title:this._currentScreen.screenName,buttons:[{label:{text:"Create New"},prefixIcon:{icon:"icon_plus_circle"},hide:!this._currentScreen.insert,onClick:()=>{this._openCarDialog()}}]})}getCardConfig(e){return{header:{title:{text:e.carName,tag:"h4",translate:!1,addClass:"pt-3"}},footer:{buttons:[{label:{text:"Expenses"},prefixIcon:{icon:"icon_money"},onClick:()=>{this._openExpenseDialog(e)}},{label:{text:"Edit"},prefixIcon:{icon:"icon_edit"},onClick:()=>{this._openCarDialog(e)}},{label:{text:"Delete"},prefixIcon:{icon:"icon_delete"},color:"warn",onClick:()=>{this._deleteCar(e)}}],position:"end"},addClass:"h-100"}}_openExpenseDialog(e){this._dialog.open(ae,{data:e,width:"95vw",maxWidth:"900px"}).afterClosed().pipe(_(1)).subscribe(o=>{if(o){let l=o.reduce((m,y)=>m+y.amount,0),f=(e.sellPrice||0)-((e.boughtPrice||0)+l);e.expenses=o,e.totalCost=l+(e.boughtPrice||0),e.pl=f,this._carsService.updateCar(u({},e)).pipe(_(1)).subscribe(m=>{m.data&&this._carsService.$updateCars(m.data,"edit")})}})}_openCarDialog(e){let o={hideClearButton:!0,title:{text:e?"Edit Car":"Add Car"},form:{value:u({isSold:!1,boughtDate:new Date},e||{}),fields:[{name:"carName",label:{text:"Car Name"},type:"text",required:!0},{name:"boughtPrice",label:{text:"Bought Price"},type:"number",required:!0},{name:"boughtDate",label:{text:"Bought Date"},type:"date",required:!0},{name:"sellPrice",label:{text:"Sold Price"},type:"number"},{name:"sellDate",label:{text:"Sold Date"},type:"date"},{name:"buyerName",label:{text:"Buyer Name"},type:"text"},{name:"buyerContact",label:{text:"Buyer Contact"},type:"textaria"},{name:"sellerName",label:{text:"Seller Name"},type:"text"},{name:"sellerContact",label:{text:"Seller Contact"},type:"textaria"},{name:"notes",label:{text:"Notes"},type:"textaria"},{name:"dealType",label:{text:"Deal Type"},type:"autocomplete",flexibleValue:!0,options:[{name:"Cash",value:"Cash"},{name:"Dekishe",value:"Dekishe"}]},{name:"isSold",label:{text:"Is Sold"},type:"checkbox"}]},beforeCloseObservable:l=>e?this._carsService.updateCar(u(u({},e),l)):this._carsService.addCar(l),getAfterSuccessResponse:l=>{l.data&&this._carsService.$updateCars(l.data,e?"edit":"add")}};this._dialog.openFormPopup(o,"900px")}_deleteCar(e){let o={title:{text:"Confirm Delete"},message:{text:"Are you sure you want to delete this car?"}};this._dialog.openConfirmPopup(o).afterClosed().pipe(_(1)).subscribe(l=>{l&&e?._id&&this._carsService.deleteCar(e)})}static{this.\u0275fac=function(o){return new(o||t)}}static{this.\u0275cmp=T({type:t,selectors:[["ks-solutions-cars"]],standalone:!0,features:[H([M]),$],decls:5,vars:6,consts:[[1,"container-fluid","my-5"],[1,"row","mb-3"],[1,"col-12"],[1,"cs-card","shadow-sm","border","border-3","rounded-2"],[3,"config"],[1,"container-fluid","text-center"],[1,"row","gy-2"],[1,"col-12","col-sm-12","col-md-6","col-lg-3"],[1,"ms-2"],[1,"row"],[1,"col-12","col-sm-6","col-md-6","col-lg-4","col-xl-3","mb-4"],[1,"cs-card","h-100","shadow-sm","border","border-1","rounded-2"],[1,"container"],[1,"col-12","col-md-6"],[1,"badge","ms-2",3,"ngClass"]],template:function(o,l){if(o&1&&(r(0,"div",0),h(1,ce,26,10,"div",1),C(2,"async"),h(3,Ie,1,1),C(4,"async"),n()),o&2){let f,m;i(),d((f=g(2,2,l.stats$))?1:-1,f),i(2),d((m=g(4,4,l.cars$))?3:-1,m)}},dependencies:[Y,D,J,Q,z],styles:[".cs-card[_ngcontent-%COMP%]{transition:transform .3s}"],changeDetection:0})}}return t})();export{at as CarsComponent};
