import{a as y}from"./chunk-H7FHUFND.js";import{a as d}from"./chunk-NZP3AJU7.js";import{a as h}from"./chunk-HMNUYURD.js";import{da as S,ea as b}from"./chunk-7Y4QU53B.js";import{m as p,o as v}from"./chunk-QLWHFAAO.js";import{N as u,a,b as c,ea as f,h as _,ka as l,o as x,sb as m}from"./chunk-72DPVO72.js";var A=(()=>{class g{constructor(){this._networkService=l(S),this._activatedRoute=l(p),this._storageService=l(b),this._router=l(v),this._menu=m(null),this._lang=m(void 0),this._loading$=new x(!0),this.menu=this._menu.asReadonly(),this.lang=this._lang.asReadonly(),this.loading$=this._loading$.asObservable(),this.selectedSectionSig=m(null)}getMenuData(){this._activatedRoute.params.pipe(u(1)).subscribe(t=>{if(t&&t.businessName){let e=t.businessName;if(this._loading$.next(!0),e.length>3){this._networkService.get(`${d.MENU.getMenuByEndpoint}/${e}`).pipe(u(1)).subscribe({next:i=>{if(i){let r=i.data;if(r){if(r.redirect){window.location.href=r.redirect;return}this._callLogApi(r.store.menuId),this._lang.set(r.store.mainLang);let n=c(a({},r),{sub_categories:r.sub_categories.map(s=>c(a({},s),{items:r.items.filter(o=>!o.hide&&o.subcategoryId===s._id).sort((o,w)=>o.order-w.order)})).filter(s=>!s.hide&&s.items.length).sort((s,o)=>s.order-o.order)});this._menu.set(n),this._lang.set(r.store.mainLang??"en")}}else this._router.navigateByUrl("")},error:()=>{this._router.navigateByUrl("")},complete:()=>{this._loading$.next(!1)}});return}this._networkService.getAssets("assets/json/mock-data.json").pipe(u(1)).subscribe({next:i=>{this._lang.set(i.store.mainLang);let r=c(a({},i),{store:c(a({},i.store),{templateId:e}),sub_categories:i.sub_categories.map(n=>c(a({},n),{items:i.items.filter(s=>!s.hide&&s.subcategoryId===n._id).sort((s,o)=>s.order-o.order)})).filter(n=>!n.hide&&n.items.length).sort((n,s)=>n.order-s.order)});this._menu.set(r),this._lang.set(i.store.mainLang)},error:()=>{this._router.navigateByUrl("")},complete:()=>{this._loading$.next(!1)}})}else this._router.navigateByUrl("")})}changeLang(t){t&&this._lang.set(t)}_callLogApi(t){return _(this,null,function*(){let e=new Date().getTime(),i=this._storageService.getItem(h.LS.menuTrack)||{},r=i[t];try{if(r){let n=Number(r);if(e-n<18e5)return}yield fetch(y.API_HOST+d.LOGS.logs,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(this._sendLogData(t))}),i[t]=e.toString(),this._storageService.setItem(h.LS.menuTrack,i)}catch(n){console.log(n)}})}_sendLogData(t){let e=this._storageService.getItem(h.LS.uuid);return e||(e=this._generateUUID(),this._storageService.setItem(h.LS.uuid,e)),{uuid:e,screenWidth:window.screen.width,screenHeight:window.screen.height,deviceOrientation:screen.orientation.type,service:t}}_generateUUID(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){let e=Math.random()*16|0;return(t==="x"?e:e&3|8).toString(16)})}static{this.\u0275fac=function(e){return new(e||g)}}static{this.\u0275prov=f({token:g,factory:g.\u0275fac,providedIn:"root"})}}return g})();export{A as a};
