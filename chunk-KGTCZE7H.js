import{a as N}from"./chunk-2JEUGO6G.js";import"./chunk-HMQVCYER.js";import"./chunk-77ANLJI6.js";import"./chunk-UZYDSN7X.js";import{a as R}from"./chunk-RN7YLSYN.js";import{a as P}from"./chunk-STDJW5YO.js";import{a as n}from"./chunk-M5ITMDMQ.js";import{a as D}from"./chunk-RP3GL3LT.js";import"./chunk-HMNUYURD.js";import{a as E}from"./chunk-ADGIJ6OL.js";import{M as C,_ as U,ba as k,fa as F,sa as A}from"./chunk-OXQU6EVE.js";import"./chunk-CARY4E7O.js";import"./chunk-SWSILSZJ.js";import{Fa as f,Hb as S,N as l,Nb as b,Ub as y,a as o,b as a,bc as _,ea as m,ka as r,n as c,oa as h,sb as x,uc as v,vc as w,y as u,z as d,zb as g}from"./chunk-ZZEMHH24.js";var p=(()=>{class s{constructor(){this._socketService=r(N),this._networkService=r(k),this._users$=new c,this.users$=d([this._socketService.onlineUsers$,this._users$]).pipe(u(([e,t])=>t.map(i=>a(o({},i),{online:!!i._id&&e.includes(i._id)}))))}getAllUsers(){this._networkService.get(n.USERS.listing).subscribe({next:e=>{this._users$.next(e.data?e.data:[])}})}addNewUser(e){return this._networkService.post(n.USERS.listing,e)}editUser(e){return this._networkService.patch(n.USERS.listing,e,e._id)}sendMessageToUserUser(e,t){return this._networkService.post(n.USERS.message,{userId:e._id,payload:t})}forceLogoutUser(e){this._networkService.post(n.USERS.forceLogout,{userId:e._id}).pipe(l(1)).subscribe()}toggleUserSuspension(e,t){return this._networkService.patch(n.USERS.suspend,e,t?"true":"false")}deleteUser(e){this._networkService.delete(n.USERS.listing,void 0,e._id).pipe(l(1)).subscribe({next:()=>{this.getAllUsers()}})}static{this.\u0275fac=function(t){return new(t||s)}}static{this.\u0275prov=m({token:s,factory:s.\u0275fac})}}return s})();function T(s,I){if(s&1&&y(0,"ks-basic-grid",0),s&2){let e=_();S("config",e.gridConfig)("refresh$",e.refresh$)}}var ie=(()=>{class s{constructor(){this._dialog=r(U),this._destroyRef=r(f),this._userService=r(p),this._navService=r(E),this._lovService=r(P),this._currentScreen=D("users_listing"),this.refresh$=new c}ngOnInit(){this._navService.updateNav({show:!0,back:!1,title:this._currentScreen.screenName,buttons:[{label:{text:"Create New"},prefixIcon:{icon:"icon_plus_circle"},hide:!this._currentScreen.insert,onClick:()=>{this._openUserPopup()}}]}),this._lovService.getRolesLov(),this._userService.getAllUsers(),this._initializeGrid(),this._userService.users$.pipe(C(this._destroyRef)).subscribe(e=>{this.refresh$.next({data:e})})}_initializeGrid(){this.gridConfig={data:x([]),defaultPagination:100,maxTableHeight:R.maxTableHeightWithSearch,noDataMessage:{text:"No Users Found"},elevation:8,features:{showSearch:!0},columns:[{field:"online",title:"Online",type:"chip",extraStyles:{"min-width":"100px"},position:"p-start",truthy:{false:"No",true:"Yes"},setChipClass:e=>e.online===!0?"rounded rounded-5 px-3 py-1 text-bg-success cs-w-120":"rounded rounded-5 px-3 py-1 text-bg-danger cs-w-120"},{field:"email",title:"email",type:"string",position:"p-start",extraStyles:{"min-width":"100px"}},{field:"name",title:"Name",type:"string",position:"p-start",extraStyles:{"min-width":"120px"}},{field:"role",title:"Role",type:"select",stream:{name:"name",value:"value",stream:this._lovService.rolesLov$},extraStyles:{"min-width":"180px"}},{field:"twoFactorEnabled",title:"2FA",type:"chip",extraStyles:{"min-width":"100px"},position:"p-start",truthy:{false:"No",true:"Yes"},setChipClass:e=>e.twoFactorEnabled===!0?"rounded rounded-5 px-3 py-1 text-bg-success cs-w-120":"rounded rounded-5 px-3 py-1 text-bg-danger cs-w-120"},{field:"isOAuthUser",title:"OAuth",type:"chip",extraStyles:{"min-width":"100px"},position:"p-start",truthy:{false:"No",true:"Yes"},setChipClass:e=>e.isOAuthUser===!0?"rounded rounded-5 px-3 py-1 text-bg-success cs-w-120":"rounded rounded-5 px-3 py-1 text-bg-danger cs-w-120"},{field:"passwordRetries",title:"Retries",type:"number",extraStyles:{"min-width":"100px"}},{field:"active",title:"Active",type:"chip",extraStyles:{"min-width":"100px"},position:"p-start",truthy:{false:"No",true:"Yes"},setChipClass:e=>e.active===!0?"rounded rounded-5 px-3 py-1 text-bg-success cs-w-120":"rounded rounded-5 px-3 py-1 text-bg-danger cs-w-120"},{field:"suspended",title:"Suspended",type:"chip",extraStyles:{"min-width":"100px"},position:"p-start",truthy:{false:"No",true:"Yes"},setChipClass:e=>e.suspended===!0?"rounded rounded-5 px-3 py-1 text-bg-success cs-w-120":"rounded rounded-5 px-3 py-1 text-bg-danger cs-w-120"},{field:"isDeleted",title:"Deleted",type:"chip",extraStyles:{"min-width":"100px"},position:"p-start",truthy:{false:"No",true:"Yes"},setChipClass:e=>e.isDeleted===!0?"rounded rounded-5 px-3 py-1 text-bg-success cs-w-120":"rounded rounded-5 px-3 py-1 text-bg-danger cs-w-120"},{field:"createdAt",title:"Created At",type:"date",dateFormat:"dd/MM/yyyy - HH:mm:ss a",extraStyles:{"min-width":"180px"}}],actionsColumn:{enabled:this._currentScreen.update||this._currentScreen.delete,maxButtons:window.innerWidth<700?1:void 0,maxWidth:window.innerWidth<700?void 0:"240px",minWidth:window.innerWidth<700?void 0:"240px",buttons:[{prefixIcon:{icon:"icon_message"},label:{text:"Send Message"},onClickFn:e=>this._sendMessage(e),isVisibleFn:e=>!!e.online,matType:"mat-icon-button",tooltip:{message:{text:"Send Message"},showDelay:100}},{prefixIcon:{icon:"icon_logout"},label:{text:"Force Logout"},onClickFn:e=>this._forceLogout(e),isVisibleFn:e=>this._currentScreen.update&&!!e.online,matType:"mat-icon-button",tooltip:{message:{text:"Force Logout"},showDelay:100}},{prefixIcon:{icon:"icon_block"},label:{text:"Suspend"},onClickFn:e=>this._toggleSuspension(e),isVisibleFn:e=>this._currentScreen.update&&!e.suspended,matType:"mat-icon-button",tooltip:{message:{text:"Suspend"},showDelay:100}},{prefixIcon:{icon:"icon_check_circle"},label:{text:"Unsuspend"},onClickFn:e=>this._toggleSuspension(e),isVisibleFn:e=>this._currentScreen.update&&!!e.suspended,matType:"mat-icon-button",tooltip:{message:{text:"Unsuspend"},showDelay:100}},{prefixIcon:{icon:"icon_edit"},label:{text:"Edit"},onClickFn:e=>this._openUserPopup(e),isVisibleFn:()=>this._currentScreen.update,matType:"mat-icon-button"},{prefixIcon:{icon:"icon_delete",color:"red"},label:{text:"Delete"},onClickFn:e=>this._deleteUser(e),isVisibleFn:()=>this._currentScreen.delete,matType:"mat-icon-button"}]}}}_openUserPopup(e){let t={title:{text:e?"Edit user":"Add User"},hideClearButton:!0,form:{value:e,fields:[{type:"text",name:"email",label:{text:"Email"},required:!0,minLength:4,maxLength:50,readonly:!!e,extraValidators:[F],preventSpace:!0},{type:"text",name:"name",label:{text:"Name"},required:!0,minLength:4,maxLength:30},{type:"select",name:"role",label:{text:"Role"},required:!0,stream:this._lovService.rolesLov$,transformer:{nameKey:"name",valueKey:"value"}},{type:"password",name:"password",label:{text:e?"Change Password":"Password"},minLength:4,required:!e},{type:"number",name:"passwordRetries",label:{text:"Password Retries"}},{type:"checkbox",name:"active",label:{text:"Active"}},{type:"checkbox",name:"isOAuthUser",label:{text:"OAuth"}},{type:"checkbox",name:"twoFactorEnabled",label:{text:"2FA"}},{type:"checkbox",name:"isDeleted",label:{text:"Deleted"}},{type:"toggle",name:"_sendEmail",label:{text:"Send Welcome Email"},hide:!!e}],formatFormValue:!0},beforeCloseObservable:i=>e?this._userService.editUser(o(o({},e),i)):this._userService.addNewUser(i),getAfterSuccessResponse:()=>{this._userService.getAllUsers()}};this._dialog.openFormPopup(t,"900px")}_toggleSuspension(e){let t={title:{text:e.suspended?"Unsuspend User":"Suspend User"},hideClearButton:!0,form:{value:e,fields:[{name:"sendEmail",label:{text:"Send Email"},type:"checkbox"}]},beforeCloseObservable:i=>this._userService.toggleUserSuspension(e,i.sendEmail),getAfterSuccessResponse:()=>{this._userService.getAllUsers()}};this._dialog.openFormPopup(t,"500px")}_deleteUser(e){let t={title:{text:"Confirm Delete"},message:{text:"Are you certain you want to delete this user?"}};this._dialog.openConfirmPopup(t).afterClosed().pipe(l(1)).subscribe(i=>{i&&e?._id&&this._userService.deleteUser(e)})}_sendMessage(e){let t={title:{text:"Send message"},saveButton:{label:{text:"Send"},prefixIcon:{icon:"icon_play"},matType:"mat-flat-button"},hideClearButton:!0,form:{value:{title:"Message",user:e.name},fields:[{name:"user",type:"text",label:{text:"User"},readonly:!0},{name:"title",type:"text",label:{text:"Dialog Title"},maxLength:50},{name:"message",label:{text:"Message"},type:"text",required:!0}]},beforeCloseObservable:i=>this._userService.sendMessageToUserUser(e,a(o({},i),{isDialog:!0}))};this._dialog.openFormPopup(t,"500px")}_forceLogout(e){let t={title:{text:"Confirm Logout"},message:{text:"Are you certain you want to force logout this user?"}};this._dialog.openConfirmPopup(t).afterClosed().pipe(l(1)).subscribe(i=>{i&&e?._id&&this._userService.forceLogoutUser(e)})}static{this.\u0275fac=function(t){return new(t||s)}}static{this.\u0275cmp=h({type:s,selectors:[["ks-solutions-users-listing"]],standalone:!0,features:[v([p]),w],decls:1,vars:1,consts:[[3,"config","refresh$"]],template:function(t,i){t&1&&g(0,T,1,2,"ks-basic-grid",0),t&2&&b(i.gridConfig?0:-1)},dependencies:[A],changeDetection:0})}}return s})();export{ie as UsersComponent};
