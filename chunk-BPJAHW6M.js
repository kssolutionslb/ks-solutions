import{a as M}from"./chunk-JHOHYJWD.js";import{a as N}from"./chunk-K4KT5SNZ.js";import{a as s}from"./chunk-NDEZYEOM.js";import{a as A}from"./chunk-XELMOVSA.js";import"./chunk-HMNUYURD.js";import{a as E}from"./chunk-N2PVEWVS.js";import{O as R,aa as C,da as w,va as k}from"./chunk-MMBMDBOW.js";import"./chunk-CARY4E7O.js";import"./chunk-4KKA7PE6.js";import{Ab as _,Fa as m,Ib as S,N as n,Ob as v,Vb as b,a,cc as x,ea as u,ka as o,n as d,o as c,oa as h,tb as f,vc as y,wc as g,y as p}from"./chunk-VO6IE2C5.js";var l=(()=>{class i{constructor(){this._networkService=o(w),this._roles=new c([]),this.roles$=this._roles.asObservable(),this.rolesLov$=this._roles.asObservable().pipe(p(e=>e.filter(t=>t._id)))}getAllRoles(){this._networkService.get(s.ROLES.role).pipe(n(1)).subscribe({next:e=>{e&&e.data&&this._roles.next(e.data)}})}addRole(e){return this._networkService.post(s.ROLES.role,e)}updateRole(e){return this._networkService.patch(s.ROLES.role,e,e.value)}deleteRole(e){this._networkService.delete(s.ROLES.role,void 0,e.value).pipe(n(1)).subscribe({next:()=>{this._updateMenus(e,"delete")}})}_updateMenus(e,t){M.UpdateArrayBehaviorSubject(this._roles,e,t,"_id")}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275prov=u({token:i,factory:i.\u0275fac})}}return i})();function F(i,I){if(i&1&&b(0,"ks-basic-grid",0),i&2){let e=x();S("config",e.gridConfig)("refresh$",e.refresh$)}}var X=(()=>{class i{constructor(){this._destroyRef=o(m),this._navService=o(E),this._dialog=o(C),this._roleService=o(l),this._currentScreen=A("roles_listing"),this._data=[],this.refresh$=new d}ngOnInit(){this._navService.updateNav({show:!0,back:!1,title:this._currentScreen.screenName,buttons:[{label:{text:"Create New"},prefixIcon:{icon:"icon_plus_circle"},hide:!this._currentScreen.insert,onClick:()=>{this._openMenu()}}]}),this._roleService.getAllRoles(),this._initializeGrid(),this._roleService.roles$.pipe(R(this._destroyRef)).subscribe(e=>{this._data=e,this.refresh$.next({data:this._data})})}_initializeGrid(){this.gridConfig={data:f([]),defaultPagination:100,maxTableHeight:N.maxTableHeightWithSearch,noDataMessage:{text:"No Roles Found"},features:{showSearch:!0,trackChanges:!0},elevation:2,columns:[{field:"value",title:"Role Name",type:"string"},{field:"name",title:"Displayed Name",type:"string",extraStyles:{"min-width":"170px"}},{field:"createdAt",title:"Created At",type:"date",dateFormat:"dd/MM/yyyy - HH:mm:ss a",extraStyles:{"min-width":"170px"}},{field:"updatedAt",title:"Last Updated At",type:"date",dateFormat:"dd/MM/yyyy - HH:mm:ss a",extraStyles:{"min-width":"170px"}}],actionsColumn:{enabled:this._currentScreen.update||this._currentScreen.delete,maxButtons:window.innerWidth<700?1:void 0,maxWidth:window.innerWidth<700?void 0:"110px",minWidth:window.innerWidth<700?void 0:"110px",buttons:[{prefixIcon:{icon:"icon_edit"},label:{text:"Edit"},onClickFn:e=>this._openMenu(e),isVisibleFn:()=>this._currentScreen.update,matType:"mat-icon-button"},{prefixIcon:{icon:"icon_delete",color:"red"},label:{text:"Delete"},onClickFn:e=>this._deleteInventory(e),isVisibleFn:()=>this._currentScreen.delete,matType:"mat-icon-button"}]}}}_openMenu(e){let t={title:{text:e?"Edit Role":"Add Role"},form:{value:e,fields:[{name:"value",label:{text:"Role Name"},type:"text",preventSpace:!0,required:!0,readonly:!!e},{name:"name",label:{text:"Displayed Name"},type:"text",required:!0}]},beforeCloseObservable:r=>e?this._roleService.updateRole(a(a({},e),r)):this._roleService.addRole(r),getAfterSuccessResponse:r=>{r.data&&this._roleService._updateMenus(r.data,e?"edit":"add")}};this._dialog.openFormPopup(t,"500px")}_deleteInventory(e){let t={title:{text:"Confirm Delete"},message:{text:"Are you sure you want to delete this role?"}};this._dialog.openConfirmPopup(t).afterClosed().pipe(n(1)).subscribe(r=>{r&&e?._id&&this._roleService.deleteRole(e)})}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=h({type:i,selectors:[["ks-solutions-roles-listing"]],standalone:!0,features:[y([l]),g],decls:1,vars:1,consts:[[3,"config","refresh$"]],template:function(t,r){t&1&&_(0,F,1,2,"ks-basic-grid",0),t&2&&v(r.gridConfig?0:-1)},dependencies:[k],changeDetection:0})}}return i})();export{X as RolesComponent};
