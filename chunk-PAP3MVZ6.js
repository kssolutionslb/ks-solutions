import{a as y}from"./chunk-U5RD573Z.js";import{a as A}from"./chunk-JDEWHVZM.js";import"./chunk-HMNUYURD.js";import{a as E}from"./chunk-VMV3LQCJ.js";import{a as oe}from"./chunk-VL4WVYQ7.js";import{O as te,aa as F,da as ie,ra as N,v as Z,va as ne,w as ee}from"./chunk-OMSYFKJ3.js";import"./chunk-CARY4E7O.js";import"./chunk-Z72V5FLM.js";import{Dc as x,Ec as g,Fa as O,Fc as j,Hb as v,N as C,Nb as d,Ob as I,Qb as P,Rb as w,Sb as r,Tb as o,Ub as V,a as _,b as W,bc as c,bd as Y,ea as G,gd as J,hb as n,ib as R,id as Q,ka as u,kd as X,mc as a,n as q,nc as B,o as T,oa as D,oc as p,pc as H,sb as b,uc as K,vc as k,wc as z,xc as M,y as $,zb as h}from"./chunk-P5AQMEDB.js";var U=(()=>{class t{constructor(){this._networkService=u(ie),this._cars$=new T([]),this.cars$=this._cars$.asObservable().pipe($(e=>e.map(i=>W(_({},i),{_notes:i.notes?.split(`
`).map(l=>l.trim()).filter(Boolean)}))))}getCars(){this._networkService.get(E.CARS.cars).pipe(C(1)).subscribe(e=>{e.data&&this._cars$.next(e.data)})}addCar(e){return this._networkService.post(E.CARS.cars,e)}updateCar(e){return this._networkService.patch(E.CARS.cars,e,e._id)}deleteCar(e){this._networkService.delete(E.CARS.cars,e,e._id).pipe(C(1)).subscribe(i=>{i&&this.$updateCars(e,"delete")})}$updateCars(e,i){y.UpdateArrayBehaviorSubject(this._cars$,e,i)}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=G({token:t,factory:t.\u0275fac})}}return t})();function le(t,s){if(t&1&&V(0,"ks-basic-grid",1),t&2){let e=c();v("config",e.gridConfig)("refresh$",e.refresh$)}}var re=(()=>{class t{constructor(e,i){this._dialogRef=e,this.data=i,this._destroyRef=u(O),this._dialog=u(F),this._currentScreen=A("cars_listing"),this._expense$=new T([]),this.refresh$=new q,this.cardConfig={header:{title:{text:"Car Expenses",tag:"h3",fontWeight:"700"},position:"center",suffixButton:{label:{text:"Close"},matType:"mat-icon-button",prefixIcon:{icon:"icon_x_circle"},onClick:()=>{this._dialogRef.close()}}},content:{addClass:"card p-2"},footer:{buttons:[this._currentScreen.update?{label:{text:"Save"},matType:"mat-flat-button",prefixIcon:{icon:"icon_save"},onClick:()=>{this._save()}}:{label:{text:"Close"},onClick:()=>{this._dialogRef.close()},matType:"mat-flat-button"}],position:"center"}}}ngOnInit(){let e=this.data?.expenses||[];this._initializeGrid(e),this._expense$.next(e),this._expense$.pipe(te(this._destroyRef)).subscribe(i=>{this.refresh$.next({data:i})})}_initializeGrid(e){this.gridConfig={data:b(e),defaultPagination:100,maxTableHeight:"calc(100dvh - 400px)",noDataMessage:{text:"This car has no expenses"},features:{showAddButton:this._currentScreen.update,addButtonClicked:()=>{this._openExpensePopup()}},columns:[{field:"name",title:"Expense",type:"string",extraStyles:{"min-width":"150px"}},{field:"amount",title:"Amount",type:"number",extraStyles:{"min-width":"100px"}},{field:"isPayed",title:"Payed",type:"chip",extraStyles:{width:"120px"},position:"p-start",truthy:{false:"No",true:"Yes"},setChipClass:i=>i.isPayed===!0?"rounded rounded-5 px-3 py-1 text-bg-success cs-w-120":"rounded rounded-5 px-3 py-1 text-bg-danger cs-w-120"},{field:"date",title:"Date",type:"date",dateFormat:"dd/MM/yyyy",extraStyles:{"min-width":"100px"}},{field:"notes",title:"Notes",type:"string",extraStyles:{"min-width":"150px"}}],actionsColumn:{maxButtons:window.innerWidth<700?1:void 0,maxWidth:window.innerWidth<700?void 0:"110px",minWidth:window.innerWidth<700?void 0:"110px",enabled:this._currentScreen.update||this._currentScreen.delete,buttons:[{prefixIcon:{icon:"icon_edit"},label:{text:"Edit"},onClickFn:i=>this._openExpensePopup(i),isVisibleFn:()=>this._currentScreen.update,matType:"mat-icon-button"},{prefixIcon:{icon:"icon_delete",color:"red"},label:{text:"Delete"},onClickFn:i=>this._deleteExpense(i),isVisibleFn:()=>this._currentScreen.delete,matType:"mat-icon-button"}]}}}_openExpensePopup(e){let i={hideClearButton:!0,title:{text:e?"Edit Expense":"Add Expense"},form:{value:e,fields:[{name:"name",type:"text",label:{text:"Expense"},required:!0,maxLength:70,minLength:4},{name:"amount",label:{text:"Amount"},type:"number",required:!0},{name:"date",label:{text:"Date"},type:"date",required:!0},{name:"notes",label:{text:"Notes"},type:"textaria",maxLength:70},{name:"isPayed",label:{text:"Payed"},type:"toggle"}]}};this._dialog.openFormPopup(i,"500px").afterClosed().pipe(C(1)).subscribe(l=>{l&&(e?y.UpdateArrayBehaviorSubjectById(this._expense$,_(_({},e),l),"edit"):(l.id=new Date().getTime(),y.UpdateArrayBehaviorSubjectById(this._expense$,l,"add")))})}_deleteExpense(e){this._dialog.openConfirmPopup({title:{text:"Confirm Delete"},message:{text:"Are you sure you want to delete this Expense?"}}).afterClosed().pipe(C(1)).subscribe(i=>{i&&y.UpdateArrayBehaviorSubjectById(this._expense$,e,"delete")})}_save(){this._dialogRef.close(this._expense$.getValue())}static{this.\u0275fac=function(i){return new(i||t)(R(Z),R(ee))}}static{this.\u0275cmp=D({type:t,selectors:[["ks-solutions-expenses-listing"]],standalone:!0,features:[k],decls:2,vars:2,consts:[[3,"config"],[3,"config","refresh$"]],template:function(i,l){i&1&&(r(0,"ks-base-card",0),h(1,le,1,2,"ks-basic-grid",1),o()),i&2&&(v("config",l.cardConfig),n(),d(l.gridConfig?1:-1))},dependencies:[ne,N],changeDetection:0})}}return t})();var se=()=>({text:"Summary",tag:"h4",translate:!1}),de=t=>({title:t,position:"center"}),ce=t=>({header:t});function pe(t,s){if(t&1&&(r(0,"div",1)(1,"div",2)(2,"div",3)(3,"ks-base-card",4)(4,"div",5)(5,"div",6)(6,"div",7)(7,"strong"),a(8,"Total Profit/Loss:"),o(),r(9,"span",8),a(10),o()(),r(11,"div",7)(12,"strong"),a(13,"Total Raymond:"),o(),r(14,"span",8),a(15),o()(),r(16,"div",7)(17,"strong"),a(18,"Total Sold Cars:"),o(),r(19,"span",8),a(20),o()(),r(21,"div",7)(22,"strong"),a(23,"Total Unsold Cars:"),o(),r(24,"span",8),a(25),o()()()()()()()()),t&2){let e=s;n(3),v("config",M(8,ce,M(6,de,z(5,se)))),n(7),p("$",e.totalProfit,""),n(5),p("$",e.totalRaymond,""),n(5),B(e.totalSoldCars),n(5),B(e.totalUnsoldCars)}}function me(t,s){if(t&1&&(r(0,"div",2)(1,"strong"),a(2,"Status:"),o(),r(3,"span",14),a(4),o()()),t&2){let e=c().$implicit;n(3),v("ngClass",e.isSold?"bg-success":"bg-warning"),n(),p(" ",e.isSold?"Sold":"Available"," ")}}function _e(t,s){if(t&1&&(r(0,"div",13)(1,"strong"),a(2,"Profit/Loss:"),o(),a(3),x(4,"currency"),o()),t&2){let e=c().$implicit;n(3),p(" ",g(4,1,e.pl)," ")}}function Ce(t,s){if(t&1&&(r(0,"div",13)(1,"strong"),a(2,"Total Cost:"),o(),a(3),x(4,"currency"),o()),t&2){let e=c().$implicit;n(3),p(" ",g(4,1,e.totalCost)," ")}}function ue(t,s){if(t&1&&(r(0,"div",13)(1,"strong"),a(2,"Bought At:"),o(),a(3),x(4,"date"),o()),t&2){let e=c().$implicit;n(3),p(" ",j(4,1,e.boughtDate,"dd MMM yyyy")," ")}}function xe(t,s){if(t&1&&(r(0,"div",13)(1,"strong"),a(2,"Sold At:"),o(),a(3),x(4,"date"),o()),t&2){let e=c().$implicit;n(3),p(" ",j(4,1,e.sellDate,"dd MMM yyyy")," ")}}function fe(t,s){if(t&1&&(r(0,"div",13)(1,"strong"),a(2,"Bought Price:"),o(),a(3),x(4,"currency"),o()),t&2){let e=c().$implicit;n(3),p(" ",g(4,1,e.boughtPrice)," ")}}function he(t,s){if(t&1&&(r(0,"div",13)(1,"strong"),a(2,"Sold Price:"),o(),a(3),x(4,"currency"),o()),t&2){let e=c().$implicit;n(3),p(" ",g(4,1,e.sellPrice)," ")}}function ve(t,s){if(t&1&&(r(0,"div",13)(1,"strong"),a(2,"Deal Type:"),o(),a(3),o()),t&2){let e=c().$implicit;n(3),p(" ",e.dealType," ")}}function ge(t,s){if(t&1&&(r(0,"div",13)(1,"strong"),a(2,"Seller Name:"),o(),a(3),o()),t&2){let e=c().$implicit;n(3),p(" ",e.sellerName," ")}}function Se(t,s){if(t&1&&(r(0,"div",13)(1,"strong"),a(2,"Seller Contact:"),o(),a(3),o()),t&2){let e=c().$implicit;n(3),p(" ",e.sellerContact," ")}}function ye(t,s){if(t&1&&(r(0,"div",13)(1,"strong"),a(2,"Buyer Name:"),o(),a(3),o()),t&2){let e=c().$implicit;n(3),p(" ",e.buyerName," ")}}function be(t,s){if(t&1&&(r(0,"div",13)(1,"strong"),a(2,"Buyer Contact:"),o(),a(3),o()),t&2){let e=c().$implicit;n(3),p(" ",e.buyerContact," ")}}function Ee(t,s){if(t&1&&(r(0,"li"),a(1),o()),t&2){let e=s.$implicit;n(),p(" ",e," ")}}function Te(t,s){if(t&1&&(r(0,"div",2)(1,"strong"),a(2,"Notes:"),o(),r(3,"ul"),P(4,Ee,2,1,"li",null,I),o()()),t&2){let e=c().$implicit;n(4),w(e._notes)}}function $e(t,s){if(t&1&&(r(0,"li"),a(1),r(2,"b"),a(3),o()()),t&2){let e=s.$implicit;n(),H(" ",e.name," (",e.amount,") "),n(2),B(e.isPayed?"Paid":"Unpaid")}}function De(t,s){if(t&1&&(r(0,"div",2)(1,"strong"),a(2,"Expenses:"),o(),r(3,"ul"),P(4,$e,4,3,"li",null,I),o()()),t&2){let e=c().$implicit;n(4),w(e.expenses)}}function Ie(t,s){if(t&1&&(r(0,"div",10)(1,"div",11)(2,"ks-base-card",4)(3,"div",12)(4,"div",6),h(5,me,5,2,"div",2)(6,_e,5,3,"div",13)(7,Ce,5,3,"div",13)(8,ue,5,4,"div",13)(9,xe,5,4,"div",13)(10,fe,5,3,"div",13)(11,he,5,3,"div",13)(12,ve,4,1,"div",13)(13,ge,4,1,"div",13)(14,Se,4,1,"div",13)(15,ye,4,1,"div",13)(16,be,4,1,"div",13)(17,Te,6,0,"div",2)(18,De,6,0,"div",2),o()()()()()),t&2){let e=s.$implicit,i=c(3);n(2),v("config",i.getCardConfig(e)),n(3),d(e.isSold!==null?5:-1),n(),d(e.pl!==void 0&&e.pl!==null&&e.isSold?6:-1),n(),d(e.totalCost!==void 0&&e.totalCost!==null?7:-1),n(),d(e.boughtDate?8:-1),n(),d(e.sellDate&&e.isSold?9:-1),n(),d(e.boughtPrice!==void 0&&e.boughtPrice!==null?10:-1),n(),d(e.sellPrice!==void 0&&e.sellPrice!==null&&e.isSold?11:-1),n(),d(e.dealType?12:-1),n(),d(e.sellerName?13:-1),n(),d(e.sellerContact?14:-1),n(),d(e.buyerName&&e.isSold?15:-1),n(),d(e.buyerContact&&e.isSold?16:-1),n(),d(e._notes!=null&&e._notes.length?17:-1),n(),d(e.expenses!=null&&e.expenses.length?18:-1)}}function Pe(t,s){if(t&1&&(r(0,"div",9),P(1,Ie,19,15,"div",10,I),o()),t&2){let e=c();n(),w(e)}}function we(t,s){t&1&&h(0,Pe,3,0,"div",9),t&2&&d(s.length?0:-1)}var st=(()=>{class t{constructor(){this._dialog=u(F),this._carsService=u(U),this._navService=u(oe),this._currentScreen=A("cars_listing"),this._cannotUpdate=b(!this._currentScreen.update),this._cannotDelete=b(!this._currentScreen.delete),this.cars$=this._carsService.cars$,this.stats$=this.cars$.pipe($(e=>{let i=0,l=0,f=0,m=0;for(let S of e)if(S.isSold?(f+=1,i+=S.pl||0):m+=1,Array.isArray(S.expenses))for(let L of S.expenses)L?.name?.toLowerCase?.()==="raymond"&&(l+=L.amount||0);return{totalProfit:i,totalRaymond:l,totalSoldCars:f,totalUnsoldCars:m}}))}ngOnInit(){this._carsService.getCars(),this._navService.updateNav({show:!0,back:!1,title:this._currentScreen.screenName,buttons:[{label:{text:"Create New"},prefixIcon:{icon:"icon_plus_circle"},hide:!this._currentScreen.insert,onClick:()=>{this._openCarDialog()}}]})}getCardConfig(e){return{header:{title:{text:e.carName,tag:"h4",translate:!1,addClass:"pt-3"}},footer:{buttons:[{label:{text:"Expenses"},prefixIcon:{icon:"icon_money"},onClick:()=>{this._openExpenseDialog(e)}},{label:{text:"Edit"},prefixIcon:{icon:"icon_edit"},onClick:()=>{this._openCarDialog(e)},hide:this._cannotUpdate},{label:{text:"Delete"},prefixIcon:{icon:"icon_delete"},color:"warn",onClick:()=>{this._deleteCar(e)},hide:this._cannotDelete}],position:"end"},addClass:"h-100"}}_openExpenseDialog(e){this._dialog.open(re,{data:e,width:"95vw",maxWidth:"900px"}).afterClosed().pipe(C(1)).subscribe(i=>{if(i){let l=i.reduce((m,S)=>m+S.amount,0),f=(e.sellPrice||0)-((e.boughtPrice||0)+l);e.expenses=i,e.totalCost=l+(e.boughtPrice||0),e.pl=f,this._carsService.updateCar(_({},e)).pipe(C(1)).subscribe(m=>{m.data&&this._carsService.$updateCars(m.data,"edit")})}})}_openCarDialog(e){let i={hideClearButton:!0,title:{text:e?"Edit Car":"Add Car"},form:{value:_({isSold:!1,boughtDate:new Date},e||{}),fields:[{name:"carName",label:{text:"Car Name"},type:"text",required:!0},{name:"boughtPrice",label:{text:"Bought Price"},type:"number",required:!0},{name:"boughtDate",label:{text:"Bought Date"},type:"date",required:!0},{name:"sellPrice",label:{text:"Sold Price"},type:"number"},{name:"sellDate",label:{text:"Sold Date"},type:"date"},{name:"buyerName",label:{text:"Buyer Name"},type:"text"},{name:"buyerContact",label:{text:"Buyer Contact"},type:"textaria"},{name:"sellerName",label:{text:"Seller Name"},type:"text"},{name:"sellerContact",label:{text:"Seller Contact"},type:"textaria"},{name:"notes",label:{text:"Notes"},type:"textaria"},{name:"dealType",label:{text:"Deal Type"},type:"autocomplete",flexibleValue:!0,options:[{name:"Cash",value:"Cash"},{name:"Dekishe",value:"Dekishe"}]},{name:"isSold",label:{text:"Is Sold"},type:"checkbox"}]},beforeCloseObservable:l=>e?this._carsService.updateCar(_(_({},e),l)):this._carsService.addCar(l),getAfterSuccessResponse:l=>{l.data&&this._carsService.$updateCars(l.data,e?"edit":"add")}};this._dialog.openFormPopup(i,"900px")}_deleteCar(e){let i={title:{text:"Confirm Delete"},message:{text:"Are you sure you want to delete this car?"}};this._dialog.openConfirmPopup(i).afterClosed().pipe(C(1)).subscribe(l=>{l&&e?._id&&this._carsService.deleteCar(e)})}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=D({type:t,selectors:[["ks-solutions-cars"]],standalone:!0,features:[K([U]),k],decls:5,vars:6,consts:[[1,"container-fluid","my-5"],[1,"row","mb-3"],[1,"col-12"],[1,"cs-card","shadow-sm","border","border-3","rounded-2"],[3,"config"],[1,"container-fluid","text-center"],[1,"row","gy-2"],[1,"col-12","col-sm-12","col-md-6","col-lg-3"],[1,"ms-2"],[1,"row"],[1,"col-12","col-sm-6","col-md-6","col-lg-4","col-xl-3","mb-4"],[1,"cs-card","h-100","shadow-sm","border","border-1","rounded-2"],[1,"container"],[1,"col-12","col-md-6"],[1,"badge","ms-2",3,"ngClass"]],template:function(i,l){if(i&1&&(r(0,"div",0),h(1,pe,26,10,"div",1),x(2,"async"),h(3,we,1,1),x(4,"async"),o()),i&2){let f,m;n(),d((f=g(2,2,l.stats$))?1:-1,f),n(2),d((m=g(4,4,l.cars$))?3:-1,m)}},dependencies:[J,N,Q,X,Y],styles:[".cs-card[_ngcontent-%COMP%]{transition:transform .3s}"],changeDetection:0})}}return t})();export{st as CarsComponent};
