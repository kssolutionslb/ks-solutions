import{a as k}from"./chunk-JHOHYJWD.js";import{a as P}from"./chunk-5E3HR263.js";import{a as N}from"./chunk-V4S4ILHZ.js";import{a}from"./chunk-MIQK74YD.js";import{a as I}from"./chunk-XELMOVSA.js";import"./chunk-HMNUYURD.js";import{a as A}from"./chunk-N2PVEWVS.js";import{O as b,aa as w,da as R,va as C}from"./chunk-MMBMDBOW.js";import"./chunk-CARY4E7O.js";import"./chunk-4KKA7PE6.js";import{Ab as f,Fa as u,Ib as _,N as s,Ob as x,Vb as v,a as o,cc as y,ea as l,ka as n,n as c,o as m,oa as p,tb as h,vc as S,wc as g}from"./chunk-VO6IE2C5.js";var d=(()=>{class t{constructor(){this._networkService=n(R),this._rms$=new m([]),this.rms$=this._rms$.asObservable()}getAllRms(){this._networkService.get(a.RMS_PANEL.rms).pipe(s(1)).subscribe({next:e=>{e&&e.data&&this._rms$.next(e.data)}})}addRms(e){return this._networkService.post(a.RMS_PANEL.rms,e)}updateRms(e){return this._networkService.patch(a.RMS_PANEL.rms,e,e._id)}deleteRms(e){this._networkService.delete(a.RMS_PANEL.rms,void 0,e._id).pipe(s(1)).subscribe({next:()=>{this._updateRms(e,"delete")}})}_updateRms(e,i){k.UpdateArrayBehaviorSubject(this._rms$,e,i,"_id")}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=l({token:t,factory:t.\u0275fac})}}return t})();function E(t,$){if(t&1&&v(0,"ks-basic-grid",0),t&2){let e=y();_("config",e.gridConfig)("refresh$",e.refresh$)}}var X=(()=>{class t{constructor(){this._destroyRef=n(u),this._navService=n(A),this._lovService=n(N),this._dialog=n(w),this._menuPanelService=n(d),this._currentScreen=I("rms_panel"),this.refresh$=new c}ngOnInit(){this._navService.updateNav({show:!0,back:!1,title:this._currentScreen.screenName,buttons:[{label:{text:"Create New"},prefixIcon:{icon:"icon_plus_circle"},hide:!this._currentScreen.insert,onClick:()=>{this._openRms()}}]}),this._menuPanelService.getAllRms(),this._initializeGrid(),this._menuPanelService.rms$.pipe(b(this._destroyRef)).subscribe(e=>{this.refresh$.next({data:e})})}_initializeGrid(){this.gridConfig={data:h([]),defaultPagination:100,maxTableHeight:P.maxTableHeightWithSearch,noDataMessage:{text:"No Items Found"},features:{showSearch:!0,trackChanges:!0},elevation:2,columns:[{field:"name",title:"Name",type:"string",extraStyles:{"min-width":"120px"}},{field:"ownerId",title:"Owner",type:"select",stream:{name:"name",value:"_id",stream:this._lovService.userLov$},extraStyles:{"min-width":"120px"}},{field:"currentVersion",title:"Current Version",type:"string",extraStyles:{"min-width":"120px"}},{field:"hasReportAccess",title:"Report",type:"chip",extraStyles:{"min-width":"100px","max-width":"100px"},position:"p-start",truthy:{false:"No",true:"Yes"},setChipClass:e=>e.hasReportAccess===!0?"rounded rounded-5 px-3 py-1 text-bg-success cs-w-120":"rounded rounded-5 px-3 py-1 text-bg-danger cs-w-120"},{field:"hasInvoiceAccess",title:"Invoice",type:"chip",extraStyles:{"min-width":"100px","max-width":"100px"},position:"p-start",truthy:{false:"No",true:"Yes"},setChipClass:e=>e.hasInvoiceAccess===!0?"rounded rounded-5 px-3 py-1 text-bg-success cs-w-120":"rounded rounded-5 px-3 py-1 text-bg-danger cs-w-120"},{field:"createdAt",title:"Created At",type:"date",dateFormat:"dd/MM/yyyy - HH:mm:ss a",extraStyles:{"min-width":"170px"}},{field:"updatedAt",title:"Last Updated At",type:"date",dateFormat:"dd/MM/yyyy - HH:mm:ss a",extraStyles:{"min-width":"170px"}}],actionsColumn:{maxButtons:window.innerWidth<700?1:void 0,maxWidth:window.innerWidth<700?void 0:"110px",minWidth:window.innerWidth<700?void 0:"110px",enabled:this._currentScreen.update||this._currentScreen.delete,buttons:[{prefixIcon:{icon:"icon_edit"},label:{text:"Edit"},onClickFn:e=>this._openRms(e),isVisibleFn:()=>this._currentScreen.update,matType:"mat-icon-button"},{prefixIcon:{icon:"icon_delete",color:"red"},label:{text:"Delete"},onClickFn:e=>this._deleteInventory(e),isVisibleFn:()=>this._currentScreen.delete,matType:"mat-icon-button"}]}}}_openRms(e){let i={title:{text:e?"Edit Rms":"Add Rms"},form:{groups:[{id:1,name:{text:"Credentials"},order:1}],value:o({expiresAt:new Date(new Date().getFullYear()+1,new Date().getMonth(),new Date().getDate())},e||{}),fields:[{name:"name",label:{text:"Rms Name"},type:"text",required:!0},{name:"ownerId",type:"autocomplete",stream:this._lovService.userLov$,label:{text:"Rms Owner"},transformer:{nameKey:"name",valueKey:"_id"},required:!0},{name:"editorsId",type:"select",label:{text:"Editors"},stream:this._lovService.userLov$,transformer:{nameKey:"name",valueKey:"_id"},multiple:!0},{name:"currentVersion",type:"text",label:{text:"Version"},maxLength:100},{name:"hasReportAccess",label:{text:"Has Report Access"},type:"toggle"},{name:"hasInvoiceAccess",label:{text:"Has Invoice Access"},type:"toggle"}]},beforeCloseObservable:r=>e?this._menuPanelService.updateRms(o(o({},e),r)):this._menuPanelService.addRms(r),getAfterSuccessResponse:r=>{r.data&&this._menuPanelService._updateRms(r.data,e?"edit":"add")}};this._dialog.openFormPopup(i)}_deleteInventory(e){let i={title:{text:"Confirm Delete"},message:{text:"Are you sure you want to delete this rms?"}};this._dialog.openConfirmPopup(i).afterClosed().pipe(s(1)).subscribe(r=>{r&&e?._id&&this._menuPanelService.deleteRms(e)})}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=p({type:t,selectors:[["ks-solutions-rms-panel-listing"]],standalone:!0,features:[S([d]),g],decls:1,vars:1,consts:[[3,"config","refresh$"]],template:function(i,r){i&1&&f(0,E,1,2,"ks-basic-grid",0),i&2&&x(r.gridConfig?0:-1)},dependencies:[C],changeDetection:0})}}return t})();export{X as RmsPanelComponent};
