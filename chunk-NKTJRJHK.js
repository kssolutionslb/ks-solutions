import{a as De,b as Ue,c as Ae,d as $e}from"./chunk-BXQVTZJV.js";import{a as z}from"./chunk-53TN2W2V.js";import{a as D}from"./chunk-ACYZVNWI.js";import{a as w}from"./chunk-UA3J3SVI.js";import{a as Fe}from"./chunk-GQ637NOE.js";import"./chunk-HMNUYURD.js";import{a as j}from"./chunk-72TK6UK2.js";import{D as ge,E as ve,F as Ce,G as E,H as xe,I as Se,M as be,N as ye,O as P,aa as V,ba as Te,da as Ie,ma as we,ra as F,sa as Me,ta as ke,ua as Ee,v as O,w as B}from"./chunk-XXZS4MWG.js";import"./chunk-CARY4E7O.js";import"./chunk-4KKA7PE6.js";import{Ab as f,Ac as Y,Fa as $,Fc as k,Gc as q,Hc as L,Ib as l,Ka as ae,La as N,Ma as re,N as h,Ob as _,Pb as G,Qc as fe,Rb as W,Sb as H,Tb as s,Ub as r,Vb as v,Y as ee,Zb as de,a as C,ac as R,b as S,cc as m,ea as te,eb as se,ib as a,id as _e,jb as M,ka as c,kd as he,n as Q,nc as p,o as X,oa as b,pb as le,pc as T,qa as ie,qc as K,sc as ce,tb as u,tc as me,uc as pe,vc as ue,wc as y,xc as x,y as Z,ya as ne,yc as I,za as oe,zc as U}from"./chunk-VO6IE2C5.js";var J=(()=>{class t{constructor(){this._lovService=c(z),this._navbarService=c(j),this._networkService=c(Ie),this._menu$=new X(void 0),this._menuId="",this.menu$=this._menu$.asObservable()}updateMenuData(e){this._networkService.patch(w.MENU_SETTINGS.updateFile,{menuId:e}).pipe(h(1)).subscribe()}updateMenuEditors(e){return this._networkService.patch(w.MENU_SETTINGS.menuEditors,S(C({},e),{menuId:e._id}))}updateMenuTemplate(e,i,n){this._networkService.patch(w.MENU_SETTINGS.menuTemplate,{menuId:e,newTemplateId:i,templateConfig:n}).pipe(h(1)).subscribe(d=>{if(d?.data){let g=this._menu$.getValue();g&&(g.templateId=d.data.templateId,n&&(g.templateConfig=n),this._menu$.next(g))}})}addInvoiceSettings(e){this._networkService.post(w.INVOICE.settings,S(C({},e),{menuId:this._menuId})).pipe(h(1)).subscribe(()=>{this.getMenuById(this._menuId)})}updateInvoiceSettings(e){this._networkService.patch(w.INVOICE.settings,e,e._id).pipe(h(1)).subscribe(()=>{this.getMenuById(this._menuId)})}getMenuById(e){this._networkService.post(w.MENU_SETTINGS.byMenuId,{menuId:e}).pipe(h(1)).subscribe({next:i=>{i?i.data&&(this._menu$.next(i.data),this._menuId=e,i.data.isExternal||this._lovService.getMenuTemplatesLov()):this._navbarService.navigateTo(D.LAYOUT.children.HOME.route)},error:()=>{this._navbarService.navigateTo(D.LAYOUT.children.HOME.route)}})}$update(e){this._menu$.next(e)}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=te({token:t,factory:t.\u0275fac})}}return t})();function je(t,o){if(t&1&&(s(0,"div",1),v(1,"iframe",2),r()),t&2){let e=m();a(),l("src",e.data==null||e.data.template==null?null:e.data.template.templateUrl,se)}}var Ne=(()=>{class t{constructor(e,i){this._dialogRef=e,this.data=i,this.cardConfig={header:{title:{text:"Preview",tag:"h3",fontWeight:"700"},position:"center",suffixButton:{label:{text:"Close"},matType:"mat-icon-button",prefixIcon:{icon:"icon_x_circle"},onClick:()=>{this._dialogRef.close()}}},content:{addClass:"card p-2 h-100"},footer:{buttons:[{label:{text:"Close"},matType:"mat-stroked-button",onClick:()=>{this._dialogRef.close()}}],position:"center"}},this.config=u(null),this.handleMessage=n=>{n.data?.type==="TEMPLATE_READY"&&document.getElementById("myIframe")?.contentWindow?.postMessage({cssVars:this.data?.cssVars},window.location.origin)}}ngAfterViewInit(){window.addEventListener("message",this.handleMessage)}ngOnDestroy(){window.removeEventListener("message",this.handleMessage)}static{this.\u0275fac=function(i){return new(i||t)(M(O),M(B))}}static{this.\u0275cmp=b({type:t,selectors:[["ks-solutions-template-preview"]],standalone:!0,features:[y],decls:2,vars:2,consts:[[3,"config"],[2,"height","600px"],["id","myIframe","frameborder","0","width","100%","height","100%",2,"zoom","0.7",3,"src"]],template:function(i,n){i&1&&(s(0,"ks-base-card",0),f(1,je,2,1,"div",1),r()),i&2&&(l("config",n.cardConfig),a(),_(!(n.data==null||n.data.template==null)&&n.data.template.templateUrl?1:-1))},dependencies:[F],changeDetection:0})}}return t})();var ze=t=>({loading:t,disableInteractions:!0,position:"fixed"});function Ge(t,o){if(t&1&&v(0,"ks-dynamic-form",1),t&2){let e=m();l("config",o)("action$",e.action$)}}function We(t,o){if(t&1&&(s(0,"div",2),p(1),r()),t&2){let e,i=m();a(),T("Are you sure you want to use ",(e=i.data==null||i.data.template==null?null:i.data.template.name)!==null&&e!==void 0?e:"this template","?")}}function He(t,o){if(t&1&&v(0,"ks-loader-overlay",0),t&2){let e=m();l("config",I(1,ze,e.trueSignal))}}var Re=(()=>{class t{constructor(e,i){this._dialogRef=e,this.data=i,this._dialog=c(V),this._loaderService=c(Te),this._isTest=!1,this.action$=new Q,this.trueSignal=u(!0),this.loading=this._loaderService.isLoading,this.cardConfig={header:{title:{text:"Menu Template",tag:"h3",fontWeight:"700"},position:"center",suffixButton:{label:{text:"Close"},matType:"mat-icon-button",prefixIcon:{icon:"icon_x_circle"},onClick:()=>{this._dialogRef.close()}}},content:{addClass:"card p-2"},footer:{buttons:[{label:{text:"Clear"},matType:"mat-stroked-button",onClick:()=>{this.action$.next("clear")},hide:u(!this.data?.template?.cssForm?.fields.length)},{label:{text:"Test"},matType:"mat-stroked-button",onClick:()=>{this._test()},hide:u(!this.data?.template?.cssForm?.fields.length)},{label:{text:"Save"},matType:"mat-flat-button",prefixIcon:{icon:"icon_save"},onClick:()=>{this._save()}}],position:"center"}},this.config=u(null)}ngAfterViewInit(){this.data?.template?.cssForm?.fields?.length&&this.config.set(S(C({},this.data.template.cssForm),{value:this.data?.menu?.templateConfig?.[this.data.template.templateId],onSave:e=>{e&&(this._isTest?this._openTestPopup(e):this._saveAndCloseDialog(e))}}))}_save(){this.data?.template?.cssForm?.fields.length?(this._isTest=!1,this.action$.next("save")):this._saveAndCloseDialog({})}_test(){this._isTest=!0,this.action$.next("save")}_openTestPopup(e){this._dialog.open(Ne,{data:{cssVars:e,template:this.data?.template},width:"95vw",maxWidth:"350px",maxHeight:"95vh"})}_saveAndCloseDialog(e){this.data?.menuSettingsService.updateMenuTemplate(this.data.menu._id,this.data.template._id,S(C({},this.data.menu.templateConfig),{[this.data.template.templateId]:e})),this.data?.menuSettingsService.menu$.pipe(ee(1),h(1)).subscribe(()=>{this._dialogRef.close()})}static{this.\u0275fac=function(i){return new(i||t)(M(O),M(B))}}static{this.\u0275cmp=b({type:t,selectors:[["ks-solutions-template-settings"]],standalone:!0,features:[y],decls:4,vars:3,consts:[[3,"config"],[3,"config","action$"],[2,"height","50px"]],template:function(i,n){if(i&1&&(s(0,"ks-base-card",0),f(1,Ge,1,2,"ks-dynamic-form",1)(2,We,2,1,"div",2),r(),f(3,He,1,3,"ks-loader-overlay",0)),i&2){let d;l("config",n.cardConfig),a(),_((d=n.config())?1:2,d),a(2),_(n.loading()?3:-1)}},dependencies:[F,ke,Ee],changeDetection:0})}}return t})();var Le=(()=>{class t{constructor(){this._destroyRef=c($),this._crd=c(fe),this.control=N.required(),this.getValue=ae(),this.editor=new $e,this.htmlContent="",this.toolbar=[["bold","italic","underline"],["align_left","align_center","align_right","align_justify"],["bullet_list","ordered_list"],["horizontal_rule","format_clear","indent","outdent"],["undo","redo"]]}ngOnInit(){this.htmlContent=this.control().value,this.control().valueChanges.pipe(P(this._destroyRef)).subscribe(e=>{this.htmlContent=e||"",this._crd.markForCheck()})}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=b({type:t,selectors:[["kss-lib-invoice-footer-text"]],inputs:{control:[1,"control"]},outputs:{getValue:"getValue"},standalone:!0,features:[y],decls:5,vars:4,consts:[[1,"w-100"],[1,"py-2","ps-2","text-center","h5","underline"],[3,"toolbar","editor"],[3,"ngModelChange","focusOut","editor","ngModel"]],template:function(i,n){i&1&&(s(0,"div",0)(1,"div",1),p(2,"Footer Text"),r(),v(3,"ngx-editor-menu",2),s(4,"ngx-editor",3),pe("ngModelChange",function(g){return me(n.htmlContent,g)||(n.htmlContent=g),g}),R("focusOut",function(){return n.getValue.emit(n.htmlContent)}),r()()),i&2&&(a(3),l("toolbar",n.toolbar)("editor",n.editor),a(),l("editor",n.editor),ce("ngModel",n.htmlContent))},dependencies:[Ae,De,Ue,be,ge,xe],changeDetection:0})}}return t})();var Oe=(()=>{class t{constructor(){this.el=c(re),this.renderer=c(le),this.iframeSrc=N.required()}ngOnInit(){this.iframeSrc()&&(this.observer=new IntersectionObserver(([e])=>{e.isIntersecting&&(this.loadIframe(),this.observer.disconnect())},{threshold:.1}),this.observer.observe(this.el.nativeElement))}loadIframe(){let e=this.el.nativeElement;if(e.tagName.toLowerCase()!=="iframe"){console.warn("appLazyIframe directive should be used on an <iframe> element.");return}this.renderer.setAttribute(e,"src",this.iframeSrc())}ngOnDestroy(){this.observer?.disconnect()}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275dir=ie({type:t,selectors:[["","kssLazyIframe",""]],inputs:{iframeSrc:[1,"iframeSrc"]},standalone:!0})}}return t})();var Ye=()=>({text:"Menu Template",translate:!1,addClass:"h4"}),Pe=t=>({title:t}),qe=()=>({addClass:"card p-3"}),Je=(t,o)=>({header:t,content:o,addClass:"border"}),Qe=()=>({text:"Menu Invoice Settings",translate:!1,addClass:"h4"}),Xe=()=>({text:"Save Settings"}),Ze=()=>({icon:"icon_save"}),et=(t,o,e)=>({label:t,prefixIcon:o,matType:"mat-flat-button",onClick:e}),tt=t=>[t],it=t=>({position:"end",buttons:t}),nt=()=>({addClass:"card p-3 mb-1"}),ot=(t,o,e)=>({header:t,footer:o,content:e,addClass:"border"}),at=()=>({text:"Background Color"}),Be=(t,o)=>({label:t,type:"color",control:o}),rt=()=>({text:"Font Color"}),st=()=>({text:"Show Item Unit In Invoice If Available"}),lt=(t,o)=>({label:t,control:o});function dt(t,o){t&1&&(s(0,"p")(1,"strong"),p(2,"Menu Owner:"),r(),p(3),r()),t&2&&(a(3),T(" ",o," "))}function ct(t,o){if(t&1&&(s(0,"p")(1,"strong"),p(2,"Last Updated By:"),r(),p(3),r(),s(4,"p")(5,"strong"),p(6,"Last Updated At:"),r(),p(7),k(8,"date"),r()),t&2){let e=m(2);a(3),K(" ",e.lastUpdate.name," (",e.lastUpdate.email,") "),a(4),T(" ",L(8,3,e.lastUpdate.createdAt,"medium")," ")}}function mt(t,o){if(t&1&&(s(0,"div")(1,"ks-base-card",1)(2,"div",5),f(3,dt,4,1,"p"),s(4,"p")(5,"strong"),p(6,"Created Date:"),r(),p(7),k(8,"date"),r(),s(9,"p")(10,"strong"),p(11,"Expiry Date:"),r(),p(12),k(13,"date"),r(),f(14,ct,9,6),r()()()),t&2){let e,i=m(),n=m();a(),l("config",o),a(2),_((e=n.owner())?3:-1,e),a(4),T(" ",L(8,5,i.createdAt,"medium")," "),a(5),T(" ",L(13,8,i.expiresAt,"medium")," "),a(2),_(i.lastUpdate?14:-1)}}function pt(t,o){if(t&1&&(s(0,"li",6),p(1),r()),t&2){let e=o.$implicit;a(),K("",e.name," (",e.email,")")}}function ut(t,o){if(t&1&&(s(0,"ul"),W(1,pt,2,2,"li",6,G),r()),t&2){let e=m();a(),H(e)}}function ft(t,o){t&1&&(s(0,"div",4)(1,"p"),p(2,"This menu currently has no editors. Please contact your administrator if you'd like to add one."),r()())}function _t(t,o){t&1&&f(0,ut,3,0,"ul")(1,ft,3,0,"div",4),t&2&&_(o.length?0:1)}function ht(t,o){if(t&1&&(s(0,"ks-base-card",1),f(1,_t,2,1),r()),t&2){let e,i=m(2);l("config",o),a(),_((e=i.editors())?1:-1,e)}}function gt(t,o){if(t&1){let e=de();s(0,"div",2)(1,"ks-base-card",1)(2,"form")(3,"div",7)(4,"div",8)(5,"div",9),v(6,"ks-base-input",1),r(),s(7,"div",9),v(8,"ks-base-input",1),r(),s(9,"div",10),v(10,"ks-base-slide-toggle",1),r()()()(),s(11,"kss-lib-invoice-footer-text",11),R("getValue",function(n){ne(e);let d=m(2);return oe(d.footerText=n)}),r()()()}if(t&2){let e=m(2);a(),l("config",Y(19,ot,I(6,Pe,x(5,Qe)),I(16,it,I(14,tt,Y(10,et,x(8,Xe),x(9,Ze),e.updateMenuInvoice.bind(e)))),x(18,nt))),a(5),l("config",U(24,Be,x(23,at),e.invoiceSettingsForm.controls.backgroundColor)),a(2),l("config",U(28,Be,x(27,rt),e.invoiceSettingsForm.controls.fontColor)),a(2),l("config",U(32,lt,x(31,st),e.invoiceSettingsForm.controls.showUnit)),a(),l("control",e.invoiceSettingsForm.controls.footerText)}}function vt(t,o){if(t&1&&(s(0,"div",12)(1,"ks-base-card",1),v(2,"iframe",13),r()()),t&2){let e=o.$implicit,i=m(2),n=m();a(),l("config",n.getTemplateCardConfig(i,e)),a(),l("iframeSrc",e.templateUrl)}}function Ct(t,o){if(t&1&&(s(0,"div",3),W(1,vt,3,2,"div",12,G),k(3,"async"),r()),t&2){let e=m(2);a(),H(q(3,0,e.templates$))}}function xt(t,o){t&1&&(s(0,"div",4)(1,"p"),p(2,"This menu is external and does not support template changes."),r()())}function St(t,o){if(t&1&&(f(0,mt,15,11,"div"),s(1,"div",0),f(2,ht,2,2,"ks-base-card",1),r(),f(3,gt,12,35,"div",2),s(4,"div")(5,"ks-base-card",1),f(6,Ct,4,2,"div",3)(7,xt,3,0,"div",4),r()()),t&2){let e,i,n=o,d=m();_((e=d.menuCard())?0:-1,e),a(2),_((i=d.editorsCard())?2:-1,i),a(),_(n.hasInvoice?3:-1),a(2),l("config",U(9,Je,I(6,Pe,x(5,Ye)),x(8,qe))),a(),_(n.isExternal?7:6)}}var bi=(()=>{class t{constructor(){this._destroyRef=c($),this._dialog=c(V),this._lovService=c(z),this._menuSettingsService=c(J),this._navService=c(j),this.templates$=this._lovService.menuTemplatesLov$.pipe(Z(e=>e.filter(i=>!i.isCustom).map(i=>S(C({},i),{templateUrl:window.location.origin+"/menus/"+i.templateId})))),this.menu$=this._menuSettingsService.menu$,this.currentScreen=Fe("menu_settings"),this.menuCard=u(void 0),this.editorsCard=u(void 0),this.editors=u([]),this.owner=u(""),this.footerText="",this.invoiceSettingsForm=new Ce({logoUrl:new E(""),backgroundColor:new E("#FFFFFF"),fontColor:new E("#000000"),footerText:new E(""),showUnit:new E(!1)})}ngOnInit(){let e=this._navService.readUrlParams().MenuId;this._navService.updateNav({show:!0,back:!0,title:this.currentScreen.screenName,buttons:[]}),e?this._menuSettingsService.getMenuById(e):this._navService.navigateTo(D.LAYOUT.children.HOME.route),this._menuSettingsService.menu$.pipe(P(this._destroyRef)).subscribe(i=>{if(!i)return;this.invoiceSettingsForm.patchValue(i.invoiceSettings||{}),this.footerText=i.invoiceSettings?.footerText||"",this._lovService.userLov$.pipe(h(1)).subscribe(d=>{this.owner.set(d.find(g=>g._id===i.ownerId)?.name??""),this.editors.set(d.filter(g=>i.editorsId.includes(g._id)))}),this.editorsCard.set({header:{title:{text:"Menu Editors",addClass:"h4"}},content:{addClass:"card p-3"},addClass:"border"});let n={header:{title:{text:i.name,translate:!1,tag:"h4"},position:"center"},footer:{buttons:[{label:{text:"Update Menu Data"},matType:"mat-flat-button",suffixIcon:{icon:"icon_refresh"},onClick:()=>{this._updateMenu(i)},hide:u(!i.isExternal)},{label:{text:"Open Menu"},matType:"mat-flat-button",suffixIcon:{icon:"icon_arrow_right",size:"sm"},onClick:()=>{i.redirect&&i.activateRedirection?window.open(i.redirect,"_blank"):window.open(`${window.location.origin}/${D.MENUS.route}/${i.endpoint}`,"_blank")}}],position:"end"},content:{addClass:"card p-3"},addClass:"border"};this.menuCard.set(n)})}updateMenuInvoice(){this._dialog.openConfirmPopup({title:{text:"Confirm Save"},message:{text:"Are you sure you want to update the invoice settings?"}}).afterClosed().pipe(h(1)).subscribe(e=>{e&&this._menuSettingsService.menu$.pipe(h(1)).subscribe(i=>{let n=this.invoiceSettingsForm.value;n.footerText=this.footerText,i&&(i.invoiceSettings?this._menuSettingsService.updateInvoiceSettings(C(C({},i.invoiceSettings),n)):this._menuSettingsService.addInvoiceSettings(n))})})}getTemplateCardConfig(e,i){return{header:{title:{text:i.name,translate:!1,addClass:"h4"},position:"center"},footer:{buttons:[{label:{text:"Use"},matType:"mat-stroked-button",onClick:()=>{this._changeMenuTemplate(e,i)},hide:u(e.templateId===i.templateId)},{label:{text:"Customize"},matType:"mat-stroked-button",onClick:()=>{this._changeMenuTemplate(e,i)},hide:u(e.templateId!==i.templateId||!i.cssForm?.fields?.length)}],position:"center"},content:{addClass:"rounded overflow-hidden"},addClass:`h-100 w-100 ${e.templateId===i.templateId?"border border-primary border-3 ":""}`}}_changeMenuTemplate(e,i){this._dialog.open(Re,{data:{menu:e,template:i,menuSettingsService:this._menuSettingsService},maxWidth:i?.cssForm?.fields.length?"900px":"500px",width:"95vw",disableClose:!0})}_updateMenu(e){let i={title:{text:"Confirm Update"},message:{text:"Are you sure you want to update this menu? Please note that it may take up to 5 minutes for the changes to take effect."}};this._dialog.openConfirmPopup(i).afterClosed().pipe(h(1)).subscribe(n=>{n&&e._id&&this._menuSettingsService.updateMenuData(e._id)})}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=b({type:t,selectors:[["ks-solutions-menu-settings"]],standalone:!0,features:[ue([J]),y],decls:2,vars:3,consts:[[1,"my-3"],[3,"config"],[1,"mb-3"],[1,"d-flex","overflow-x-auto","gap-3","h-100","pb-3"],[1,"external-menu-info"],[1,"dates-section"],[1,"text-break"],[1,"container-fluid"],[1,"row"],[1,"col-12","col-sm-12","col-md-6","col-lg-4"],[1,"col-12","col-sm-12","col-md-6","col-lg-4","pt-4",2,"min-height","75px"],[3,"getValue","control"],[2,"min-width","300px","max-width","300px","min-height","500px","max-height","500px"],["kssLazyIframe","","frameborder","0","width","100%","height","100%",2,"zoom","0.7",3,"iframeSrc"]],template:function(i,n){if(i&1&&(f(0,St,8,12),k(1,"async")),i&2){let d;_((d=q(1,1,n.menu$))?0:-1,d)}},dependencies:[F,_e,he,we,ye,Se,ve,Me,Le,Oe],styles:[".external-menu-info[_ngcontent-%COMP%]{font-size:16px;color:#6c757d}"],changeDetection:0})}}return t})();export{bi as MenuSettingsComponent};
