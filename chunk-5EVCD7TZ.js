import{a as Ce,b as Se,c as xe,d as be}from"./chunk-HVYYIV3C.js";import{a as B}from"./chunk-MJ7DCTJM.js";import{a as M}from"./chunk-ACYZVNWI.js";import{a as ve}from"./chunk-2OEIZLNB.js";import"./chunk-HMNUYURD.js";import{a as I}from"./chunk-NZP3AJU7.js";import{a as $}from"./chunk-5LHP7IWU.js";import{D as ae,E as se,F as ce,G as y,H as le,I as de,M as pe,N as me,O as D,aa as ue,da as _e,ma as fe,ra as ge,sa as he}from"./chunk-7Y4QU53B.js";import"./chunk-CARY4E7O.js";import"./chunk-QLWHFAAO.js";import{$b as w,Ec as b,Fa as E,Fc as G,Gc as N,Hb as p,Ka as J,La as Q,N as m,Nb as _,Ob as R,Pc as ne,Qb as V,Rb as A,Sb as s,Tb as r,Ub as S,Yb as X,a as g,b as O,bc as f,ea as W,hb as a,hd as oe,jd as re,ka as d,mc as c,o as H,oa as F,oc as T,pc as L,rc as Z,sb as x,sc as ee,tc as te,uc as ie,vc as k,wc as h,xc as v,y as P,ya as Y,yc as U,za as q,zb as u,zc as j}from"./chunk-72DPVO72.js";var K=(()=>{class e{constructor(){this._lovService=d(B),this._navbarService=d($),this._networkService=d(_e),this._menu$=new H(void 0),this._menuId="",this.menu$=this._menu$.asObservable()}updateMenuData(t){this._networkService.patch(I.MENU_SETTINGS.updateFile,{menuId:t}).pipe(m(1)).subscribe()}updateMenuEditors(t){return this._networkService.patch(I.MENU_SETTINGS.menuEditors,O(g({},t),{menuId:t._id}))}addInvoiceSettings(t){this._networkService.post(I.INVOICE.settings,O(g({},t),{menuId:this._menuId})).pipe(m(1)).subscribe(()=>{this.getMenuById(this._menuId)})}updateInvoiceSettings(t){this._networkService.patch(I.INVOICE.settings,t,t._id).pipe(m(1)).subscribe(()=>{this.getMenuById(this._menuId)})}getMenuById(t){this._networkService.post(I.MENU_SETTINGS.byMenuId,{menuId:t}).pipe(m(1)).subscribe({next:i=>{i?i.data&&(this._menu$.next(i.data),this._menuId=t,i.data.isExternal||this._lovService.getMenuTemplatesLov()):this._navbarService.navigateTo(M.LAYOUT.children.HOME.route)},error:()=>{this._navbarService.navigateTo(M.LAYOUT.children.HOME.route)}})}$update(t){this._menu$.next(t)}static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275prov=W({token:e,factory:e.\u0275fac})}}return e})();var Me=(()=>{class e{constructor(){this._destroyRef=d(E),this._crd=d(ne),this.control=Q.required(),this.getValue=J(),this.editor=new be,this.htmlContent="",this.toolbar=[["bold","italic","underline"],["align_left","align_center","align_right","align_justify"],["bullet_list","ordered_list"],["horizontal_rule","format_clear","indent","outdent"],["undo","redo"]]}ngOnInit(){this.htmlContent=this.control().value,this.control().valueChanges.pipe(D(this._destroyRef)).subscribe(t=>{this.htmlContent=t||"",this._crd.markForCheck()})}static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275cmp=F({type:e,selectors:[["kss-lib-invoice-footer-text"]],inputs:{control:[1,"control"]},outputs:{getValue:"getValue"},standalone:!0,features:[k],decls:5,vars:4,consts:[[1,"w-100"],[1,"py-2","ps-2","text-center","h5","underline"],[3,"toolbar","editor"],[3,"ngModelChange","focusOut","editor","ngModel"]],template:function(i,n){i&1&&(s(0,"div",0)(1,"div",1),c(2,"Footer Text"),r(),S(3,"ngx-editor-menu",2),s(4,"ngx-editor",3),te("ngModelChange",function(C){return ee(n.htmlContent,C)||(n.htmlContent=C),C}),w("focusOut",function(){return n.getValue.emit(n.htmlContent)}),r()()),i&2&&(a(3),p("toolbar",n.toolbar)("editor",n.editor),a(),p("editor",n.editor),Z("ngModel",n.htmlContent))},dependencies:[xe,Ce,Se,pe,ae,le],changeDetection:0})}}return e})();var Ee=()=>({text:"Menu Template",translate:!1,addClass:"h4"}),z=e=>({title:e}),Te=e=>({header:e}),we=()=>({text:"Menu Invoice Settings",translate:!1,addClass:"h4"}),ke=()=>({text:"Save Settings"}),Ue=()=>({icon:"icon_save"}),Ne=(e,o,t)=>({label:e,prefixIcon:o,matType:"mat-flat-button",onClick:t}),De=e=>[e],$e=e=>({position:"end",buttons:e}),Be=()=>({addClass:"mb-1"}),Oe=(e,o,t)=>({header:e,footer:o,content:t}),Pe=()=>({text:"Background Color"}),Ie=(e,o)=>({label:e,type:"color",control:o}),Re=()=>({text:"Font Color"}),Ve=()=>({text:"Show Item Unit In Invoice If Available"}),Ae=(e,o)=>({label:e,control:o}),Le=e=>({text:e,translate:!1});function je(e,o){e&1&&(s(0,"p")(1,"strong"),c(2,"Menu Owner:"),r(),c(3),r()),e&2&&(a(3),T(" ",o," "))}function Ge(e,o){if(e&1&&(s(0,"p")(1,"strong"),c(2,"Last Updated By:"),r(),c(3),r(),s(4,"p")(5,"strong"),c(6,"Last Updated At:"),r(),c(7),b(8,"date"),r()),e&2){let t=f(2);a(3),L(" ",t.lastUpdate.name," (",t.lastUpdate.email,") "),a(4),T(" ",N(8,3,t.lastUpdate.createdAt,"medium")," ")}}function Ke(e,o){if(e&1&&(s(0,"ks-base-card",0)(1,"div",4),u(2,je,4,1,"p"),s(3,"p")(4,"strong"),c(5,"Created Date:"),r(),c(6),b(7,"date"),r(),s(8,"p")(9,"strong"),c(10,"Expiry Date:"),r(),c(11),b(12,"date"),r(),u(13,Ge,9,6),r()()),e&2){let t,i=f(),n=f();p("config",o),a(2),_((t=n.owner())?2:-1,t),a(4),T(" ",N(7,5,i.createdAt,"medium")," "),a(5),T(" ",N(12,8,i.expiresAt,"medium")," "),a(2),_(i.lastUpdate?13:-1)}}function ze(e,o){if(e&1&&(s(0,"li",5),c(1),r()),e&2){let t=o.$implicit;a(),L("",t.name," (",t.email,")")}}function He(e,o){if(e&1&&(s(0,"ul"),V(1,ze,2,2,"li",5,R),r()),e&2){let t=f();a(),A(t)}}function We(e,o){e&1&&(s(0,"div",3)(1,"p"),c(2,"This menu currently has no editors. Please contact your administrator if you'd like to add one."),r()())}function Ye(e,o){e&1&&u(0,He,3,0,"ul")(1,We,3,0,"div",3),e&2&&_(o.length?0:1)}function qe(e,o){if(e&1&&(s(0,"ks-base-card",0),u(1,Ye,2,1),r()),e&2){let t,i=f(2);p("config",o),a(),_((t=i.editors())?1:-1,t)}}function Je(e,o){if(e&1){let t=X();s(0,"div",2)(1,"ks-base-card",0)(2,"form")(3,"div",6)(4,"div",7)(5,"div",8),S(6,"ks-base-input",0),r(),s(7,"div",8),S(8,"ks-base-input",0),r(),s(9,"div",9),S(10,"ks-base-slide-toggle",0),r()()()(),s(11,"kss-lib-invoice-footer-text",10),w("getValue",function(n){Y(t);let l=f(2);return q(l.footerText=n)}),r()()()}if(e&2){let t=f(2);a(),p("config",j(19,Oe,v(6,z,h(5,we)),v(16,$e,v(14,De,j(10,Ne,h(8,ke),h(9,Ue),t.updateMenuInvoice.bind(t)))),h(18,Be))),a(5),p("config",U(24,Ie,h(23,Pe),t.invoiceSettingsForm.controls.backgroundColor)),a(2),p("config",U(28,Ie,h(27,Re),t.invoiceSettingsForm.controls.fontColor)),a(2),p("config",U(32,Ae,h(31,Ve),t.invoiceSettingsForm.controls.showUnit)),a(),p("control",t.invoiceSettingsForm.controls.footerText)}}function Qe(e,o){if(e&1&&S(0,"ks-base-card",0),e&2){let t=o.$implicit;p("config",v(5,Te,v(3,z,v(1,Le,t.name))))}}function Xe(e,o){if(e&1&&(V(0,Qe,1,7,"ks-base-card",0,R),b(2,"async")),e&2){let t=f(2);A(G(2,0,t.templates$))}}function Ze(e,o){e&1&&(s(0,"div",3)(1,"p"),c(2,"This menu is external and does not support template changes."),r()())}function et(e,o){if(e&1&&(u(0,Ke,14,11,"ks-base-card",0),s(1,"div",1),u(2,qe,2,2,"ks-base-card",0),r(),u(3,Je,12,35,"div",2),s(4,"ks-base-card",0),u(5,Xe,3,2)(6,Ze,3,0,"div",3),r()),e&2){let t,i,n=o,l=f();_((t=l.menuCard())?0:-1,t),a(2),_((i=l.editorsCard())?2:-1,i),a(),_(n.hasInvoice?3:-1),a(),p("config",v(8,Te,v(6,z,h(5,Ee)))),a(),_(n.isExternal?6:5)}}var Dt=(()=>{class e{constructor(){this._destroyRef=d(E),this._dialog=d(ue),this._lovService=d(B),this._menuSettingsService=d(K),this._navService=d($),this.templates$=this._lovService.menuTemplatesLov$.pipe(P(t=>t.filter(i=>!i.isCustom))),this.menu$=this._menuSettingsService.menu$,this.currentScreen=ve("menu_settings"),this.menuCard=x(void 0),this.editorsCard=x(void 0),this.editors=x([]),this.owner=x(""),this.footerText="",this.invoiceSettingsForm=new ce({logoUrl:new y(""),backgroundColor:new y("#FFFFFF"),fontColor:new y("#000000"),footerText:new y(""),showUnit:new y(!1)})}ngOnInit(){let t=this._navService.readUrlParams().MenuId;this._navService.updateNav({show:!0,back:!0,title:this.currentScreen.screenName,buttons:[]}),t?this._menuSettingsService.getMenuById(t):this._navService.navigateTo(M.LAYOUT.children.HOME.route),this._menuSettingsService.menu$.pipe(D(this._destroyRef)).subscribe(i=>{if(!i)return;this.invoiceSettingsForm.patchValue(i.invoiceSettings||{}),this.footerText=i.invoiceSettings?.footerText||"",this._lovService.userLov$.pipe(m(1)).subscribe(l=>{this.owner.set(l.find(C=>C._id===i.ownerId)?.name??""),this.editors.set(l.filter(C=>i.editorsId.includes(C._id)))}),this.editorsCard.set({header:{title:{text:"Menu Editors",addClass:"h4"}}});let n={header:{title:{text:i.name,translate:!1,tag:"h4"},position:"center"},footer:{buttons:[{label:{text:"Update Menu Data"},matType:"mat-flat-button",suffixIcon:{icon:"icon_refresh"},onClick:()=>{this._updateMenu(i)},hide:x(!i.isExternal)},{label:{text:"Open Menu"},matType:"mat-flat-button",suffixIcon:{icon:"icon_arrow_right",size:"sm"},onClick:()=>{i.redirect&&i.activateRedirection?window.open(i.redirect,"_blank"):window.open(`${window.location.origin}/${M.MENUS.route}/${i.endpoint}`,"_blank")}}],position:"end"}};this.menuCard.set(n)})}updateMenuInvoice(){this._dialog.openConfirmPopup({title:{text:"Confirm Save"},message:{text:"Are you sure you want to update the invoice settings?"}}).afterClosed().pipe(m(1)).subscribe(t=>{t&&this._menuSettingsService.menu$.pipe(m(1)).subscribe(i=>{let n=this.invoiceSettingsForm.value;n.footerText=this.footerText,i&&(i.invoiceSettings?this._menuSettingsService.updateInvoiceSettings(g(g({},i.invoiceSettings),n)):this._menuSettingsService.addInvoiceSettings(n))})})}_openUpdateEditorsDialog(t){let i={title:{text:"Editors"},form:{value:g({},t||{}),fields:[{name:"editorsId",type:"select",label:{text:"Editors"},stream:this._lovService.userLov$.pipe(P(n=>n.filter(l=>l._id!==t?.ownerId))),transformer:{nameKey:"name",valueKey:"_id"},multiple:!0}]},beforeCloseObservable:n=>this._menuSettingsService.updateMenuEditors(g(g({},t),n)),getAfterSuccessResponse:n=>{n.data&&this._menuSettingsService.$update(n.data)}};this._dialog.openFormPopup(i,"500px")}_updateMenu(t){let i={title:{text:"Confirm Update"},message:{text:"Are you sure you want to update this menu? Please note that it may take up to 5 minutes for the changes to take effect."}};this._dialog.openConfirmPopup(i).afterClosed().pipe(m(1)).subscribe(n=>{n&&t._id&&this._menuSettingsService.updateMenuData(t._id)})}static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275cmp=F({type:e,selectors:[["ks-solutions-menu-settings"]],standalone:!0,features:[ie([K]),k],decls:2,vars:3,consts:[[3,"config"],[1,"my-3"],[1,"mb-3"],[1,"external-menu-info"],[1,"dates-section"],[1,"text-break"],[1,"container-fluid"],[1,"row"],[1,"col-12","col-sm-12","col-md-6","col-lg-4"],[1,"col-12","col-sm-12","col-md-6","col-lg-4","pt-4",2,"min-height","75px"],[3,"getValue","control"]],template:function(i,n){if(i&1&&(u(0,et,7,10),b(1,"async")),i&2){let l;_((l=G(1,1,n.menu$))?0:-1,l)}},dependencies:[ge,oe,re,fe,me,de,se,he,Me],styles:[".external-menu-info[_ngcontent-%COMP%]{font-size:16px;color:#6c757d}"],changeDetection:0})}}return e})();export{Dt as MenuSettingsComponent};
