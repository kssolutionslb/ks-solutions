import{a as E}from"./chunk-JHOHYJWD.js";import{a as w}from"./chunk-7YJWRT5B.js";import{a as L}from"./chunk-5IM6IVN6.js";import"./chunk-HMNUYURD.js";import{a as se}from"./chunk-NYBZM275.js";import{O as ae,aa as j,da as re,ra as U,v as ne,va as le,w as oe}from"./chunk-VY5GT2Q6.js";import"./chunk-CARY4E7O.js";import"./chunk-4KKA7PE6.js";import{Ab as v,Fa as z,Fc as h,Gc as y,Hc as G,Ib as S,N as x,Ob as d,Pb as k,Rb as N,Sb as A,Tb as l,Ub as o,Vb as V,a as u,b as Y,cc as c,dd as Z,ea as K,ib as n,id as ee,jb as W,ka as f,kd as te,md as ie,n as H,nc as a,o as I,oa as B,oc as R,pc as m,qc as J,tb as T,vc as Q,wc as M,xc as X,y as F,yc as q}from"./chunk-VO6IE2C5.js";var O=(()=>{class t{constructor(){this._networkService=f(re),this._cars$=new I([]),this.cars$=this._cars$.asObservable().pipe(F(e=>e.map(i=>Y(u({},i),{_diff:this._getDurationBetweenDates(i.boughtDate,i.sellDate),_notes:i.notes?.split(`
`).map(r=>r.trim()).filter(Boolean)}))))}getCars(){this._networkService.get(w.CARS.cars).pipe(x(1)).subscribe(e=>{e.data&&this._cars$.next(e.data)})}addCar(e){return this._networkService.post(w.CARS.cars,e)}updateCar(e){return this._networkService.patch(w.CARS.cars,e,e._id)}deleteCar(e){this._networkService.delete(w.CARS.cars,e,e._id).pipe(x(1)).subscribe(i=>{i&&this.$updateCars(e,"delete")})}$updateCars(e,i){E.UpdateArrayBehaviorSubject(this._cars$,e,i,"_id")}_getDurationBetweenDates(e,i){if(!e)return"Unknown";let r=new Date(e),p=i?new Date(i):new Date;p<r&&([r,p]=[p,r]);let _=p.getFullYear()-r.getFullYear(),C=p.getMonth()-r.getMonth(),g=p.getDate()-r.getDate(),P=_,b=C,D=g;if(D<0){b-=1;let pe=new Date(p.getFullYear(),p.getMonth(),0);D+=pe.getDate()}b<0&&(P-=1,b+=12);let $=[];return P>0&&$.push(`${P} year${P>1?"s":""}`),b>0&&$.push(`${b} month${b>1?"s":""}`),(D>0||$.length===0)&&$.push(`${D} day${D>1?"s":""}`),$.join(" ")}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=K({token:t,factory:t.\u0275fac})}}return t})();function me(t,s){if(t&1&&V(0,"ks-basic-grid",1),t&2){let e=c();S("config",e.gridConfig)("refresh$",e.refresh$)}}var ce=(()=>{class t{constructor(e,i){this._dialogRef=e,this.data=i,this._destroyRef=f(z),this._dialog=f(j),this._currentScreen=L("cars_listing"),this._expense$=new I([]),this.refresh$=new H,this.cardConfig={header:{title:{text:"Car Expenses",tag:"h3",fontWeight:"700"},position:"center",suffixButton:{label:{text:"Close"},matType:"mat-icon-button",prefixIcon:{icon:"icon_x_circle"},onClick:()=>{this._dialogRef.close()}}},content:{addClass:"card p-2"},footer:{buttons:[this._currentScreen.update?{label:{text:"Save"},matType:"mat-flat-button",prefixIcon:{icon:"icon_save"},onClick:()=>{this._save()}}:{label:{text:"Close"},onClick:()=>{this._dialogRef.close()},matType:"mat-flat-button"}],position:"center"}}}ngOnInit(){let e=this.data?.expenses||[];this._initializeGrid(e),this._expense$.next(e),this._expense$.pipe(ae(this._destroyRef)).subscribe(i=>{this.refresh$.next({data:i})})}_initializeGrid(e){this.gridConfig={data:T(e),defaultPagination:100,maxTableHeight:"calc(100dvh - 400px)",noDataMessage:{text:"This car has no expenses"},features:{showAddButton:this._currentScreen.update,addButtonClicked:()=>{this._openExpensePopup()}},columns:[{field:"name",title:"Expense",type:"string",extraStyles:{"min-width":"150px"}},{field:"amount",title:"Amount",type:"number",extraStyles:{"min-width":"100px"}},{field:"isPayed",title:"Payed",type:"chip",extraStyles:{width:"120px"},position:"p-start",truthy:{false:"No",true:"Yes"},setChipClass:i=>i.isPayed===!0?"rounded rounded-5 px-3 py-1 text-bg-success cs-w-120":"rounded rounded-5 px-3 py-1 text-bg-danger cs-w-120"},{field:"date",title:"Date",type:"date",dateFormat:"dd/MM/yyyy",extraStyles:{"min-width":"100px"}},{field:"notes",title:"Notes",type:"string",extraStyles:{"min-width":"150px"}}],actionsColumn:{maxButtons:window.innerWidth<700?1:void 0,maxWidth:window.innerWidth<700?void 0:"110px",minWidth:window.innerWidth<700?void 0:"110px",enabled:this._currentScreen.update||this._currentScreen.delete,buttons:[{prefixIcon:{icon:"icon_edit"},label:{text:"Edit"},onClickFn:i=>this._openExpensePopup(i),isVisibleFn:()=>this._currentScreen.update,matType:"mat-icon-button"},{prefixIcon:{icon:"icon_delete",color:"red"},label:{text:"Delete"},onClickFn:i=>this._deleteExpense(i),isVisibleFn:()=>this._currentScreen.delete,matType:"mat-icon-button"}]}}}_openExpensePopup(e){let i={hideClearButton:!0,title:{text:e?"Edit Expense":"Add Expense"},form:{value:e,fields:[{name:"name",type:"text",label:{text:"Expense"},required:!0,maxLength:70,minLength:4},{name:"amount",label:{text:"Amount"},type:"number",required:!0},{name:"date",label:{text:"Date"},type:"date",required:!0},{name:"notes",label:{text:"Notes"},type:"textaria",maxLength:70},{name:"isPayed",label:{text:"Payed"},type:"toggle"}]}};this._dialog.openFormPopup(i,"500px").afterClosed().pipe(x(1)).subscribe(r=>{r&&(e?E.UpdateArrayBehaviorSubject(this._expense$,u(u({},e),r),"edit","id"):(r.id=new Date().getTime(),E.UpdateArrayBehaviorSubject(this._expense$,r,"add","id")))})}_deleteExpense(e){this._dialog.openConfirmPopup({title:{text:"Confirm Delete"},message:{text:"Are you sure you want to delete this Expense?"}}).afterClosed().pipe(x(1)).subscribe(i=>{i&&E.UpdateArrayBehaviorSubject(this._expense$,e,"delete","id")})}_save(){this._dialogRef.close(this._expense$.getValue())}static{this.\u0275fac=function(i){return new(i||t)(W(ne),W(oe))}}static{this.\u0275cmp=B({type:t,selectors:[["ks-solutions-expenses-listing"]],standalone:!0,features:[M],decls:2,vars:2,consts:[[3,"config"],[3,"config","refresh$"]],template:function(i,r){i&1&&(l(0,"ks-base-card",0),v(1,me,1,2,"ks-basic-grid",1),o()),i&2&&(S("config",r.cardConfig),n(),d(r.gridConfig?1:-1))},dependencies:[le,U],changeDetection:0})}}return t})();var _e=()=>({text:"Summary",tag:"h4",translate:!1}),Ce=t=>({title:t,position:"center"}),ue=t=>({header:t});function xe(t,s){if(t&1&&(l(0,"div",1)(1,"div",2)(2,"div",3)(3,"ks-base-card",4)(4,"div",5)(5,"div",6)(6,"div",7)(7,"strong"),a(8,"Total Profit/Loss:"),o(),l(9,"span",8),a(10),o()(),l(11,"div",7)(12,"strong"),a(13,"Total Raymond:"),o(),l(14,"span",8),a(15),o()(),l(16,"div",7)(17,"strong"),a(18,"Total Sold Cars:"),o(),l(19,"span",8),a(20),o()(),l(21,"div",7)(22,"strong"),a(23,"Total Unsold Cars:"),o(),l(24,"span",8),a(25),o()()()()()()()()),t&2){let e=s;n(3),S("config",q(8,ue,q(6,Ce,X(5,_e)))),n(7),m("$",e.totalProfit,""),n(5),m("$",e.totalRaymond,""),n(5),R(e.totalSoldCars),n(5),R(e.totalUnsoldCars)}}function fe(t,s){if(t&1&&(l(0,"div",2)(1,"strong"),a(2,"Status:"),o(),l(3,"span",14),a(4),o()()),t&2){let e=c().$implicit;n(3),S("ngClass",e.isSold?"bg-success":"bg-warning"),n(),m(" ",e.isSold?"Sold":"Pending"," ")}}function he(t,s){if(t&1&&(l(0,"div",2)(1,"strong"),a(2,"Duration:"),o(),a(3),o()),t&2){let e=c().$implicit;n(3),m(" ",e._diff," ")}}function ve(t,s){if(t&1&&(l(0,"div",13)(1,"strong"),a(2,"Profit/Loss:"),o(),a(3),h(4,"currency"),o()),t&2){let e=c().$implicit;n(3),m(" ",y(4,1,e.pl)," ")}}function ge(t,s){if(t&1&&(l(0,"div",13)(1,"strong"),a(2,"Total Cost:"),o(),a(3),h(4,"currency"),o()),t&2){let e=c().$implicit;n(3),m(" ",y(4,1,e.totalCost)," ")}}function Se(t,s){if(t&1&&(l(0,"div",13)(1,"strong"),a(2,"Bought At:"),o(),a(3),h(4,"date"),o()),t&2){let e=c().$implicit;n(3),m(" ",G(4,1,e.boughtDate,"dd MMM yyyy")," ")}}function ye(t,s){if(t&1&&(l(0,"div",13)(1,"strong"),a(2,"Sold At:"),o(),a(3),h(4,"date"),o()),t&2){let e=c().$implicit;n(3),m(" ",G(4,1,e.sellDate,"dd MMM yyyy")," ")}}function be(t,s){if(t&1&&(l(0,"div",13)(1,"strong"),a(2,"Bought Price:"),o(),a(3),h(4,"currency"),o()),t&2){let e=c().$implicit;n(3),m(" ",y(4,1,e.boughtPrice)," ")}}function Ee(t,s){if(t&1&&(l(0,"div",13)(1,"strong"),a(2,"Sold Price:"),o(),a(3),h(4,"currency"),o()),t&2){let e=c().$implicit;n(3),m(" ",y(4,1,e.sellPrice)," ")}}function De(t,s){if(t&1&&(l(0,"div",13)(1,"strong"),a(2,"Deal Type:"),o(),a(3),o()),t&2){let e=c().$implicit;n(3),m(" ",e.dealType," ")}}function $e(t,s){if(t&1&&(l(0,"div",13)(1,"strong"),a(2,"Seller Name:"),o(),a(3),o()),t&2){let e=c().$implicit;n(3),m(" ",e.sellerName," ")}}function Te(t,s){if(t&1&&(l(0,"div",13)(1,"strong"),a(2,"Seller Contact:"),o(),a(3),o()),t&2){let e=c().$implicit;n(3),m(" ",e.sellerContact," ")}}function we(t,s){if(t&1&&(l(0,"div",13)(1,"strong"),a(2,"Buyer Name:"),o(),a(3),o()),t&2){let e=c().$implicit;n(3),m(" ",e.buyerName," ")}}function Pe(t,s){if(t&1&&(l(0,"div",13)(1,"strong"),a(2,"Buyer Contact:"),o(),a(3),o()),t&2){let e=c().$implicit;n(3),m(" ",e.buyerContact," ")}}function Ie(t,s){if(t&1&&(l(0,"li"),a(1),o()),t&2){let e=s.$implicit;n(),m(" ",e," ")}}function Fe(t,s){if(t&1&&(l(0,"div",2)(1,"strong"),a(2,"Notes:"),o(),l(3,"ul"),N(4,Ie,2,1,"li",null,k),o()()),t&2){let e=c().$implicit;n(4),A(e._notes)}}function Be(t,s){t&1&&(l(0,"b",15),a(1),o()),t&2&&(n(),R("Unpaid"))}function ke(t,s){if(t&1&&(l(0,"li"),a(1),v(2,Be,2,1,"b",15),o()),t&2){let e=s.$implicit;n(),J(" ",e.name," (",e.amount,") "),n(),d(e.isPayed?-1:2)}}function Ne(t,s){if(t&1&&(l(0,"div",2)(1,"strong"),a(2,"Expenses:"),o(),l(3,"ul"),N(4,ke,3,3,"li",null,k),o()()),t&2){let e=c().$implicit;n(4),A(e.expenses)}}function Ae(t,s){if(t&1&&(l(0,"div",10)(1,"div",11)(2,"ks-base-card",4)(3,"div",12)(4,"div",6),v(5,fe,5,2,"div",2)(6,he,4,1,"div",2)(7,ve,5,3,"div",13)(8,ge,5,3,"div",13)(9,Se,5,4,"div",13)(10,ye,5,4,"div",13)(11,be,5,3,"div",13)(12,Ee,5,3,"div",13)(13,De,4,1,"div",13)(14,$e,4,1,"div",13)(15,Te,4,1,"div",13)(16,we,4,1,"div",13)(17,Pe,4,1,"div",13)(18,Fe,6,0,"div",2)(19,Ne,6,0,"div",2),o()()()()()),t&2){let e=s.$implicit,i=c(3);n(2),S("config",i.getCardConfig(e)),n(3),d(e.isSold!==null?5:-1),n(),d(e._diff?6:-1),n(),d(e.pl!==void 0&&e.pl!==null&&e.isSold?7:-1),n(),d(e.totalCost!==void 0&&e.totalCost!==null?8:-1),n(),d(e.boughtDate?9:-1),n(),d(e.sellDate&&e.isSold?10:-1),n(),d(e.boughtPrice!==void 0&&e.boughtPrice!==null?11:-1),n(),d(e.sellPrice!==void 0&&e.sellPrice!==null&&e.isSold?12:-1),n(),d(e.dealType?13:-1),n(),d(e.sellerName?14:-1),n(),d(e.sellerContact?15:-1),n(),d(e.buyerName&&e.isSold?16:-1),n(),d(e.buyerContact&&e.isSold?17:-1),n(),d(e._notes!=null&&e._notes.length?18:-1),n(),d(e.expenses!=null&&e.expenses.length?19:-1)}}function Re(t,s){if(t&1&&(l(0,"div",9),N(1,Ae,20,16,"div",10,k),o()),t&2){let e=c();n(),A(e)}}function Me(t,s){t&1&&v(0,Re,3,0,"div",9),t&2&&d(s.length?0:-1)}var ut=(()=>{class t{constructor(){this._dialog=f(j),this._carsService=f(O),this._navService=f(se),this._currentScreen=L("cars_listing"),this._cannotUpdate=T(!this._currentScreen.update),this._cannotDelete=T(!this._currentScreen.delete),this.cars$=this._carsService.cars$,this.stats$=this.cars$.pipe(F(e=>{let i=0,r=0,p=0,_=0;for(let C of e)if(C.isSold?(p+=1,i+=C.pl||0):_+=1,Array.isArray(C.expenses))for(let g of C.expenses)g?.name?.toLowerCase?.()==="raymond"&&g.isPayed&&(r+=g.amount||0);return{totalProfit:i,totalRaymond:r,totalSoldCars:p,totalUnsoldCars:_}}))}ngOnInit(){this._carsService.getCars(),this._navService.updateNav({show:!0,back:!1,title:this._currentScreen.screenName,buttons:[{label:{text:"Create New"},prefixIcon:{icon:"icon_plus_circle"},hide:!this._currentScreen.insert,onClick:()=>{this._openCarDialog()}}]})}getCardConfig(e){return{header:{title:{text:e.carName,tag:"h4",translate:!1,addClass:"pt-3"}},footer:{buttons:[{label:{text:"Expenses"},prefixIcon:{icon:"icon_money"},onClick:()=>{this._openExpenseDialog(e)}},{label:{text:"Edit"},prefixIcon:{icon:"icon_edit"},onClick:()=>{this._openCarDialog(e)},hide:this._cannotUpdate},{label:{text:"Delete"},prefixIcon:{icon:"icon_delete"},color:"warn",onClick:()=>{this._deleteCar(e)},hide:this._cannotDelete}],position:"end"},addClass:"h-100"}}_openExpenseDialog(e){this._dialog.open(ce,{data:e,width:"95vw",maxWidth:"900px"}).afterClosed().pipe(x(1)).subscribe(i=>{if(i){let r=i.reduce((_,C)=>_+C.amount,0),p=(e.sellPrice||0)-((e.boughtPrice||0)+r);e.expenses=i,e.totalCost=r+(e.boughtPrice||0),e.pl=p,this._carsService.updateCar(u({},e)).pipe(x(1)).subscribe(_=>{_.data&&this._carsService.$updateCars(_.data,"edit")})}})}_openCarDialog(e){let i={hideClearButton:!0,title:{text:e?"Edit Car":"Add Car"},form:{value:u({isSold:!1,boughtDate:new Date},e||{}),fields:[{name:"carName",label:{text:"Car Name"},type:"text",required:!0},{name:"boughtPrice",label:{text:"Bought Price"},type:"number",required:!0},{name:"boughtDate",label:{text:"Bought Date"},type:"date",required:!0},{name:"sellPrice",label:{text:"Sold Price"},type:"number"},{name:"sellDate",label:{text:"Sold Date"},type:"date"},{name:"buyerName",label:{text:"Buyer Name"},type:"text"},{name:"buyerContact",label:{text:"Buyer Contact"},type:"textaria"},{name:"sellerName",label:{text:"Seller Name"},type:"text"},{name:"sellerContact",label:{text:"Seller Contact"},type:"textaria"},{name:"notes",label:{text:"Notes"},type:"textaria"},{name:"dealType",label:{text:"Deal Type"},type:"autocomplete",flexibleValue:!0,options:[{name:"Cash",value:"Cash"},{name:"Dekishe",value:"Dekishe"}]},{name:"isSold",label:{text:"Is Sold"},type:"checkbox"}]},beforeCloseObservable:r=>{if(e){let p=e.expenses?.reduce((C,g)=>C+g.amount,0)||0,_=(r.sellPrice||0)-((r.boughtPrice||0)+p);return e.totalCost=p+(r.boughtPrice||0),e.pl=_,this._carsService.updateCar(u(u({},e),r))}else return this._carsService.addCar(r)},getAfterSuccessResponse:r=>{!e||e.isSold!==r.data?.isSold?this._carsService.getCars():r.data&&this._carsService.$updateCars(r.data,e?"edit":"add")}};this._dialog.openFormPopup(i,"900px")}_deleteCar(e){let i={title:{text:"Confirm Delete"},message:{text:"Are you sure you want to delete this car?"}};this._dialog.openConfirmPopup(i).afterClosed().pipe(x(1)).subscribe(r=>{r&&e?._id&&this._carsService.deleteCar(e)})}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=B({type:t,selectors:[["ks-solutions-cars"]],standalone:!0,features:[Q([O]),M],decls:5,vars:6,consts:[[1,"container-fluid","my-5"],[1,"row","mb-3"],[1,"col-12"],[1,"cs-card","shadow-sm","border","border-3","rounded-2"],[3,"config"],[1,"container-fluid","text-center"],[1,"row","gy-2"],[1,"col-12","col-sm-12","col-md-6","col-lg-3"],[1,"ms-2"],[1,"row"],[1,"col-12","col-sm-6","col-md-6","col-lg-4","col-xl-3","mb-4"],[1,"cs-card","h-100","shadow-sm","border","border-1","rounded-2"],[1,"container"],[1,"col-12","col-md-6"],[1,"badge","ms-2",3,"ngClass"],[1,"text-danger"]],template:function(i,r){if(i&1&&(l(0,"div",0),v(1,xe,26,10,"div",1),h(2,"async"),v(3,Me,1,1),h(4,"async"),o()),i&2){let p,_;n(),d((p=y(2,2,r.stats$))?1:-1,p),n(2),d((_=y(4,4,r.cars$))?3:-1,_)}},dependencies:[ee,U,te,ie,Z],styles:[".cs-card[_ngcontent-%COMP%]{transition:transform .3s}"],changeDetection:0})}}return t})();export{ut as CarsComponent};
