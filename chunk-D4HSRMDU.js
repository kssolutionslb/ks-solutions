import{a as de}from"./chunk-44NMMKQA.js";import"./chunk-7CD2TUDV.js";import{a as E}from"./chunk-NWUP6JHR.js";import{a as x}from"./chunk-ICJAWS6B.js";import{a as le}from"./chunk-EK6DBTMH.js";import"./chunk-HMNUYURD.js";import{a as b}from"./chunk-VMV3LQCJ.js";import{a as F}from"./chunk-RWGYOCDE.js";import{C as Z,D as ee,E as C,G as te,L as ie,M as ne,_ as oe,ba as re,ka as ae,pa as se,qa as ce}from"./chunk-4IBHA7I6.js";import"./chunk-CARY4E7O.js";import"./chunk-Z72V5FLM.js";import{$b as z,Dc as M,Ec as D,Fa as H,Fc as O,Hb as p,N as l,Nb as f,Ob as N,Qb as U,Rb as B,Sb as s,Tb as r,Ub as I,Yb as Y,a as m,b as w,bc as v,ea as L,gd as W,hb as a,id as X,ka as d,mc as u,o as V,oa as G,oc as T,pc as q,sb as h,uc as J,vc as Q,wc as S,xc as g,y as $,ya as j,yc as y,za as K,zb as _,zc as P}from"./chunk-P5AQMEDB.js";var A=(()=>{class e{constructor(){this._lovService=d(E),this._navbarService=d(F),this._networkService=d(re),this._menu$=new V(void 0),this._menuId="",this.menu$=this._menu$.asObservable()}updateMenuData(t){this._networkService.patch(b.MENU_SETTINGS.updateFile,{menuId:t}).pipe(l(1)).subscribe()}updateMenuEditors(t){return this._networkService.patch(b.MENU_SETTINGS.menuEditors,w(m({},t),{menuId:t._id}))}addInvoiceSettings(t){this._networkService.post(b.INVOICE.settings,w(m({},t),{menuId:this._menuId})).pipe(l(1)).subscribe(()=>{this.getMenuById(this._menuId)})}updateInvoiceSettings(t){this._networkService.patch(b.INVOICE.settings,t,t._id).pipe(l(1)).subscribe(()=>{this.getMenuById(this._menuId)})}getMenuById(t){this._networkService.post(b.MENU_SETTINGS.byMenuId,{menuId:t}).pipe(l(1)).subscribe({next:i=>{i?i.data&&(this._menu$.next(i.data),this._menuId=t,i.data.isExternal||this._lovService.getMenuTemplatesLov()):this._navbarService.navigateTo(x.LAYOUT.children.HOME.route)},error:()=>{this._navbarService.navigateTo(x.LAYOUT.children.HOME.route)}})}$update(t){this._menu$.next(t)}static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275prov=L({token:e,factory:e.\u0275fac})}}return e})();var _e=()=>({text:"Menu Template",translate:!1,addClass:"h4"}),R=e=>({title:e}),ue=e=>({header:e}),fe=()=>({text:"Menu Invoice Settings",translate:!1,addClass:"h4"}),ve=()=>({text:"Save Settings"}),Se=()=>({icon:"icon_save"}),ge=(e,n,t)=>({label:e,prefixIcon:n,matType:"mat-flat-button",onClick:t}),he=e=>[e],Ce=e=>({position:"end",buttons:e}),xe=()=>({addClass:"mb-1"}),be=(e,n,t)=>({header:e,footer:n,content:t}),Ie=()=>({text:"Background Color"}),pe=(e,n)=>({label:e,type:"color",control:n}),Me=()=>({text:"Font Color"}),Te=()=>({text:"Show Item Unit In Invoice If Available"}),ye=(e,n)=>({label:e,control:n}),Fe=e=>({text:e,translate:!1});function Ee(e,n){e&1&&(s(0,"p")(1,"strong"),u(2,"Menu Owner:"),r(),u(3),r()),e&2&&(a(3),T(" ",n," "))}function ke(e,n){if(e&1&&(s(0,"ks-base-card",0)(1,"div",4),_(2,Ee,4,1,"p"),s(3,"p")(4,"strong"),u(5,"Created Date:"),r(),u(6),M(7,"date"),r(),s(8,"p")(9,"strong"),u(10,"Expiry Date:"),r(),u(11),M(12,"date"),r()()()),e&2){let t,i=v(),o=v();p("config",n),a(2),f((t=o.owner())?2:-1,t),a(4),T(" ",O(7,4,i.createdAt,"medium")," "),a(5),T(" ",O(12,7,i.expiresAt,"medium")," ")}}function we(e,n){if(e&1&&(s(0,"li",5),u(1),r()),e&2){let t=n.$implicit;a(),q("",t.name," (",t.email,")")}}function $e(e,n){if(e&1&&(s(0,"ul"),U(1,we,2,2,"li",5,N),r()),e&2){let t=v();a(),B(t)}}function Ne(e,n){e&1&&(s(0,"div",3)(1,"p"),u(2,"This menu currently has no editors. Please contact your administrator if you'd like to add one."),r()())}function Ue(e,n){e&1&&_(0,$e,3,0,"ul")(1,Ne,3,0,"div",3),e&2&&f(n.length?0:1)}function Be(e,n){if(e&1&&(s(0,"ks-base-card",0),_(1,Ue,2,1),r()),e&2){let t,i=v(2);p("config",n),a(),f((t=i.editors())?1:-1,t)}}function Pe(e,n){if(e&1){let t=Y();s(0,"div",2)(1,"ks-base-card",0)(2,"form")(3,"div",6)(4,"div",7)(5,"div",8),I(6,"ks-base-input",0),r(),s(7,"div",8),I(8,"ks-base-input",0),r(),s(9,"div",9),I(10,"ks-base-slide-toggle",0),r()()()(),s(11,"kss-lib-invoice-footer-text",10),z("getValue",function(o){j(t);let c=v(2);return K(c.footerText=o)}),r()()()}if(e&2){let t=v(2);a(),p("config",P(19,be,g(6,R,S(5,fe)),g(16,Ce,g(14,he,P(10,ge,S(8,ve),S(9,Se),t.updateMenuInvoice.bind(t)))),S(18,xe))),a(5),p("config",y(24,pe,S(23,Ie),t.invoiceSettingsForm.controls.backgroundColor)),a(2),p("config",y(28,pe,S(27,Me),t.invoiceSettingsForm.controls.fontColor)),a(2),p("config",y(32,ye,S(31,Te),t.invoiceSettingsForm.controls.showUnit)),a(),p("control",t.invoiceSettingsForm.controls.footerText)}}function De(e,n){if(e&1&&I(0,"ks-base-card",0),e&2){let t=n.$implicit;p("config",g(5,ue,g(3,R,g(1,Fe,t.name))))}}function Oe(e,n){if(e&1&&(U(0,De,1,7,"ks-base-card",0,N),M(2,"async")),e&2){let t=v(2);B(D(2,0,t.templates$))}}function Ae(e,n){e&1&&(s(0,"div",3)(1,"p"),u(2,"This menu is external and does not support template changes."),r()())}function Re(e,n){if(e&1&&(_(0,ke,13,10,"ks-base-card",0),s(1,"div",1),_(2,Be,2,2,"ks-base-card",0),r(),_(3,Pe,12,35,"div",2),s(4,"ks-base-card",0),_(5,Oe,3,2)(6,Ae,3,0,"div",3),r()),e&2){let t,i,o=n,c=v();f((t=c.menuCard())?0:-1,t),a(2),f((i=c.editorsCard())?2:-1,i),a(),f(o.hasInvoice?3:-1),a(),p("config",g(8,ue,g(6,R,S(5,_e)))),a(),f(o.isExternal?6:5)}}var pt=(()=>{class e{constructor(){this._destroyRef=d(H),this._dialog=d(oe),this._lovService=d(E),this._menuSettingsService=d(A),this._navService=d(F),this.templates$=this._lovService.menuTemplatesLov$.pipe($(t=>t.filter(i=>!i.isCustom))),this.menu$=this._menuSettingsService.menu$,this.currentScreen=le("menu_settings"),this.menuCard=h(void 0),this.editorsCard=h(void 0),this.editors=h([]),this.owner=h(""),this.footerText="",this.invoiceSettingsForm=new ee({logoUrl:new C(""),backgroundColor:new C("#FFFFFF"),fontColor:new C("#000000"),footerText:new C(""),showUnit:new C(!1)})}ngOnInit(){let t=this._navService.readUrlParams().MenuId;this._navService.updateNav({show:!0,back:!0,title:this.currentScreen.screenName,buttons:[]}),t?this._menuSettingsService.getMenuById(t):this._navService.navigateTo(x.LAYOUT.children.HOME.route),this._menuSettingsService.menu$.pipe(ne(this._destroyRef)).subscribe(i=>{if(!i)return;this.invoiceSettingsForm.patchValue(i.invoiceSettings||{}),this.footerText=i.invoiceSettings?.footerText||"",this._lovService.userLov$.pipe(l(1)).subscribe(c=>{this.owner.set(c.find(k=>k._id===i.ownerId)?.name??""),this.editors.set(c.filter(k=>i.editorsId.includes(k._id)))}),this.editorsCard.set({header:{title:{text:"Menu Editors",addClass:"h4"}}});let o={header:{title:{text:i.name,translate:!1,tag:"h4"},position:"center"},footer:{buttons:[{label:{text:"Update Menu Data"},matType:"mat-flat-button",suffixIcon:{icon:"icon_refresh"},onClick:()=>{this._updateMenu(i)},hide:h(!i.isExternal)},{label:{text:"Open Menu"},matType:"mat-flat-button",suffixIcon:{icon:"icon_arrow_right",size:"sm"},onClick:()=>{i.redirect&&i.activateRedirection?window.open(i.redirect,"_blank"):window.open(`${window.location.origin}/${x.MENUS.route}/${i.endpoint}`,"_blank")}}],position:"end"}};this.menuCard.set(o)})}updateMenuInvoice(){this._dialog.openConfirmPopup({title:{text:"Confirm Save"},message:{text:"Are you sure you want to update the invoice settings?"}}).afterClosed().pipe(l(1)).subscribe(t=>{t&&this._menuSettingsService.menu$.pipe(l(1)).subscribe(i=>{let o=this.invoiceSettingsForm.value;o.footerText=this.footerText,i&&(i.invoiceSettings?this._menuSettingsService.updateInvoiceSettings(m(m({},i.invoiceSettings),o)):this._menuSettingsService.addInvoiceSettings(o))})})}_openUpdateEditorsDialog(t){let i={title:{text:"Editors"},form:{value:m({},t||{}),fields:[{name:"editorsId",type:"select",label:{text:"Editors"},stream:this._lovService.userLov$.pipe($(o=>o.filter(c=>c._id!==t?.ownerId))),transformer:{nameKey:"name",valueKey:"_id"},multiple:!0}]},beforeCloseObservable:o=>this._menuSettingsService.updateMenuEditors(m(m({},t),o)),getAfterSuccessResponse:o=>{o.data&&this._menuSettingsService.$update(o.data)}};this._dialog.openFormPopup(i,"500px")}_updateMenu(t){let i={title:{text:"Confirm Update"},message:{text:"Are you sure you want to update this menu? Please note that it may take up to 5 minutes for the changes to take effect."}};this._dialog.openConfirmPopup(i).afterClosed().pipe(l(1)).subscribe(o=>{o&&t._id&&this._menuSettingsService.updateMenuData(t._id)})}static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275cmp=G({type:e,selectors:[["ks-solutions-menu-settings"]],standalone:!0,features:[J([A]),Q],decls:2,vars:3,consts:[[3,"config"],[1,"my-3"],[1,"mb-3"],[1,"external-menu-info"],[1,"dates-section"],[1,"text-break"],[1,"container-fluid"],[1,"row"],[1,"col-12","col-sm-12","col-md-6","col-lg-4"],[1,"col-12","col-sm-12","col-md-6","col-lg-4","pt-4",2,"min-height","75px"],[3,"getValue","control"]],template:function(i,o){if(i&1&&(_(0,Re,7,10),M(1,"async")),i&2){let c;f((c=D(1,1,o.menu$))?0:-1,c)}},dependencies:[se,W,X,ae,ie,te,Z,ce,de],styles:[".external-menu-info[_ngcontent-%COMP%]{font-size:16px;color:#6c757d}"],changeDetection:0})}}return e})();export{pt as MenuSettingsComponent};
